---
title: "CGM in CF - Beta cell function outcomes"
author: "Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
```

```{r echo=FALSE,include=FALSE}
library(Hmisc)
library(knitr)
library(rspiro)
library(tableone)
library(broom)
library(pROC)
library(dplyr)
library(sjlabelled)
library(tableone)
library(ISLR)
library(glmnet)
library(pROC)
library(cutpointr)
library(tibble)
library(tableone)
library(OptimalCutpoints)
#library(officedown)
```

```{r echo=FALSE, include=FALSE}
# read in OGTT data
source("S:\\Shared Projects\\Laura\\Laura Tim projects\\Christine Chan\\2019 ADA Abstracts\\Data_Cleaned\\ada_2019.R")
source("C:\\Users\\pylell\\Documents\\GitHub\\General-code\\temp_table1.r")
source("C:\\Users\\pylell\\Documents\\GitHub\\General-code\\01_functions.r")
source("C:\\Users\\pylell\\Documents\\GitHub\\General-code\\laura_functions.r")
source("C:\\Users\\pylell\\Documents\\GitHub\\General-code\\iAUC.r")

# handling duplicates - per Christine
# for 004CD, use second visit
data <- data[!data$subject_id=='004CD--1',]
# for 023, use second
data <- data[!data$subject_id=='023HC--1',]
# 059 use second
data <- data[!data$subject_id=='059--1',]
# 063 use second
data <- data[!data$subject_id=='063--1',]
# 080 use second
data <- data[!data$subject_id=='080--1',]
# 040 keep first
data <- data[!data$subject_id=='040.1--1',]

# hardcode missing data per Christine
data[data$subject_id=="067--1",]$lab_ogtt_2_hour_glucose <- 131

# find visits on insulin and exclude
insulin <- read.csv("S:\\Shared Projects\\Laura\\Laura Tim projects\\Christine Chan\\2019 ADA Abstracts\\Data_Raw\\insulin.csv")
data <- merge(data,insulin,by="subject_id",all.x = T,all.y = F)
data <- data[is.na(data$cf_insulin_use),]

# tanner stage
femtanner <- c("tanner_stage_female_breast___1","tanner_stage_female_breast___2","tanner_stage_female_breast___3","tanner_stage_female_breast___4","tanner_stage_female_breast___5" )
maletanner <- c("tanner_stage_male_testicul___1","tanner_stage_male_testicul___2","tanner_stage_male_testicul___3","tanner_stage_male_testicul___4","tanner_stage_male_testicul___5")
data$tanner[which(data$gender.factor == "Female")] <- 
  as.numeric(apply(data[which(data$gender.factor == "Female"),femtanner],1,which.max))
data$tanner[which(data$gender.factor == "Male")] <- 
  as.numeric(apply(data[which(data$gender.factor == "Male"),maletanner],1,which.max))
data$tanner <- as.factor(data$tanner)
# lung function - no Asians in this data set
# Ask Christine if height at the lung function visit should be added to REDCap
data$race_ethnicity <- as.numeric(data$race_ethnicity)
data$lung_race <- ifelse(data$race_ethnicity %in% 3:6,5,data$race_ethnicity)
predGLI <- pred_GLI(age=data$age_at_visit_1,height=(data$average_height/100),gender=data$gender,ethnicity=data$lung_race,param=c("FEV1","FVC"))
data$fev_pred <- predGLI$pred.FEV1
data$fvc_pred <- predGLI$pred.FVC
data$fev_perc <- (data$raw_fev1/data$fev_pred)*100
data$fvc_perc <- (data$raw_fvc/data$fvc_pred)*100
# calculate beta cell function outcomes
data$isi <- (data$min_30_insulin - data$min_0_insulin) / (data$min_30_glucose-data$lab_ogtt_fasting)
data$isi_cpep <- (data$min_30_c_peptide - data$min_0_c_peptide) / (data$min_30_glucose-data$lab_ogtt_fasting)
data$odi <- (1/data$min_0_insulin) * data$isi
data$odi_cpep <- (1/data$min_0_c_peptide) * data$isi_cpep
glucvars <- c("lab_ogtt_fasting","min_10_glucose","min_20_glucose","min_30_glucose","min_90_glucose",
                    "min_150_glucose","min_180_glucose")
data$glucmean <- rowMeans(data[,glucvars])
insvars <- c("min_0_insulin","min_10_insulin","min_20_insulin","min_30_insulin","min_90_insulin",
             "min_150_insulin","min_180_insulin")
data$insmean <- rowMeans(data[,insvars])
data$matsuda <- 10000/(sqrt(data$lab_ogtt_fasting*data$min_0_insulin*data$glucmean*data$insmean))
data$homa_ir <- (data$lab_ogtt_fasting*data$min_0_insulin)/22.5

# also need the following
# iAUCg, iAUCins/iAUCg, iAUCcpep/iAUCg, iAUCglucagon
#glucose
cols_gluc = c("lab_ogtt_fasting",
         "min_10_glucose","min_20_glucose","min_30_glucose",
         "lab_ogtt_1_hour_glucose","min_90_glucose",
         "lab_ogtt_2_hour_glucose","min_150_glucose",
         "min_180_glucose")
ogttdat <- data[,c(cols_gluc,"subject_id")]
ogttdat <- ogttdat[which(rowSums(!is.na(ogttdat[,cols_gluc]))>=4),]
ogttdat$iaucbase_glucose <- iAUC_glucose(ogttdat,ogttdat$lab_ogtt_fasting,type = "linear")
ogttdat <- ogttdat[,c("subject_id","iaucbase_glucose")]
data <- merge(data,ogttdat,by="subject_id",all.x=TRUE,all.y=TRUE)

#insulin
cols_ins = c("min_0_insulin","min_10_insulin","min_20_insulin","min_30_insulin","min_60_insulin",
             "min_90_insulin","min_120_insulin","min_150_insulin","min_180_insulin")
ogttdat <- data[,c(cols_ins,"subject_id")]
ogttdat <- ogttdat[which(rowSums(!is.na(ogttdat[,cols_ins]))>=4),]
ogttdat$iaucbase_insulin <- iAUC_insulin(ogttdat,ogttdat$min_0_insulin,type = "linear")
ogttdat <- ogttdat[,c("subject_id","iaucbase_insulin")]
data <- merge(data,ogttdat,by="subject_id",all.x=TRUE,all.y=TRUE)

#C-peptide
cols_cpep = c("min_0_c_peptide","min_10_c_peptide","min_20_c_peptide","min_30_c_peptide","min_60_c_peptide",
             "min_90_c_peptide","min_120_c_peptide","min_150_c_peptide","min_180_c_peptide")
ogttdat <- data[,c(cols_cpep,"subject_id")]
ogttdat <- ogttdat[which(rowSums(!is.na(ogttdat[,cols_cpep]))>=4),]
ogttdat$iaucbase_cpep <- iAUC_cpep(ogttdat,ogttdat$min_0_c_peptide,type = "linear")
ogttdat <- ogttdat[,c("subject_id","iaucbase_cpep")]
data <- merge(data,ogttdat,by="subject_id",all.x=TRUE,all.y=TRUE)

# glucagon
cols_glucagon = c("min_0_glucagon","min_10_glucagon","min_20_glucagon","min_30_glucagon","min_60_glucagon",
              "min_90_glucagon","min_120_glucagon","min_150_glucagon","min_180_glucagon")
ogttdat <- data[,c(cols_glucagon,"subject_id")]
ogttdat <- ogttdat[which(rowSums(!is.na(ogttdat[,cols_glucagon]))>=4),]
ogttdat <- ogttdat[which(!is.na(ogttdat[,"min_0_glucagon"])),]
ogttdat$iaucbase_glucagon <- iAUC_glucagon(ogttdat,ogttdat$min_0_glucagon,type = "linear")
ogttdat <- ogttdat[,c("subject_id","iaucbase_glucagon")]
data <- merge(data,ogttdat,by="subject_id",all.x=TRUE,all.y=TRUE)

data$iAUCins_iAUC_gluc <- data$iaucbase_insulin/data$iaucbase_glucose
data$iAUCcpep_iAUCgluc <- data$iaucbase_cpep/data$iaucbase_glucose

# add in CGM variables that were left out of the original dataset
extra <- read.csv("S:\\Shared Projects\\Laura\\Laura Tim projects\\Christine Chan\\2019 ADA Abstracts\\Data_Raw\\CGMInHealthyControls-CGMVariables_DATA_2020-04-30_1347.csv")
extra <- extra[,c("subject_id","percent_time_over_180","percent_time_over_200","cov")]
data <- merge(data,extra,by="subject_id",all.x=TRUE,all.y=FALSE)
# calculate delta BG
data$delta_bg <- data$max_sensor-data$min_sensor

# keep only those who have non-missing odi
#alldata <- data[which(!is.na(data$odi) & data$odi != Inf),]
alldata <- data

# there are some strange values for iAUCins_iAUC_gluc
check <- alldata[!is.na(alldata$iAUCins_iAUC_gluc),c("subject_id","group_category.factor","iAUCins_iAUC_gluc",cols_gluc,"iaucbase_glucose",
                                                     cols_ins,"iaucbase_insulin")]
check <- check[order(check$iAUCins_iAUC_gluc),]  
write.csv(check,"E:\\Christine Chan\\ADA abstract 2019\\check iAUC.csv",row.names = F)

# make factors
alldata$gender <- as.factor(alldata$gender)
alldata$g_tube_feeds <- as.factor(alldata$g_tube_feeds)
alldata$cf_pancreatic <- as.factor(alldata$cf_pancreatic)

# calculate TIR
alldata$tir_70_140 <- 100 - (alldata$percent_time_under_70 + alldata$percent_time_over_140)

# calculate insulin clearance
alldata$fasting_ins_clearance <-  alldata$min_0_c_peptide / alldata$min_0_insulin
alldata$ins_clearance_30 <-  (alldata$min_30_c_peptide-alldata$min_0_c_peptide) / (alldata$min_30_insulin-alldata$min_0_insulin) 
alldata$ins_clearance_ogtt <- alldata$iaucbase_cpep / alldata$iaucbase_insulin

# read in genotype data
genotype <- read.csv("S:\\Shared Projects\\Laura\\Laura Tim projects\\Christine Chan\\2019 ADA Abstracts\\Data_Raw\\genotype.csv")
genotype$genoclass <- NA
genotype$genoclass <- ifelse(genotype$cf_mutation_1_class %in% c(1,2,3) & genotype$cf_mutation_2_class %in% c(1,2,3),"Class I-III",
                             ifelse(genotype$cf_mutation_1_class %in% c(4,5) | genotype$cf_mutation_2_class %in% c(4,5),
                                    "Class IV-V","Unidentified"))
genotype$genoclass <- ifelse(is.na(genotype$cf_mutation_1_class) | is.na(genotype$cf_mutation_2_class),NA,genotype$genoclass)
genotype$genoclass <- as.factor(genotype$genoclass)
genotype <- genotype[,c("subject_id","genoclass")]
alldata <- merge(alldata,genotype,by="subject_id",all.x=T,all.y=F)

# labels
label(alldata$age_at_visit_1)="Age"
label(alldata$race_ethnicity.factor)="Race/ethnicity"
label(alldata$gender.factor)="Gender"
label(alldata$poc_a1c)="HbA1c"
label(alldata$g_tube_feeds.factor)="G-tube feeds"
label(alldata$fev_perc)="FEV-1 percent"
label(alldata$fvc_perc)="FVC"
label(alldata$cf_pancreatic.factor)="Pancreatic insufficiency"
label(alldata$tanner)="Tanner stage"
label(alldata$bmi_z_score)="First BMI-Z"
label(alldata$isi)="ISI"
label(alldata$isi_cpep)="ISI C-peptide"
label(alldata$odi)="oDI"
label(alldata$odi_cpep)="oDI C-peptide"
label(alldata$min_sensor)="Min sensor glucose"
label(alldata$max_sensor)="Max sensor glucose"
label(alldata$average_sensor)="Average sensor glucose"
label(alldata$average_auc_per_day)="Average AUC"
label(alldata$excursions_over_200)="Excursions>200"
label(alldata$avg_excur_over_140_per_day)="Excursions>140/day"
label(alldata$avg_excur_over_200_per_day)="Excursions>200/day"
label(alldata$excursions_over_140)="Excursions>140"
label(alldata$percent_time_under_60)="% time <60"
label(alldata$percent_time_under_70)="% time <70"
label(alldata$percent_time_over_140)="% time >140"
label(alldata$min_spent_under_60)="Time spent <60"
label(alldata$min_spent_under_70)="Time spent <70"
label(alldata$min_spent_over_200)="Time spent >200"
label(alldata$min_spent_over_140)="Time spent >140"
label(alldata$percent_time_over_180)="% time >180"
label(alldata$percent_time_over_200)="% time >200"
label(alldata$total_auc)="Total AUC"
label(alldata$standard_deviation)="SD"
label(alldata$mean_amp_glycemic_ex)="MAGE"
label(alldata$r_mage)="R-MAGE"
label(alldata$iaucbase_glucose)="iAUC glucose"
label(alldata$iaucbase_insulin)="iAUC insulin"
label(alldata$iaucbase_cpep)="iAUC C-peptide"
label(alldata$iaucbase_glucagon)="iAUC glucagon"
label(alldata$iAUCins_iAUC_gluc)="iAUC insulin/iAUC glucose"
label(alldata$iAUCcpep_iAUCgluc)="iAUC C-peptide/iAUC glucose"
label(alldata$cov) ="CV"
label(alldata$tir_70_140) ="TIR 70-140"
label(alldata$lab_ogtt_fasting)="Fasting glucose"
label(alldata$lab_ogtt_1_hour_glucose)="1 hr glucose"
label(alldata$lab_ogtt_2_hour_glucose)="2 hr glucose"
label(alldata$fasting_ins_clearance)="Fasting insulin clearance"
label(alldata$ins_clearance_30)="Insulin clearance - 30 minute"
label(alldata$ins_clearance_ogtt)="Insulin clearance - whole OGTT"
label(alldata$genoclass)="Genotype class"

# create new variable for diabetes vs. no diabetes
alldata$diabetes <- ifelse(alldata$group_category.factor=="Cystic Fibrosis Related Diabetes",1,0)

# find people missing 1 hr or 2 hr glucose but not both
keep <- alldata[(is.na(alldata$lab_ogtt_1_hour_glucose) | is.na(alldata$lab_ogtt_2_hour_glucose)),
                c("subject_id","lab_ogtt_1_hour_glucose","lab_ogtt_2_hour_glucose")]
#keep <- keep[!(is.na(alldata$lab_ogtt_1_hour_glucose && is.na(alldata$lab_ogtt_2_hour_glucose))),]
write.csv(keep,"C:\\temp\\missing 1 hr or 2 hr.csv",na = "")

# create new variable for prediabetes - 1 hr >=200 or 2 hr >= 140
alldata$prediabetes <- ifelse(alldata$lab_ogtt_1_hour_glucose>=200 | alldata$lab_ogtt_2_hour_glucose>=140,1,0)
alldata$prediabetes <- ifelse(alldata$prediabetes==1 & alldata$diabetes==1,0,
                              ifelse(alldata$prediabetes==1 & alldata$diabetes==0,1,0))
alldata[alldata$subject_id %in% keep$subject_id,]$prediabetes <- 0
alldata$prediabetes_or_diabetes <- ifelse(alldata$prediabetes==1 | alldata$diabetes==1,1,0)

# create variable for 2 hour glucose >=140
alldata$ogtt_2h_140 <- ifelse(alldata$lab_ogtt_2_hour_glucose>=140,1,0)
alldata$ogtt_2h_140 <- ifelse(is.na(alldata$lab_ogtt_2_hour_glucose),NA,alldata$ogtt_2h_140)
label(alldata$ogtt_2h_140)="2 hour glucose >=140"

# read in calprotectin and CRP
crp <- read.csv("S:\\Shared Projects\\Laura\\Laura Tim projects\\Christine Chan\\2019 ADA Abstracts\\Data_Raw\\CGMInHealthyControls-CalprotectinAndCRP_DATA_LABELS_2020-04-30_1855.csv")
crp$subject_id <- crp$Subject.ID
crp$Subject.ID <- NULL
alldata <- merge(alldata,crp,by="subject_id",all.x=TRUE,all.y=FALSE)
alldata$Calprotectin <- as.numeric(as.character(alldata$Calprotectin))
label(alldata$Calprotectin) = "Calprotectin"
label(alldata$C.Reactive.Protein) = "CRP"

# create tertiles of CV, MAGE, and delta BG
alldata$cov_tertile <- ntile(alldata$cov,3)
alldata$mage_tertile <- ntile(alldata$r_mage,3)
alldata$delta_bg_tertile <- ntile(alldata$delta_bg,3)

# fix infinite values
alldata[alldata$subject_id=="105--1",]$isi <- NA
alldata[alldata$subject_id=="105--1",]$isi_cpep <- NA
alldata[alldata$subject_id=="105--1",]$odi <- NA
alldata[alldata$subject_id=="105--1",]$odi_cpep <- NA

# also need to make separate dataset with those with fsOGTT/oDI
has_odi <- alldata[!is.na(alldata$odi),]

npar <- nrow(alldata)
npar_odi <- nrow(has_odi)

# create file for Christine for people missing beta cell function vars
missodi <- has_odi[is.na(has_odi$isi) | is.na(has_odi$isi_cpep) | is.na(has_odi$odi) |
                    is.na(has_odi$odi_cpep) | is.na(has_odi$matsuda) | is.na(has_odi$homa_ir)
                    | is.na(has_odi$iaucbase_cpep) | is.na(has_odi$iaucbase_glucagon) |
                      is.na(has_odi$iaucbase_glucose) | is.na(has_odi$iaucbase_insulin) |
                      is.na(has_odi$iAUCcpep_iAUCgluc) | is.na(has_odi$iAUCins_iAUC_gluc),]
#write.csv(missodi,
#"S:\\Shared Projects\\Laura\\Laura Tim projects\\Christine Chan\\2019 ADA Abstracts\\Data_Cleaned\\missing_ogtt_vars.csv")
                


# ANALYSIS

# table 1
tab1vars <- c("age_at_visit_1", "race_ethnicity.factor","gender.factor","poc_a1c","fev_perc","fvc_perc","g_tube_feeds.factor",
              "tanner","cf_pancreatic.factor","bmi_z_score","lab_ogtt_fasting","lab_ogtt_1_hour_glucose","lab_ogtt_2_hour_glucose",
              "genoclass","Calprotectin","C.Reactive.Protein")
tab1_all <- final_table(data=alldata,variables=tab1vars,group=alldata$group_category.factor,margin=2,single=0,ron=2)
tab1_odi <- final_table(data=has_odi,variables=tab1vars,group=has_odi$group_category.factor,margin=2,single=0,ron=2)

# pairwise comparisons for table 1 - HbA1c
a1 <- aov(alldata$poc_a1c~alldata$group_category.factor)
a1t <- TukeyHSD(a1)
a1t <- tidy(a1t)
a1t <- a1t[,-1]

# compare groups
ogttvars <- c("isi","isi_cpep","odi","odi_cpep","matsuda","homa_ir","iaucbase_glucose","iaucbase_insulin","iaucbase_cpep",
              "iaucbase_glucagon","iAUCins_iAUC_gluc","iAUCcpep_iAUCgluc","min_0_insulin","fasting_ins_clearance",
              "ins_clearance_30","ins_clearance_ogtt")
cgmvars <- c("min_sensor","max_sensor","average_sensor","average_auc_per_day","excursions_over_200","avg_excur_over_140_per_day",
             "avg_excur_over_200_per_day","excursions_over_140","percent_time_under_60","percent_time_under_70",
             "percent_time_over_140","percent_time_over_180","percent_time_over_200",
             "min_spent_under_60","min_spent_under_70","min_spent_over_200","min_spent_over_140",
             "total_auc","standard_deviation","mean_amp_glycemic_ex","Calprotectin","C.Reactive.Protein","cov","tir_70_140")
has_odi[,c(cgmvars,ogttvars)] <- apply(has_odi[,c(cgmvars,ogttvars)],2,as.numeric)
tab2a <- final_table(data=alldata,variables=cgmvars,group=alldata$group_category.factor,margin=2,single=0,ron=2)

# new table 2a with mean and SD for all variables
tab12a_new <- CreateTableOne(data=alldata,vars = cgmvars,strata = "group_category.factor")

# not sure why this isn't running
#tab2b <- final_table(data=has_odi,variables=ogttvars,group=has_odi$group_category.factor,margin=2,single=0,ron=2)
tab2b <- CreateTableOne(data=has_odi,ogttvars,strata="group_category.factor")
tab2b <- print(tab2b,printToggle = F,varLabels=TRUE,missing=T)

# new table of CGM variables for those who have OGTT
tab2c <- CreateTableOne(data=has_odi,cgmvars,strata="group_category.factor")
tab2c <- print(tab2c,printToggle = F,varLabels=TRUE,missing=T)

# correlations
ogttvarscorr <- c("isi","isi_cpep","odi","odi_cpep","matsuda","homa_ir","iaucbase_glucose","iaucbase_insulin","iaucbase_cpep",
              "iaucbase_glucagon","iAUCins_iAUC_gluc","iAUCcpep_iAUCgluc","min_0_insulin","fasting_ins_clearance",
              "ins_clearance_30","ins_clearance_ogtt","lab_ogtt_fasting","min_30_glucose","lab_ogtt_1_hour_glucose", 
              "lab_ogtt_2_hour_glucose")
corr <- rcorr(as.matrix(alldata[, c(ogttvarscorr,cgmvars)]), type = "pearson")
corr <- flattenCorrMatrix(round(corr$r,4), round(corr$P,4))
corr <- corr[corr$row %in% ogttvarscorr & corr$column %in% cgmvars,]

# reduced set correlations with FDR adjustment
ogttvars_red <- c("isi_cpep","odi_cpep","matsuda","homa_ir","iaucbase_glucose","iaucbase_cpep")
cgmvars_red <- c("min_sensor","max_sensor","average_sensor","avg_excur_over_200_per_day","avg_excur_over_140_per_day",
                 "percent_time_over_140","percent_time_under_60","percent_time_over_180","percent_time_over_200",
                 "standard_deviation","cov","mean_amp_glycemic_ex","Calprotectin","C.Reactive.Protein")
corr_red <- rcorr(as.matrix(alldata[, c(ogttvars_red,cgmvars_red)]), type = "pearson")
corr_red$P <- as.matrix(corr_red$P,nrow=)
corr_red <- flattenCorrMatrix(round(corr_red$r,4), round(corr_red$P,4))
corr_red <- corr_red[corr_red$row %in% ogttvars_red & corr_red$column %in% cgmvars_red,]
corr_red$p <- p.adjust(corr_red$p)

```

```{r echo=FALSE}
# Pairwise comparisons
sigvars <- c("poc_a1c","isi","isi_cpep","odi","odi_cpep","iaucbase_glucose","iaucbase_cpep","average_sensor","standard_deviation","max_sensor","average_auc_per_day","excursions_over_200","avg_excur_over_200_per_day","min_spent_over_200","excursions_over_140","avg_excur_over_140_per_day","percent_time_over_140","min_spent_over_140","percent_time_over_180","percent_time_over_200","cov","tir_70_140","matsuda")
l <- list()
for (var in sigvars) {
  table <- TukeyHSD(aov(alldata[,var] ~ alldata$group_category.factor))
  table <- as.data.frame(table$`alldata$group_category.factor`)
  table <- round(table,3)
  l[[var]] <- table
}
```

```{r echo=FALSE}
# Pairwise comparisons
sigvars_odi <- c("max_sensor","avg_excur_over_140_per_day","avg_excur_over_200_per_day",
                 "excursions_over_140","percent_time_over_140","standard_deviation",
                 "mean_amp_glycemic_ex","cov","tir_70_140")
l_odi <- list()
for (var in sigvars_odi) {
  table <- TukeyHSD(aov(has_odi[,var] ~ has_odi$group_category.factor))
  table <- as.data.frame(table$`has_odi$group_category.factor`)
  table <- round(table,3)
  l_odi[[var]] <- table
}
```

```{r echo=FALSE}
# Pairwise comparisons for table 1 (all participants)
sigvars_t1 <- c("poc_a1c","bmi_z_score","lab_ogtt_fasting","lab_ogtt_1_hour_glucose","lab_ogtt_2_hour_glucose")
l_t1 <- list()
for (var in sigvars_t1) {
  table <- TukeyHSD(aov(alldata[,var] ~ alldata$group_category.factor))
  table <- as.data.frame(table$`alldata$group_category.factor`)
  table <- round(table,3)
  l_t1[[var]] <- table
}
```

```{r echo=FALSE}
# Pairwise comparisons for table 1 (fsogtt participants)
sigvars_t1odi <- c("poc_a1c","lab_ogtt_fasting","lab_ogtt_1_hour_glucose","lab_ogtt_2_hour_glucose")
l_t1odi <- list()
for (var in sigvars_t1odi) {
  table <- TukeyHSD(aov(has_odi[,var] ~ has_odi$group_category.factor))
  table <- as.data.frame(table$`has_odi$group_category.factor`)
  table <- round(table,3)
  l_t1odi[[var]] <- table
}


```

```{r echo=FALSE, warning=FALSE, include=FALSE}
# ROC analysis for diabetes
# use these variables: percent_time_over_140 percent_time_over_180 percent_time_over_200 excursions_over_200 average_sensor
# max_sensor standard_deviation cv r_mage
pct140_roc <- pROC::roc(diabetes~percent_time_over_140,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
pct140_res <- pROC::coords(pct140_roc,"best",transpose=F,best.method = "closest.topleft")
pct140_res$auc <- as.numeric(pct140_roc$auc)
pct140_res <- apply(pct140_res,2,function(x){round(x,2)})

# trying pct140 with cutpointr 
# here we are saying that the cost of a false negative is 30x that of a false positive
pct140_sens <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=percent_time_over_140,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
pct140_sens_ppv <- pct140_sens %>% add_metric(list(ppv)) %>% select(ppv)

# maintain sensitivity at 90%
pct140_sens90 <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=percent_time_over_140,
                  metric=spec_constrain, constrain_metric=sensitivity, min_constrain=0.9, na.rm=T)
pct140_sens90_ppv <- pct140_sens90 %>% add_metric(list(ppv)) %>% select(ppv)

pct180_roc <- pROC::roc(diabetes~percent_time_over_180,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
pct180_res <- pROC::coords(pct180_roc,"best",transpose=F,best.method = "closest.topleft")
pct180_res$auc <- as.numeric(pct180_roc$auc)
pct180_res <- apply(pct180_res,2,function(x){round(x,2)})

pct180_sens <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=percent_time_over_180,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
pct180_sens_ppv <- pct180_sens %>% add_metric(list(ppv)) %>% select(ppv)

# maintain sensitivity at 90%
pct180_sens90 <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=percent_time_over_180,
                  metric=spec_constrain, constrain_metric=sensitivity, min_constrain=0.9, na.rm=T)
# no cutpoint satisfies the constraints

# trying with Optimal.Cutpoints
test2 <- optimal.cutpoints(X="percent_time_over_180",data=alldata[alldata$group_category.factor != "Healthy Control",],status="diabetes",
                          methods="MinValueSe",tag.healthy="0",control=control.cutpoints(valueSe = 0.9) )
# gives same cutoff as the one that maintains the cost of a FN at 30x FP

pct200_roc <- pROC::roc(diabetes~percent_time_over_200,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
pct200_res <- pROC::coords(pct200_roc,"best",transpose=F,best.method = "closest.topleft")
pct200_res$auc <- as.numeric(pct200_roc$auc)
pct200_res <- apply(pct200_res,2,function(x){round(x,2)})

pct200_sens <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=percent_time_over_200,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
pct200_sens_ppv <- pct200_sens %>% add_metric(list(ppv)) %>% select(ppv)

# maintain sensitivity at 90%
pct200_sens90 <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=percent_time_over_200,
                  metric=spec_constrain, constrain_metric=sensitivity, min_constrain=0.9, na.rm=T)
# no cutpoint satisfies the constraints

ex200_roc <- pROC::roc(diabetes~excursions_over_200,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
ex200_res <- pROC::coords(ex200_roc,"best",transpose=F,best.method = "closest.topleft")
ex200_res$auc <- as.numeric(ex200_roc$auc)
ex200_res <- apply(ex200_res,2,function(x){round(x,2)})

ex200_sens <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=excursions_over_200,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
ex200_sens_ppv <- ex200_sens %>% add_metric(list(ppv)) %>% select(ppv)

# maintain sensitivity at 90%
ex200_sens90 <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=excursions_over_200,
                  metric=spec_constrain, constrain_metric=sensitivity, min_constrain=0.9, na.rm=T)
# no cutpoint satisfies the constraints

average_roc <- pROC::roc(diabetes~average_sensor,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
average_res <- pROC::coords(average_roc,"best",transpose=F,best.method = "closest.topleft")
average_res$auc <- as.numeric(average_roc$auc)
average_res <- apply(average_res,2,function(x){round(x,2)})

average_sens <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=average_sensor,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
average_sens_ppv <- average_sens %>% add_metric(list(ppv)) %>% select(ppv)

# maintain sensitivity at 90%
average_sens90 <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=average_sensor,
                  metric=spec_constrain, constrain_metric=sensitivity, min_constrain=0.9, na.rm=T)
average_sens90_ppv <- average_sens90 %>% add_metric(list(ppv)) %>% select(ppv)

max_roc <- pROC::roc(diabetes~max_sensor,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
max_res <- pROC::coords(max_roc,"best",transpose=F,best.method = "closest.topleft")
max_res$auc <- as.numeric(max_roc$auc)
max_res <- apply(max_res,2,function(x){round(x,2)})

max_sens <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=max_sensor,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
max_sens_ppv <- max_sens %>% add_metric(list(ppv)) %>% select(ppv)

# maintain sensitivity at 90%
max_sens90 <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=max_sensor,
                  metric=spec_constrain, constrain_metric=sensitivity, min_constrain=0.9, na.rm=T)
max_sens90_ppv <- max_sens90 %>% add_metric(list(ppv)) %>% select(ppv)

sd_roc <- pROC::roc(diabetes~standard_deviation,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
sd_res <- pROC::coords(sd_roc,"best",transpose=F,best.method = "closest.topleft")
sd_res$auc <- as.numeric(sd_roc$auc)
sd_res <- apply(sd_res,2,function(x){round(x,2)})

sd_sens <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=standard_deviation,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
sd_sens_ppv <- sd_sens %>% add_metric(list(ppv)) %>% select(ppv)

# maintain sensitivity at 90%
sd_sens90 <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=standard_deviation,
                  metric=spec_constrain, constrain_metric=sensitivity, min_constrain=0.9, na.rm=T)
sd_sens90_ppv <- sd_sens90 %>% add_metric(list(ppv)) %>% select(ppv)

cv_roc <- pROC::roc(diabetes~cov,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
cv_res <- pROC::coords(cv_roc,"best",transpose=F,best.method = "closest.topleft")
cv_res$auc <- as.numeric(cv_roc$auc)
cv_res <- apply(cv_res,2,function(x){round(x,2)})

cv_sens <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=cov,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
cv_sens_ppv <- cv_sens %>% add_metric(list(ppv)) %>% select(ppv)

# maintain sensitivity at 90%
cv_sens90 <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=cov,
                  metric=spec_constrain, constrain_metric=sensitivity, min_constrain=0.9, na.rm=T)
# no cutpoint satisfies the constraint

mage_roc <- pROC::roc(diabetes~r_mage,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
mage_res <- pROC::coords(mage_roc,"best",transpose=F,best.method = "closest.topleft")
mage_res$auc <- as.numeric(mage_roc$auc)
mage_res <- apply(mage_res,2,function(x){round(x,2)})

mage_sens <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=r_mage,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
mage_sens_ppv <- mage_sens %>% add_metric(list(ppv)) %>% select(ppv)

# maintain sensitivity at 90%
mage_sens90 <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=diabetes,x=r_mage,
                  metric=spec_constrain, constrain_metric=sensitivity, min_constrain=0.9, na.rm=T)
mage_sens90_ppv <- mage_sens90 %>% add_metric(list(ppv)) %>% select(ppv)

# ROC analysis for prediabetes
# use these variables: percent_time_over_140 percent_time_over_180 percent_time_over_200 excursions_over_200 average_sensor
# max_sensor standard_deviation cv r_mage
pct140_roc_pre <- pROC::roc(prediabetes~percent_time_over_140,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
pct140_res_pre <- pROC::coords(pct140_roc_pre,"best",transpose=F,best.method = "closest.topleft")
pct140_res_pre$auc <- as.numeric(pct140_roc_pre$auc)
pct140_res_pre <- apply(pct140_res_pre,2,function(x){round(x,2)})

pct140_sens_pre <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes,x=percent_time_over_140,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
pct140_sens_pre_ppv <- pct140_sens_pre %>% add_metric(list(ppv)) %>% select(ppv)

pct180_roc_pre <- pROC::roc(prediabetes~percent_time_over_180,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
pct180_res_pre <- pROC::coords(pct180_roc_pre,"best",transpose=F,best.method = "closest.topleft")
pct180_res_pre$auc <- as.numeric(pct180_roc_pre$auc)
pct180_res_pre <- apply(pct180_res_pre,2,function(x){round(x,2)})

pct180_sens_pre <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes,x=percent_time_over_180,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
pct180_sens_pre_ppv <- pct180_sens_pre %>% add_metric(list(ppv)) %>% select(ppv)

pct200_roc_pre <- pROC::roc(prediabetes~percent_time_over_200,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
pct200_res_pre <- pROC::coords(pct200_roc_pre,"best",transpose=F,best.method = "closest.topleft")
pct200_res_pre$auc <- as.numeric(pct200_roc_pre$auc)
pct200_res_pre <- apply(pct200_res_pre,2,function(x){round(x,2)})

pct200_sens_pre <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes,x=percent_time_over_200,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
pct200_sens_pre_ppv <- pct200_sens_pre %>% add_metric(list(ppv)) %>% select(ppv)

ex200_roc_pre <- pROC::roc(prediabetes~excursions_over_200,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
ex200_res_pre <- pROC::coords(ex200_roc_pre,"best",transpose=F,best.method = "closest.topleft")
ex200_res_pre$auc <- as.numeric(ex200_roc_pre$auc)
ex200_res_pre <- apply(ex200_res_pre,2,function(x){round(x,2)})

ex200_sens_pre <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes,x=excursions_over_200,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
ex200_sens_pre_ppv <- ex200_sens_pre %>% add_metric(list(ppv)) %>% select(ppv)

average_roc_pre <- pROC::roc(prediabetes~average_sensor,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
average_res_pre <- pROC::coords(average_roc_pre,"best",transpose=F,best.method = "closest.topleft")
average_res_pre$auc <- as.numeric(average_roc_pre$auc)
average_res_pre <- apply(average_res_pre,2,function(x){round(x,2)})

average_sens_pre <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes,x=average_sensor,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
average_sens_pre_ppv <- average_sens_pre %>% add_metric(list(ppv)) %>% select(ppv)

max_roc_pre <- pROC::roc(prediabetes~max_sensor,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
max_res_pre <- pROC::coords(max_roc_pre,"best",transpose=F,best.method = "closest.topleft")
max_res_pre$auc <- as.numeric(max_roc_pre$auc)
max_res_pre <- apply(max_res_pre,2,function(x){round(x,2)})

max_sens_pre <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes,x=max_sensor,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
max_sens_pre_ppv <- max_sens_pre %>% add_metric(list(ppv)) %>% select(ppv)

sd_roc_pre <- pROC::roc(prediabetes~standard_deviation,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
sd_res_pre <- pROC::coords(sd_roc_pre,"best",transpose=F,best.method = "closest.topleft")
sd_res_pre$auc <- as.numeric(sd_roc_pre$auc)
sd_res_pre <- apply(sd_res_pre,2,function(x){round(x,2)})

sd_sens_pre <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes,x=standard_deviation,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
sd_sens_pre_ppv <- sd_sens_pre %>% add_metric(list(ppv)) %>% select(ppv)

cv_roc_pre <- pROC::roc(prediabetes~cov,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
cv_res_pre <- pROC::coords(cv_roc_pre,"best",transpose=F,best.method = "closest.topleft")
cv_res_pre$auc <- as.numeric(cv_roc_pre$auc)
cv_res_pre <- apply(cv_res_pre,2,function(x){round(x,2)})

cv_sens_pre <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes,x=cov,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
cv_sens_pre_ppv <- cv_sens_pre %>% add_metric(list(ppv)) %>% select(ppv)

mage_roc_pre <- pROC::roc(prediabetes~r_mage,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
mage_res_pre <- pROC::coords(mage_roc_pre,"best",transpose=F,best.method = "closest.topleft")
mage_res_pre$auc <- as.numeric(mage_roc_pre$auc)
mage_res_pre <- apply(mage_res_pre,2,function(x){round(x,2)})

mage_sens_pre <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes,x=r_mage,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
mage_sens_pre_ppv <- mage_sens_pre %>% add_metric(list(ppv)) %>% select(ppv)

# ROC analysis for prediabetes or diabetes
# use these variables: percent_time_over_140 percent_time_over_180 percent_time_over_200 excursions_over_200 average_sensor
# max_sensor standard_deviation cv r_mage
pct140_roc_pd <- pROC::roc(prediabetes_or_diabetes~percent_time_over_140,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
pct140_res_pd <- pROC::coords(pct140_roc_pd,"best",transpose=F,best.method = "closest.topleft")
pct140_res_pd$auc <- as.numeric(pct140_roc_pd$auc)
pct140_res_pd <- apply(pct140_res_pd,2,function(x){round(x,2)})

pct140_sens_pd <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes_or_diabetes,x=percent_time_over_140,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
pct140_sens_pd_ppv <- pct140_sens_pd %>% add_metric(list(ppv)) %>% select(ppv)

pct180_roc_pd <- pROC::roc(prediabetes_or_diabetes~percent_time_over_180,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
pct180_res_pd <- pROC::coords(pct180_roc_pd,"best",transpose=F,best.method = "closest.topleft")
pct180_res_pd$auc <- as.numeric(pct180_roc_pd$auc)
pct180_res_pd <- apply(pct180_res_pd,2,function(x){round(x,2)})

pct180_sens_pd <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes_or_diabetes,x=percent_time_over_180,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
pct180_sens_pd_ppv <- pct180_sens_pd %>% add_metric(list(ppv)) %>% select(ppv)

pct200_roc_pd <- pROC::roc(prediabetes_or_diabetes~percent_time_over_200,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
pct200_res_pd <- pROC::coords(pct200_roc_pd,"best",transpose=F,best.method = "closest.topleft")
pct200_res_pd$auc <- as.numeric(pct200_roc_pd$auc)
pct200_res_pd <- apply(pct200_res_pd,2,function(x){round(x,2)})

pct200_sens_pd <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes_or_diabetes,x=percent_time_over_200,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
pct200_sens_pd_ppv <- pct200_sens_pd %>% add_metric(list(ppv)) %>% select(ppv)

ex200_roc_pd <- pROC::roc(prediabetes_or_diabetes~excursions_over_200,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
ex200_res_pd <- pROC::coords(ex200_roc_pd,"best",transpose=F,best.method = "closest.topleft")
ex200_res_pd$auc <- as.numeric(ex200_roc_pd$auc)
ex200_res_pd <- apply(ex200_res_pd,2,function(x){round(x,2)})

ex200_sens_pd <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes_or_diabetes,x=excursions_over_200,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
ex200_sens_pd_ppv <- ex200_sens_pd %>% add_metric(list(ppv)) %>% select(ppv)

average_roc_pd <- pROC::roc(prediabetes_or_diabetes~average_sensor,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
average_res_pd <- pROC::coords(average_roc_pd,"best",transpose=F,best.method = "closest.topleft")
average_res_pd$auc <- as.numeric(average_roc_pd$auc)
average_res_pd <- apply(average_res_pd,2,function(x){round(x,2)})

average_sens_pd <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes_or_diabetes,x=average_sensor,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
average_sens_pd_ppv <- average_sens_pd %>% add_metric(list(ppv)) %>% select(ppv)

max_roc_pd <- pROC::roc(prediabetes_or_diabetes~max_sensor,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
max_res_pd <- pROC::coords(max_roc_pd,"best",transpose=F,best.method = "closest.topleft")
max_res_pd$auc <- as.numeric(max_roc_pd$auc)
max_res_pd <- apply(max_res_pd,2,function(x){round(x,2)})

max_sens_pd <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes_or_diabetes,x=max_sensor,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
max_sens_pd_ppv <- max_sens_pd %>% add_metric(list(ppv)) %>% select(ppv)

sd_roc_pd <- pROC::roc(prediabetes_or_diabetes~standard_deviation,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
sd_res_pd <- pROC::coords(sd_roc_pd,"best",transpose=F,best.method = "closest.topleft")
sd_res_pd$auc <- as.numeric(sd_roc_pd$auc)
sd_res_pd <- apply(sd_res_pd,2,function(x){round(x,2)})

sd_sens_pd <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes_or_diabetes,x=standard_deviation,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
sd_sens_pd_ppv <- sd_sens_pd %>% add_metric(list(ppv)) %>% select(ppv)

cv_roc_pd <- pROC::roc(prediabetes_or_diabetes~cov,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
cv_res_pd <- pROC::coords(cv_roc_pd,"best",transpose=F,best.method = "closest.topleft")
cv_res_pd$auc <- as.numeric(cv_roc_pd$auc)
cv_res_pd <- apply(cv_res_pd,2,function(x){round(x,2)})

cv_sens_pd <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes_or_diabetes,x=cov,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
cv_sens_pd_ppv <- cv_sens_pd %>% add_metric(list(ppv)) %>% select(ppv)

mage_roc_pd <- pROC::roc(prediabetes_or_diabetes~r_mage,data=alldata[alldata$group_category.factor != "Healthy Control",],quiet=T)
mage_res_pd <- pROC::coords(mage_roc_pd,"best",transpose=F,best.method = "closest.topleft")
mage_res_pd$auc <- as.numeric(mage_roc_pd$auc)
mage_res_pd <- apply(mage_res_pd,2,function(x){round(x,2)})

mage_sens_pd <- cutpointr(data=alldata[alldata$group_category.factor != "Healthy Control",],class=prediabetes_or_diabetes,x=r_mage,
                  method=minimize_metric,metric=misclassification_cost,
                  cost_fp=1,cost_fn=30,na.rm = T,pos_class = 1,direction=">=")
mage_sens_pd_ppv <- mage_sens_pd %>% add_metric(list(ppv)) %>% select(ppv)

# compare calprotectin and CRP in upper and lower tertiles
tab_cal_crp_cov <-  CreateTableOne(vars = c("Calprotectin","C.Reactive.Protein"),strata="cov_tertile", 
                               data = alldata[alldata$cov_tertile==1 | alldata$cov_tertile==3,])
tab_cal_crp_cov <- print(tab_cal_crp_cov,printToggle = F)
tab_cal_crp_mage <-  CreateTableOne(vars = c("Calprotectin","C.Reactive.Protein"),strata="mage_tertile", 
                               data = alldata[alldata$mage_tertile==1 | alldata$mage_tertile==3,])
tab_cal_crp_mage <- print(tab_cal_crp_mage,printToggle = F)
tab_cal_crp_delta <-  CreateTableOne(vars = c("Calprotectin","C.Reactive.Protein"),strata="delta_bg_tertile", 
                               data = alldata[alldata$delta_bg_tertile==1 | alldata$delta_bg_tertile==3,])
tab_cal_crp_delta <- print(tab_cal_crp_delta,printToggle = F)

# insulin clearance by sex in CF patients only
tab_insclear <-  CreateTableOne(vars = c("fasting_ins_clearance","ins_clearance_30","ins_clearance_ogtt"),strata="gender.factor", 
                               data = alldata[alldata$group_category.factor != "Healthy Control",])
tab_insclear <- print(tab_insclear,printToggle = F)

alldata$fasting_ins_clearance <-  alldata$min_0_c_peptide / alldata$min_0_insulin
alldata$ins_clearance_30 <-  (alldata$min_30_c_peptide-alldata$min_0_c_peptide) / (alldata$min_30_insulin-alldata$min_0_insulin) 
alldata$ins_clearance_ogtt <- alldata$iaucbase_cpep / alldata$iaucbase_insulin

# LASSO for diabetes, prediabetes by 2 hour OGTT
# first create separate matrices with the needed variables
lasso_cgmvars <- c("min_sensor","max_sensor","average_sensor","average_auc_per_day","excursions_over_200","avg_excur_over_140_per_day",
             "avg_excur_over_200_per_day","excursions_over_140","percent_time_under_60","percent_time_under_70",
             "percent_time_over_140","percent_time_over_180","percent_time_over_200",
             "min_spent_under_60","min_spent_under_70","min_spent_over_200","min_spent_over_140",
             "total_auc","standard_deviation","mean_amp_glycemic_ex","cov","tir_70_140")

# first diabetes - use all observations
#lasso_diabetes <- alldata[,c("diabetes",lasso_cgmvars)]
#lasso_diabetes <- na.omit(lasso_diabetes)
#x = model.matrix(diabetes~., lasso_diabetes)[,-1] # trim off the first column leaving only the predictors
#y = lasso_diabetes %>% select(diabetes) %>%  unlist() %>% as.numeric()
#lasso_mod_diabetes <- glmnet(x,y,alpha=1)
#set.seed(1)
#cv.out = cv.glmnet(x, y, alpha = 1) # Fit lasso model on training data
#plot(cv.out) 
#bestlam = cv.out$lambda.min
#out = glmnet(x, y, alpha = 1, lambda = bestlam)
#lasso_coef = predict(out, type = "coefficients", s = bestlam) # Display coefficients using lambda chosen by CV

# diabetes using training and test set
# set.seed(3654)
# lasso_diabetes <- alldata[,c("diabetes",lasso_cgmvars)]
# lasso_diabetes <- na.omit(lasso_diabetes)
# lasso_diabetes_train <- lasso_diabetes %>% sample_frac(0.7)
# lasso_diabetes_test <- lasso_diabetes %>% setdiff(lasso_diabetes_train)
# x_train = model.matrix(diabetes~., lasso_diabetes_train)[,-1]
# x_test = model.matrix(diabetes~., lasso_diabetes_test)[,-1]
# y_train <- ifelse(lasso_diabetes_train$diabetes==1,1,0) 
# y_test <-  ifelse(lasso_diabetes_test$diabetes==1,1,0)
# cv.out = cv.glmnet(x_train, y_train, alpha = 1,family="binomial",maxit=10000000) # Fit lasso model on training data
# #plot(cv.out) # Draw plot of training MSE as a function of lambda
# bestlam = cv.out$lambda.min 
# lasso_mod_diabetes_train <- glmnet(x_train,y_train,alpha=1,family = "binomial",lambda = bestlam)
# probabilities_diabetes <- lasso_mod_diabetes_train %>% predict(newx=x_test, type="response",s=bestlam)
# predicted_classes <- ifelse(probabilities_diabetes>0.5,1,0)
# observed_classes <- y_test
# diabetes_crosstab <- as.data.frame.matrix(table(observed_classes,predicted_classes))
# refit the final model 
# final_mod_diabetes <- glm(diabetes ~ max_sensor + mean_amp_glycemic_ex + cov, family = "binomial", data=alldata)
# mod_diabetes_table <- data.frame(summary(final_mod_diabetes)$coef)
# mod_diabetes_table$OR <- exp(mod_diabetes_table$Estimate)
# mod_diabetes_table$LCL <- exp(mod_diabetes_table$Estimate - mod_diabetes_table$Std..Error * 1.96 )
# mod_diabetes_table$UCL <- exp(mod_diabetes_table$Estimate + mod_diabetes_table$Std..Error * 1.96 )
# mod_diabetes_table$`p-value` <- round(mod_diabetes_table$Pr...z..,4)
# mod_diabetes_table <- mod_diabetes_table[c(5,6,7,8)]

# 2 hour glucose using training and test set
# set.seed(3654)
# lasso_2hr <- alldata[,c("ogtt_2h_140",lasso_cgmvars)]
# lasso_2hr <- na.omit(lasso_2hr)
# lasso_2hr_train <- lasso_2hr %>% sample_frac(0.7)
# lasso_2hr_test <- lasso_2hr %>% setdiff(lasso_2hr_train)
# x_train_2hr = model.matrix(ogtt_2h_140~., lasso_2hr_train)[,-1]
# x_test_2hr = model.matrix(ogtt_2h_140~., lasso_2hr_test)[,-1]
# y_train_2hr <-  ifelse(lasso_2hr_train$ogtt_2h_140==1,1,0)  
# y_test_2hr <-  ifelse(lasso_2hr_test$ogtt_2h_140==1,1,0) 
# cv.out.2hr = cv.glmnet(x_train_2hr, y_train_2hr, alpha = 1,family="binomial") # Fit lasso model on training data
# #plot(cv.out.2hr) # Draw plot of training MSE as a function of lambda
# bestlam_2hr = cv.out.2hr$lambda.min 
# lasso_mod_2hr_train <- glmnet(x_train_2hr,y_train_2hr,alpha=1,family = "binomial",lambda=bestlam_2hr)
# probabilities_2hr <- lasso_mod_2hr_train %>% predict(newx=x_test_2hr, type="response",s=bestlam_2hr)
# predicted_classes_2hr <- ifelse(probabilities_2hr>0.5,1,0)
# observed_classes_2hr <- y_test_2hr
# twohr_crosstab <- as.data.frame.matrix(table(observed_classes_2hr,predicted_classes_2hr))
# # refit the final model 
# final_mod_2hr <- glm(ogtt_2h_140 ~ max_sensor + min_spent_under_70 + min_spent_over_140 + total_auc + standard_deviation
#                      + mean_amp_glycemic_ex + tir_70_140, family = "binomial", data=alldata)
# mod_2hr_table <- data.frame(summary(final_mod_2hr)$coef)
# mod_2hr_table$OR <- exp(mod_2hr_table$Estimate)
# mod_2hr_table$LCL <- exp(mod_2hr_table$Estimate - mod_2hr_table$Std..Error * 1.96 )
# mod_2hr_table$UCL <- exp(mod_2hr_table$Estimate + mod_2hr_table$Std..Error * 1.96 )
# mod_2hr_table$`p-value` <- round(mod_2hr_table$Pr...z..,4)
# mod_2hr_table <- mod_2hr_table[c(5,6,7,8)]


```

# Background

The purpose of this analysis is to examine associations between beta cell function and CGM variables in healthy controls and participants with cystic fibrosis with normal glucose tolerance, impaired glucose tolerance, and CFRD.

# Methods

Participants who had both CGM data and OGTT data with 0, 30, and 120 minute timepoints available were included in this analysis. In this version of the analysis, participants on insulin were excluded.

CFRD was defined as 2 hour OGTT glucose >=200.  Abnormal glycemia was defined as a 1 hour OGTT glucose >=200 or a 2 hour OGTT glucose >=140.

Beta cell function outcomes were calculated as follows:

1) $ISI = (Insulin_{30} - Insulin_{0}) / (Glucose_{30} - Glucose_{0})$
2) $ISI_{Cpep} = (Cpeptide_{30} - Cpeptide_{0}) / (Glucose_{30} - Glucose_{0})$
3) $oDI = (1/Insulin_{0}) * ISI$
4) $oDI_{Cpep} = (1/Cpeptide_{0}) * ISI_{Cpep}$

Integrated AUC (iAUC) for glucose, insulin, C-peptide, and glucagon were calculated as the AUC with respect to the fasting value, using the trapezoidal method.

The distributions of all variables were examined prior to analysis.  Groups were compared using ANOVA or the Wilcoxon test for continuous variables, and the chi-square or Fisher's exact test for categorical variables.  Pearson's correlation coefficient was used to test the association between beta cell function outcomes and CGM outcomes.

ROC analysis was used to examine CGM variables associated with diabetes and to determine the cutoff that best discriminates between participants with and without CFRD.  Optimal cutoffs for each CGM metric determined by "closest to top left" algorithm:  $min((1 - sensitivities)^2 + (1 - specificities)^2)$.

# Results

There were `r npar` participants included in this analysis and `r npar_odi` participants with an fsOGTT.  Table 1a shows baseline descriptive statistics by group, and Table 1b shows baseline descriptive statistics by group for those with fsOGTTs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
kable(tab1_all,caption="Table 1a.  Descriptive statistics by group.  Statistics given are N(%), mean±SD, or median (25th %ile, 75th %ile).  * denotes that the Wilcoxon test was used, and ** denotes that Fisher's exact test was used.") 
```

\newpage

Pairwise Comparisons for Table 1a (all participants) using Tukey's Honestly Significant Difference
```{r echo=FALSE}
# Kable does not appear to work in a for loop for some reason.
kable(l_t1[[1]],caption = sigvars_t1[1])
kable(l_t1[[2]],caption = sigvars_t1[2])
kable(l_t1[[3]],caption = sigvars_t1[3])
kable(l_t1[[4]],caption = sigvars_t1[4])
kable(l_t1[[5]],caption = sigvars_t1[5])
```

\newpage

```{r, results='asis',tidy=TRUE, echo=FALSE}
kable(tab1_odi,caption="Table 1b.  Descriptive statistics by group, for participants with fsOGTT.  Statistics given are N(%), mean±SD, or median (25th %ile, 75th %ile).  * denotes that the Wilcoxon test was used, and ** denotes that Fisher's exact test was used.") 
```
<br>

\newpage

Pairwise Comparisons for Table 1b (participants with fsOGTT) using Tukey's Honestly Significant Difference
```{r echo=FALSE}
# Kable does not appear to work in a for loop for some reason.
kable(l_t1odi[[1]],caption = sigvars_t1odi[1])
kable(l_t1odi[[2]],caption = sigvars_t1odi[2])
kable(l_t1odi[[3]],caption = sigvars_t1odi[3])
kable(l_t1odi[[4]],caption = sigvars_t1odi[4])

```

\newpage

Descriptive statistics for beta cell function outcomes and CGM outcomes are shown in Tables 2a and 2b.
```{r, results='asis',tidy=TRUE, echo=FALSE}
kable(tab2a,caption="Table 2a.  Descriptive statistics for CGM outcomes by group.  Statistics given are N(%), mean±SD, or median (25th %ile, 75th %ile).  * denotes that the Wilcoxon test was used, and ** denotes that Fisher's exact test was used.")
```
<br>

\newpage

The plot below shows the distribution of MAGE by group.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata$mean_amp_glycemic_ex~alldata$group_category.factor)
```
<br>


\newpage

```{r, results='asis',tidy=TRUE, echo=FALSE}
kable(tab2b,caption="Table 2b.  Descriptive statistics for beta cell function outcomes by group, for participants with fsOGTT.  Statistics given are N(%), mean±SD, or median (25th %ile, 75th %ile).  * denotes that the Wilcoxon test was used, and ** denotes that Fisher's exact test was used.")
```
<br>

\newpage

The plot below shows the distribution of iAUCins_iAUC_gluc by group.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata$iAUCins_iAUC_gluc~alldata$group_category.factor)
```
<br>

\newpage

Pairwise Comparisons for Tables 2a and 2b (all participants) using Tukey's Honestly Significant Difference
```{r echo=FALSE}
# Kable does not appear to work in a for loop for some reason.
kable(l[[1]],caption = sigvars[1])
kable(l[[2]],caption = sigvars[2])
kable(l[[3]],caption = sigvars[3])
kable(l[[4]],caption = sigvars[4])
kable(l[[5]],caption = sigvars[5])
kable(l[[6]],caption = sigvars[6])
kable(l[[7]],caption = sigvars[7])
kable(l[[8]],caption = sigvars[8])
kable(l[[9]],caption = sigvars[9])
kable(l[[10]],caption = sigvars[10])
kable(l[[11]],caption = sigvars[11])
kable(l[[12]],caption = sigvars[12])
kable(l[[13]],caption = sigvars[13])
kable(l[[14]],caption = sigvars[14])
kable(l[[15]],caption = sigvars[15])
kable(l[[16]],caption = sigvars[16])
kable(l[[17]],caption = sigvars[17])
kable(l[[18]],caption = sigvars[18])
kable(l[[19]],caption = sigvars[19])
kable(l[[20]],caption = sigvars[20])
kable(l[[21]],caption = sigvars[21])
kable(l[[22]],caption = sigvars[22])
kable(l[[23]],caption = sigvars[23])
```

\newpage

```{r, results='asis',tidy=TRUE, echo=FALSE}
kable(tab2c,caption="Table 2c.  Descriptive statistics for CGM variables by group, for participants with fsOGTT.  Statistics given are N(%), mean±SD, or median (25th %ile, 75th %ile).  * denotes that the Wilcoxon test was used, and ** denotes that Fisher's exact test was used.")
```
<br>

\newpage

Pairwise Comparisons for Table 2c (participants with oDI) using Tukey's Honestly Significant Difference
```{r echo=FALSE}
# Kable does not appear to work in a for loop for some reason.
kable(l_odi[[1]],caption = sigvars_odi[1])
kable(l_odi[[2]],caption = sigvars_odi[2])
kable(l_odi[[3]],caption = sigvars_odi[3])
kable(l_odi[[4]],caption = sigvars_odi[4])
kable(l_odi[[5]],caption = sigvars_odi[5])
kable(l_odi[[6]],caption = sigvars_odi[6])
kable(l_odi[[7]],caption = sigvars_odi[7])
kable(l_odi[[8]],caption = sigvars_odi[8])
kable(l_odi[[9]],caption = sigvars_odi[9])

```

\newpage

Pearson correlation coefficients between beta cell function outcomes and CGM outcomes are shown in Table 3a.
```{r, results='asis',tidy=TRUE, echo=FALSE}
kable(corr,caption="Table 3a.  Correlation between beta cell function outcomes and CGM outcomes.")
```
<br>

\newpage

A reduced set of Pearson correlation coefficients between beta cell function outcomes and CGM outcomes, with FDR adjusted p-values, are shown in Table 3b.
```{r, results='asis',tidy=TRUE, echo=FALSE}
kable(corr_red,caption="Table 3b.  Correlation between beta cell function outcomes and CGM outcomes, with FDR adjusted p-values.")
```
<br>

\newpage

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(alldata$odi_cpep,alldata$max_sensor,xlab="oDI Cpep",ylab="Max sensor (mg/dL)")
abline(lm(alldata$max_sensor~alldata$odi_cpep))

plot(alldata$odi_cpep,alldata$percent_time_over_140,xlab="oDI Cpep",ylab="% time >140 mg/dL")
abline(lm(alldata$percent_time_over_140~alldata$odi_cpep))

plot(alldata$odi_cpep,alldata$r_mage,xlab="oDI Cpep",ylab="MAGE (mg/dL)")
abline(lm(alldata$r_mage~alldata$odi_cpep))

plot(alldata$Calprotectin,alldata$r_mage,xlab="Calprotectin",ylab="MAGE (mg/dL)")
abline(lm(alldata$r_mage~alldata$Calprotectin))

plot(alldata$Calprotectin,alldata$cov,xlab="Calprotectin",ylab="CV",
     xlim = c(0,max(alldata$Calprotectin,na.rm = T)),
     ylim = c(0,max(alldata$cov,na.rm = T)))
abline(lm(alldata$cov~alldata$Calprotectin))

plot(alldata$Calprotectin,alldata$delta_bg,xlab="Calprotectin",ylab="Delta BG")
abline(lm(alldata$delta_bg~alldata$Calprotectin))

plot(alldata$C.Reactive.Protein,alldata$r_mage,xlab="CRP",ylab="MAGE (mg/dL)")
abline(lm(alldata$r_mage~alldata$C.Reactive.Protein))

plot(alldata$C.Reactive.Protein,alldata$cv,xlab="CRP",ylab="CV")
abline(lm(alldata$cov~alldata$C.Reactive.Protein))

plot(alldata$C.Reactive.Protein,alldata$delta_bg,xlab="CRP",ylab="Delta BG")
abline(lm(alldata$delta_bg~alldata$C.Reactive.Protein))

plot(alldata$homa_ir,alldata$max_sensor,xlab="HOMA-IR",ylab="Max sensor")
abline(lm(alldata$max_sensor~alldata$homa_ir))

plot(alldata$homa_ir,alldata$average_sensor,xlab="HOMA-IR",ylab="Mean sensor")
abline(lm(alldata$average_sensor~alldata$homa_ir))

plot(alldata$homa_ir,alldata$avg_excur_over_200_per_day,xlab="HOMA-IR",ylab="Average excursions >200 per day")
abline(lm(alldata$avg_excur_over_200_per_day~alldata$homa_ir))

plot(alldata$homa_ir,alldata$percent_time_over_140,xlab="HOMA-IR",ylab="% time >140")
abline(lm(alldata$percent_time_over_140~alldata$homa_ir))

plot(alldata$homa_ir,alldata$percent_time_over_180,xlab="HOMA-IR",ylab="% time >180")
abline(lm(alldata$percent_time_over_180~alldata$homa_ir))

plot(alldata$homa_ir,alldata$percent_time_over_200,xlab="HOMA-IR",ylab="% time >200")
abline(lm(alldata$percent_time_over_200~alldata$homa_ir))

plot(alldata$homa_ir,alldata$standard_deviation,xlab="HOMA-IR",ylab="SD")
abline(lm(alldata$standard_deviation~alldata$homa_ir))

plot(alldata$homa_ir,alldata$r_mage,xlab="HOMA-IR",ylab="MAGE")
abline(lm(alldata$r_mage~alldata$homa_ir))

```

\newpage

ROC analysis for % time >140 vs. CFRD, maximizing the Youden index, is shown below.
```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(pct140_roc)
kable(pct140_res) 
```
<br>

\newpage

ROC analysis for % time >140 vs. CFRD, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(pct140_sens$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(pct140_sens$sensitivity,2)` and the specificity is `r round(pct140_sens$specificity,2)`.  The PPV at that cutpoint is `r round(pct140_sens_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(pct140_sens)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$percent_time_over_140<pct140_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$percent_time_over_140>=pct140_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

number below cutpoint: `r nrow(alldata[which(alldata$percent_time_over_140<pct140_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`
number above cutpoint: `r nrow(alldata[which(alldata$percent_time_over_140>=pct140_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`

\newpage

ROC analysis for % time >140 vs. CFRD, while maintaining the minimum sensitivity at 90%, resulted in a cutpoint of `r round(pct140_sens90$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(pct140_sens90$sensitivity,2)` and the specificity is `r round(pct140_sens90$specificity,2)`.  The PPV at that cutpoint is `r round(pct140_sens90_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(pct140_sens90)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint, with minimal sensitivity=90%.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$percent_time_over_140<pct140_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$percent_time_over_140>=pct140_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")

```
<br>

number below cutpoint: `r nrow(alldata[which(alldata$percent_time_over_140<pct140_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`
number above cutpoint: `r nrow(alldata[which(alldata$percent_time_over_140>=pct140_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`

\newpage

ROC analysis for % time >180 vs. CFRD  is shown below.
```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(pct180_roc)
kable(pct180_res)

```
<br>

\newpage

ROC analysis for % time >180 vs. CFRD, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(pct180_sens$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(pct180_sens$sensitivity,2)` and the specificity is `r round(pct180_sens$specificity,2)`.  The PPV at that cutpoint is `r round(pct180_sens_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(pct180_sens)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$percent_time_over_180<pct180_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$percent_time_over_180>=pct180_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

number below cutpoint: `r nrow(alldata[which(alldata$percent_time_over_180<pct180_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`
number above cutpoint: `r nrow(alldata[which(alldata$percent_time_over_180>=pct180_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`

\newpage

When maximizing specificity while maintaining sensitivity at 90%, the same cutoff was obtained as when maintaining the cost of a false negative at 30 times that of a false positive.

\newpage

ROC analysis for % time >200 vs. CFRD  is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(pct200_roc)
kable(pct200_res)

```
<br>

\newpage

ROC analysis for % time >200 vs. CFRD, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(pct200_sens$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(pct200_sens$sensitivity,2)` and the specificity is `r round(pct200_sens$specificity,2)`.  The PPV at that cutpoint is `r round(pct200_sens_ppv,2)`.The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(pct200_sens)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$percent_time_over_200<pct200_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$percent_time_over_200>=pct200_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

number below cutpoint: `r nrow(alldata[which(alldata$percent_time_over_200<pct200_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`
number above cutpoint: `r nrow(alldata[which(alldata$percent_time_over_200>=pct200_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`

\newpage

When maximizing specificity while maintaining sensitivity at 90%, the same cutoff was obtained as when maintaining the cost of a false negative at 30 times that of a false positive.

\newpage

ROC analysis for excursions >200  vs. CFRD is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(ex200_roc)
kable(ex200_res)

```
<br>

\newpage

ROC analysis for excursions >200 vs. CFRD, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(ex200_sens$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(ex200_sens$sensitivity,2)` and the specificity is `r round(ex200_sens$specificity,2)`.  The PPV at that cutpoint is `r round(ex200_sens_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(ex200_sens)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$excursions_over_200<ex200_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$excursions_over_200>=ex200_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

number below cutpoint: `r nrow(alldata[which(alldata$excursions_over_200<ex200_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`
number above cutpoint: `r nrow(alldata[which(alldata$excursions_over_200>=ex200_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`

\newpage

When maximizing specificity while maintaining sensitivity at 90%, the same cutoff was obtained as when maintaining the cost of a false negative at 30 times that of a false positive.

\newpage

ROC analysis for average sensor glucose vs. CFRD  is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(average_roc)
kable(average_res)

```
<br>

\newpage

ROC analysis for average sensor glucose vs. CFRD, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(average_sens$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(average_sens$sensitivity,2)` and the specificity is `r round(average_sens$specificity,2)`.  The PPV at that cutpoint is `r round(average_sens_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(average_sens)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$average_sensor<average_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$average_sensor>=average_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

number below cutpoint: `r nrow(alldata[which(alldata$average_sensor<average_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`
number above cutpoint: `r nrow(alldata[which(alldata$average_sensor>=average_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`

\newpage

ROC analysis for average sensor glucose vs. CFRD, while maintaining the minimum sensitivity at 90%, resulted in a cutpoint of `r round(average_sens90$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(average_sens90$sensitivity,2)` and the specificity is `r round(average_sens90$specificity,2)`.  The PPV at that cutpoint is `r round(average_sens90_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(average_sens90)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint, while maintaining the minimum sensitivity at 90%.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$average_sensor<average_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$average_sensor>=average_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

number below cutpoint: `r nrow(alldata[which(alldata$average_sensor<average_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`
number above cutpoint: `r nrow(alldata[which(alldata$average_sensor>=average_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`

\newpage

ROC analysis for maximum sensor glucose  vs. CFRD is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(max_roc)
kable(max_res)

```
<br>

\newpage

ROC analysis for maximum sensor glucose vs. CFRD, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(max_sens$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(max_sens$sensitivity,2)` and the specificity is `r round(max_sens$specificity,2)`.  The PPV at that cutpoint is `r round(max_sens_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(max_sens)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$max_sensor<max_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$max_sensor>=max_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

number below cutpoint: `r nrow(alldata[which(alldata$max_sensor<max_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`
number above cutpoint: `r nrow(alldata[which(alldata$max_sensor>=max_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`

\newpage

ROC analysis for maximum sensor glucose vs. CFRD, while maintaining minimum sensitivity at 90%, resulted in a cutpoint of `r round(max_sens90$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(max_sens90$sensitivity,2)` and the specificity is `r round(max_sens90$specificity,2)`.  The PPV at that cutpoint is `r round(max_sens90_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(max_sens90)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint, while maintaining the minimum sensitivity at 90%.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$max_sensor<max_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$max_sensor>=max_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

number below cutpoint: `r nrow(alldata[which(alldata$max_sensor<max_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`
number above cutpoint: `r nrow(alldata[which(alldata$max_sensor>=max_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`

\newpage

ROC analysis for SD vs. CFRD is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(sd_roc)
kable(sd_res)

```
<br>

\newpage

ROC analysis for SD vs. CFRD, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(sd_sens$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(sd_sens$sensitivity,2)` and the specificity is `r round(sd_sens$specificity,2)`.  The PPV at that cutpoint is `r round(sd_sens_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(sd_sens)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$standard_deviation<sd_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$standard_deviation>=sd_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

number below cutpoint: `r nrow(alldata[which(alldata$standard_deviation<sd_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`
number above cutpoint: `r nrow(alldata[which(alldata$standard_deviation>=sd_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`

\newpage

ROC analysis for SD vs. CFRD, while maintaining the minimum sensitivity at 90%, resulted in a cutpoint of `r round(sd_sens90$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(sd_sens90$sensitivity,2)` and the specificity is `r round(sd_sens90$specificity,2)`.  The PPV at that cutpoint is `r round(sd_sens90_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(sd_sens90)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint, while maintaining the minimum sensitivity at 90%.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$standard_deviation<sd_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$standard_deviation>=sd_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

number below cutpoint: `r nrow(alldata[which(alldata$standard_deviation<sd_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`
number above cutpoint: `r nrow(alldata[which(alldata$standard_deviation>=sd_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`

\newpage

ROC analysis for CV vs. CFRD  is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(cv_roc)
kable(cv_res)

```
<br>

\newpage

ROC analysis for CV vs. CFRD, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(cv_sens$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(cv_sens$sensitivity,2)` and the specificity is `r round(cv_sens$specificity,2)`.  The PPV at that cutpoint is `r round(cv_sens_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(cv_sens)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$cov<cv_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$cov>=cv_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

number below cutpoint: `r nrow(alldata[which(alldata$cov<cv_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`
number above cutpoint: `r nrow(alldata[which(alldata$cov>=cv_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`

\newpage

When maximizing specificity while maintaining sensitivity at 90%, the same cutoff was obtained as when maintaining the cost of a false negative at 30 times that of a false positive.

\newpage

ROC analysis for MAGE  vs. CFRD is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(mage_roc)
kable(mage_res)

```
<br>

\newpage

ROC analysis for MAGE vs. CFRD, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(mage_sens$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(mage_sens$sensitivity,2)` and the specificity is `r round(mage_sens$specificity,2)`.  The PPV at that cutpoint is `r round(mage_sens_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(mage_sens)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$r_mage<mage_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$r_mage>=mage_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

number below cutpoint: `r nrow(alldata[which(alldata$r_mage<mage_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`
number above cutpoint: `r nrow(alldata[which(alldata$r_mage>=mage_sens$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`

\newpage

ROC analysis for MAGE vs. CFRD, while maintaining minimum sensitivity at 90%, resulted in a cutpoint of `r round(mage_sens90$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(mage_sens90$sensitivity,2)` and the specificity is `r round(mage_sens90$specificity,2)`.  The PPV at that cutpoint is `r round(mage_sens90_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(mage_sens90)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$r_mage<mage_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$r_mage>=mage_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

number below cutpoint: `r nrow(alldata[which(alldata$r_mage<mage_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`
number above cutpoint: `r nrow(alldata[which(alldata$r_mage>=mage_sens90$optimal_cutpoint & alldata$group_category.factor != "Healthy Control"),])`


\newpage

ROC analysis for % time >140 vs. prediabetes is shown below.
```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(pct140_roc_pre)
kable(pct140_res_pre) 

```
<br>

\newpage

ROC analysis for % time >140 vs. prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(pct140_sens_pre$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(pct140_sens_pre$sensitivity,2)` and the specificity is `r round(pct140_sens_pre$specificity,2)`.  The PPV at that cutpoint is `r round(pct140_sens_pre_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(pct140_sens_pre)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$percent_time_over_140<pct140_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$percent_time_over_140>=pct140_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for % time >180 vs. prediabetes  is shown below.
```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(pct180_roc_pre)
kable(pct180_res_pre)

```
<br>

\newpage

ROC analysis for % time >180 vs. prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(pct180_sens_pre$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(pct180_sens_pre$sensitivity,2)` and the specificity is `r round(pct180_sens_pre$specificity,2)`.  The PPV at that cutpoint is `r round(pct180_sens_pre_ppv,2)`. The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(pct180_sens_pre)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$percent_time_over_180<pct180_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$percent_time_over_180>=pct180_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>


\newpage

ROC analysis for % time >200 vs. prediabetes  is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(pct200_roc_pre)
kable(pct200_res_pre)

```
<br>

\newpage

ROC analysis for % time >200 vs. prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(pct200_sens_pre$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(pct200_sens_pre$sensitivity,2)` and the specificity is `r round(pct200_sens_pre$specificity,2)`.  The PPV at that cutpoint is `r round(pct200_sens_pre_ppv,2)`. The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(pct200_sens_pre)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$percent_time_over_200<pct200_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$percent_time_over_200>=pct200_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for excursions >200  vs. prediabetes is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(ex200_roc_pre)
kable(ex200_res_pre)

```
<br>

\newpage

ROC analysis for excursions >200 vs. prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(ex200_sens_pre$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(ex200_sens_pre$sensitivity,2)` and the specificity is `r round(ex200_sens_pre$specificity,2)`. The PPV at that cutpoint is `r round(ex200_sens_pre_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(ex200_sens_pre)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$excursions_over_200<ex200_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$excursions_over_200>=ex200_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for average sensor glucose vs. prediabetes is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(average_roc_pre)
kable(average_res_pre)

```
<br>

\newpage

ROC analysis for average sensor glucose vs. prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(average_sens_pre$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(average_sens_pre$sensitivity,2)` and the specificity is `r round(average_sens_pre$specificity,2)`.  The PPV at that cutpoint is `r round(average_sens_pre_ppv,2)`. The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(average_sens_pre)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$average_sensor<average_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$average_sensor>=average_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for maximum sensor glucose  vs. prediabetes is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(max_roc_pre)
kable(max_res_pre)

```
<br>

\newpage

ROC analysis for maximum sensor glucose vs. prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(max_sens_pre$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(max_sens_pre$sensitivity,2)` and the specificity is `r round(max_sens_pre$specificity,2)`. The PPV at that cutpoint is `r round(max_sens_pre_ppv,2)`.  The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(max_sens_pre)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$max_sensor<max_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$max_sensor>=max_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for SD vs. prediabetes is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(sd_roc_pre)
kable(sd_res_pre)

```
<br>

\newpage

ROC analysis for SD vs. prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(sd_sens_pre$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(sd_sens_pre$sensitivity,2)` and the specificity is `r round(sd_sens_pre$specificity,2)`.  The PPV at that cutpoint is `r round(sd_sens_pre_ppv,2)`. The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(sd_sens_pre)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$standard_deviation<sd_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$standard_deviation>=sd_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for CV vs. prediabetes  is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(cv_roc_pre)
kable(cv_res_pre)

```
<br>

\newpage

ROC analysis for CV vs. prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(cv_sens_pre$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(cv_sens_pre$sensitivity,2)` and the specificity is `r round(cv_sens_pre$specificity,2)`.  The PPV at that cutpoint is `r round(cv_sens_pre_ppv,2)`. The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(cv_sens_pre)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$cov<cv_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$cov>=cv_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for MAGE  vs. prediabetes is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(mage_roc_pre)
kable(mage_res_pre)

```
<br>

\newpage

ROC analysis for MAGE vs. prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(mage_sens_pre$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(mage_sens_pre$sensitivity,2)` and the specificity is `r round(mage_sens_pre$specificity,2)`.  The PPV at that cutpoint is `r round(mage_sens_pre_ppv,2)`. The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(mage_sens_pre)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$r_mage<mage_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$r_mage>=mage_sens_pre$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for % time >140 vs. prediabetes or diabetes is shown below.
```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(pct140_roc_pd)
kable(pct140_res_pd) 

```
<br>

\newpage

ROC analysis for % of time >140 vs. diabetes or prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(pct140_sens_pd$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(pct140_sens_pd$sensitivity,2)` and the specificity is `r round(pct140_sens_pd$specificity,2)`.  The PPV at that cutpoint is `r round(pct140_sens_pd_ppv,2)`. The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(pct140_sens_pd)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$percent_time_over_140<pct140_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$percent_time_over_140>=pct140_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for % time >180 vs. prediabetes or diabetes  is shown below.
```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(pct180_roc_pd)
kable(pct180_res_pd)

```
<br>

\newpage

ROC analysis for % of time >180 vs. diabetes or prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(pct180_sens_pd$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(pct180_sens_pd$sensitivity,2)` and the specificity is `r round(pct180_sens_pd$specificity,2)`.  The PPV at that cutpoint is `r round(pct180_sens_pd_ppv,2)`. The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(pct180_sens_pd)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$percent_time_over_180<pct180_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$percent_time_over_180>=pct180_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for % time >200 vs. prediabetes or diabetes  is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(pct200_roc_pd)
kable(pct200_res_pd)

```
<br>

\newpage

ROC analysis for % of time >200 vs. diabetes or prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(pct200_sens_pd$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(pct200_sens_pd$sensitivity,2)` and the specificity is `r round(pct200_sens_pd$specificity,2)`.  The PPV at that cutpoint is `r round(pct200_sens_pd_ppv,2)`. The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(pct200_sens_pd)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$percent_time_over_200<pct200_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$percent_time_over_200>=pct200_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for excursions >200  vs. prediabetes or diabetes is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(ex200_roc_pd)
kable(ex200_res_pd)

```
<br>

\newpage

ROC analysis for excursions >200 vs. diabetes or prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(ex200_sens_pd$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(ex200_sens_pd$sensitivity,2)` and the specificity is `r round(ex200_sens_pd$specificity,2)`.  The PPV at that cutpoint is `r round(ex200_sens_pd_ppv,2)`. The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(ex200_sens_pd)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$excursions_over_200<ex200_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$excursions_over_200>=ex200_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for average sensor glucose vs. prediabetes or diabetes is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(average_roc_pd)
kable(average_res_pd)
```
<br>

\newpage

ROC analysis for average sensor glucose vs. diabetes or prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(average_sens_pd$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(average_sens_pd$sensitivity,2)` and the specificity is `r round(average_sens_pd$specificity,2)`.  The PPV at that cutpoint is `r round(average_sens_pd_ppv,2)`. The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(average_sens_pd)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$average_sensor<average_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$average_sensor>=average_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for maximum sensor glucose  vs. prediabetes or diabetes is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(max_roc_pd)
kable(max_res_pd)

```
<br>

\newpage

ROC analysis for maximum sensor glucose vs. diabetes or prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(max_sens_pd$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(max_sens_pd$sensitivity,2)` and the specificity is `r round(max_sens_pd$specificity,2)`.  The PPV at that cutpoint is `r round(max_sens_pd_ppv,2)`. The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(max_sens_pd)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$max_sensor<max_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$max_sensor>=max_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for SD vs. prediabetes or diabetes is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(sd_roc_pd)
kable(sd_res_pd)

```
<br>

\newpage

ROC analysis for SD vs. diabetes or prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(sd_sens_pd$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(sd_sens_pd$sensitivity,2)` and the specificity is `r round(sd_sens_pd$specificity,2)`.  The PPV at that cutpoint is `r round(sd_sens_pd_ppv,2)`. The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(sd_sens_pd)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$standard_deviation<sd_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$standard_deviation>=sd_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for CV vs. prediabetes or diabetes  is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(cv_roc_pd)
kable(cv_res_pd)

```
<br>

\newpage

ROC analysis for CV vs. diabetes or prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(cv_sens_pd$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(cv_sens_pd$sensitivity,2)` and the specificity is `r round(cv_sens_pd$specificity,2)`.  The PPV at that cutpoint is `r round(cv_sens_pd_ppv,2)`. The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(cv_sens_pd)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$cov<cv_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$cov>=cv_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

ROC analysis for MAGE  vs. prediabetes or diabetes is shown below.

```{r, results='asis',tidy=TRUE, echo=FALSE}
plot(mage_roc_pd)
kable(mage_res_pd)

```
<br>

\newpage

ROC analysis for MAGE vs. diabetes or prediabetes, while maintaining the cost of a false negative at 30 times that of a false positive, resulted in a cutpoint of `r round(mage_sens_pd$optimal_cutpoint,2)`.  The sensitivity of that cutpoint is `r round(mage_sens_pd$sensitivity,2)` and the specificity is `r round(mage_sens_pd$specificity,2)`.  The PPV at that cutpoint is `r round(mage_sens_pd_ppv,2)`. The plot below shows the sensitivity and specificity for all possible cutoffs.

```{r, results='asis',tidy=TRUE, echo=FALSE}
cutpointr::plot_sensitivity_specificity(mage_sens_pd)
```
<br>

\newpage

The plot below shows the distribution of 2 hour glucose for those above and below the optimal cutpoint.

```{r, results='asis',tidy=TRUE, echo=FALSE}
boxplot(alldata[alldata$r_mage<mage_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        alldata[alldata$r_mage>=mage_sens_pd$optimal_cutpoint & alldata$group_category.factor != "Healthy Control",]$lab_ogtt_2_hour_glucose,
        names = c("< cutpoint",">= cutpoint"),ylab="2 hour glucose")
```
<br>

\newpage

Overlay of ROC for diabetes

```{r, results='asis',tidy=TRUE, echo=FALSE}
customroc <- function(obj,file,title) {
  # make overlay plot for diabetes
  png(file)
  ggroc(obj, legacy.axes = T) +
    geom_abline(slope = 1 ,intercept = 0) + # add identity line
    theme(
      panel.background = element_blank(), 
      axis.title.x = element_text(size =18, face = 'bold'),
      axis.title.y = element_text(size =18, face = 'bold'),
      panel.border = element_rect(size = 2, fill = NA), 
      axis.text.x = element_text(size = 14, face ='bold'),
      axis.text.y = element_text(size = 14, face ='bold'),
      plot.title = element_text(size=18, face = "bold", hjust = 0.5)) +
    xlab('1 - Specificity') +
    ylab('Sensitivity') +
    scale_x_continuous(breaks = seq(0,1,0.1), labels = seq(0,1,0.1)) + 
    scale_y_continuous(breaks = seq(0,1,0.1), labels = seq(0,1,0.1)) + ggtitle(title)
  
}

ci_pct140roc <- ci(pct140_roc)

customroc(obj=pct140_roc,file="E:\\Christine Chan\\ADA abstract 2019\\Manuscript\\pct140_roc.png",title="% time >140 mg/dL")
dev.off()
customroc(obj=pct200_roc,file="E:\\Christine Chan\\ADA abstract 2019\\Manuscript\\pct200_roc.png",title="% time >200 mg/dL")
dev.off()
customroc(obj=average_roc,file="E:\\Christine Chan\\ADA abstract 2019\\Manuscript\\average_roc.png",title="Mean sensor glucose")
dev.off()
customroc(obj=max_roc,file="E:\\Christine Chan\\ADA abstract 2019\\Manuscript\\max_roc.png",title="Max glucose")
dev.off()
customroc(obj=sd_roc,file="E:\\Christine Chan\\ADA abstract 2019\\Manuscript\\sd_roc.png",title="SD")
dev.off()
customroc(obj=cv_roc,file="E:\\Christine Chan\\ADA abstract 2019\\Manuscript\\CV_roc.png",title="CV")
dev.off()

```
\newpage

Overlay of ROC for prediabetes

```{r, results='asis',tidy=TRUE, echo=FALSE}
# make overlay plot for prediabetes
customroc(obj=pct140_roc_pre,file="E:\\Christine Chan\\ADA abstract 2019\\Manuscript\\pct140_roc_pre.png",title="% time >140 mg/dL")
dev.off()
customroc(obj=pct200_roc_pre,file="E:\\Christine Chan\\ADA abstract 2019\\Manuscript\\pct200_roc_pre.png",title="% time >200 mg/dL")
dev.off()
customroc(obj=average_roc_pre,file="E:\\Christine Chan\\ADA abstract 2019\\Manuscript\\average_roc_pre.png",title="Mean sensor glucose")
dev.off()
customroc(obj=max_roc_pre,file="E:\\Christine Chan\\ADA abstract 2019\\Manuscript\\max_roc_pre.png",title="Max glucose")
dev.off()
customroc(obj=sd_roc_pre,file="E:\\Christine Chan\\ADA abstract 2019\\Manuscript\\sd_roc_pre.png",title="SD")
dev.off()
customroc(obj=cv_roc_pre,file="E:\\Christine Chan\\ADA abstract 2019\\Manuscript\\CV_roc_pre.png",title="CV")
dev.off()


```

\newpage

The tables below compare calprotectin and CRP in the lowest and highest tertiles of CV, MAGE, and delta BG.

```{r, results='asis',tidy=TRUE, echo=FALSE}
kable(tab_cal_crp_cov,caption = "Calprotectin and CRP in the lowest (1) and highest (3) tertiles of CV.")
```
<br>

```{r, results='asis',tidy=TRUE, echo=FALSE}
kable(tab_cal_crp_mage,caption = "Calprotectin and CRP in the lowest (1) and highest (3) tertiles of MAGE.")
```
<br>

```{r, results='asis',tidy=TRUE, echo=FALSE}
kable(tab_cal_crp_delta,caption = "Calprotectin and CRP in the lowest (1) and highest (3) tertiles of delta BG.")
```
<br>

The table below compares insulin clearance by sex in CF patients only.

```{r, results='asis',tidy=TRUE, echo=FALSE}
kable(tab_insclear,caption = "Insulin clearance by sex in CF patients.")
```
<br>

