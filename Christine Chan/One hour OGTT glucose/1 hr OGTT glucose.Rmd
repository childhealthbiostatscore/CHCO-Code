---
title: "1 hour OGTT glucose"
author: "Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(knitr)
library(rspiro)
library(dplyr)

# read data
data <- read.csv("E:\\Christine Chan\\1 hour OGTT in CFRD\\Data_raw\\Longitudinal Modeling to Determine the Viability of 1 Hour Oral Glucose Tolerance Test for Cystic Fibrosis Related Diabetes Screening Data.csv")

# remove PFT data - had been merged incorrectly
data <-data[, !names(data) %in%  c("FEV1...Pred","FVC...Pred","FEF.25.75...Pred","FVC.Raw","FEV1.Raw","FEF.25.75.Raw",
                                   "Adjusted.Date.of.OGTT","FName","LName")]
data$True.Date.of.OGTT <- as.Date(as.character(data$True.Date.of.OGTT),format="%m/%d/%Y")
data <- data[with(data, order(MRN, True.Date.of.OGTT)),]
data$Date.of.OGTT <- data$True.Date.of.OGTT
data$True.Date.of.OGTT <- NULL

# get date of first OGTT (i.e., baseline)
first_ogtt <- data  %>%  group_by(MRN) %>% filter(row_number()==1)
first_ogtt <- first_ogtt[,c("MRN","Date.of.OGTT")]
colnames(first_ogtt) <- c("MRN","Date.of.First.OGTT")

# read in PFT data
pfts <- read.csv("E:\\Christine Chan\\1 hour OGTT in CFRD\\Data_raw\\CFRD PFTs.csv")
pfts$Date.of.OGTT <- NULL
pfts$Date.of.PFT <- as.Date(as.character(pfts$Date.of.PFT),format="%m/%d/%Y")

# merge date of first OGTT with PFTs to try and find baseline PFTs
pfts_first_ogtt <- merge(pfts,first_ogtt,by="MRN",all.x=F,all.y=T)
# is PFT within 1 month of first OGTT?
pfts_first_ogtt$datediff <- pfts_first_ogtt$Date.of.First.OGTT - pfts_first_ogtt$Date.of.PFT
pfts_first_ogtt$within_1_mo <- ifelse(abs(pfts_first_ogtt$datediff)<=30,1,0)
# for "baseline PFT" we want to keep only those within 1 mo
baseline_pft <- pfts_first_ogtt[pfts_first_ogtt$within_1_mo==1,]
# if people have more than 1 PFT within 1 month of first OGTT, keep earlies
baseline_pft <- baseline_pft[with(baseline_pft, order("MRN", "Date.of.PFT")),]


data <- merge(data,first_ogtt)


# merge by date of OGTT
test <- merge(data,pfts,by=c("MRN","Date.of.OGTT"),all.x = T, all.y = T)

# keep only MRNs that exist in OGTT data
keep <- first_ogtt[,"MRN"]
test <- test[test$MRN %in% keep$MRN,]



```


```{r, echo=FALSE}
kable(hctab,caption = "Table 1a.  Descriptive statistics for healthy controls by Tanner stage.")
```
<br>

