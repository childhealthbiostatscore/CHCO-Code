---
title: "1 hour OGTT glucose"
author: "Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(knitr)
library(rspiro)
library(dplyr)

# read in separate data files

ogtt <- read.csv("E:\\Christine Chan\\1 hour OGTT in CFRD\\Data_raw\\ogtt.csv")
pft <- read.csv("E:\\Christine Chan\\1 hour OGTT in CFRD\\Data_raw\\pfts.csv")
a1c <- read.csv("E:\\Christine Chan\\1 hour OGTT in CFRD\\Data_raw\\a1c.csv")
demo <- read.csv("E:\\Christine Chan\\1 hour OGTT in CFRD\\Data_raw\\demographics.csv")

# checking for dups
t <- ogtt[,c("MRN","FName","LName")]
t <- unique(t)
ct <- t %>% group_by(LName,FName) %>% count(unique(MRN))

# merge ogtt and demo
demo$FName <- NULL
demo$LName <- NULL
ogtt_demo <- merge(ogtt,demo,by="MRN",all.x = T, all.y = T)

# merge ogtt, demo, and A1c
ogtt_demo$Date <- ogtt_demo$Date.of.OGTT
ogtt_demo$Date.of.OGTT <- NULL
a1c$Date.of.OGTT <- NULL
a1c$Days.Between.A1C.and.OGTT <- NULL
a1c$Date <- a1c$Date.of.A1C
a1c$Date.of.A1C  <- NULL
a1c$FName <- NULL
a1c$LName <- NULL
ogtt_demo_a1c <- merge(ogtt_demo,a1c,by=c("MRN","Date"),all.x=T,all.y=T)

# add in PFTs
pft$Date.of.OGTT <- NULL
pft$FName <- NULL
pft$LName <- NULL
pft$Date <- pft$Date.of.PFT
pft$Date.of.PFT <- NULL
alldata <- merge(ogtt_demo_a1c,pft,by=c("MRN","Date"),all.x=T,all.y=T)

# merge back all baseline characteristics
d <- alldata[,c("MRN","FName","LName","Sex","Race","Latino.a.","Mutation.1","Mutation.2")]
d <- d[!is.na(d$FName),]
d <- unique(d)
alldata$FName <- NULL
alldata$Latino.a. <- NULL
alldata$LName <- NULL
alldata$Sex <- NULL
alldata$Race <- NULL
alldata$Mutation.1 <- NULL
alldata$Mutation.2 <- NULL
alldata <- merge(alldata,d,by="MRN",all.x = T,all.y = T)

# checking for dups
t <- alldata[,c("MRN","FName","LName")]
t <- unique(t)
ct <- t %>% group_by(LName,FName) %>% count(unique(MRN))

# reorder columns
alldata <- alldata[,c(1,16:22,2:15)]

# find first OGTT
o <- alldata[!is.na(alldata$Age.At.Test..years.),c("MRN","Date")]
o <- o[order(o$MRN,o$Date),]
o <- o %>% group_by(MRN) %>% filter(row_number() == 1)
colnames(o) <- c("MRN","Date of first OGTT")
alldata <- merge(alldata,o,by="MRN",all.x = T,all.y = T)
alldata <- alldata[,c(1:8,23,9:22)]

# remove all visits before first OGTT
alldata$Date <- as.Date(as.character(alldata$Date),format="%m/%d/%Y")
alldata$`Date of first OGTT` <- as.Date(as.character(alldata$`Date of first OGTT`),format="%m/%d/%Y")
alldata <- alldata[alldata$Date >= alldata$`Date of first OGTT`,]

# calculate BMI
alldata$BMI <- alldata$Weight..kg./((alldata$Height..cm./100)^2)

# get predicted spirometry values
alldata$FVC...Pred <- NULL
alldata$FEV1...Pred <- NULL
alldata$FEF.25.75...Pred <- NULL
a <- pred_GLI(age="Age")

```


```{r, echo=FALSE}
kable(hctab,caption = "Table 1a.  Descriptive statistics for healthy controls by Tanner stage.")
```
<br>

