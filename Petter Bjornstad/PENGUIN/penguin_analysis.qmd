---
title: "PENGUIN Analysis"
author: "Tim Vigers"
date: "`r format(Sys.time(), '%d %B %Y')`"
format:
  html:
    page-layout: full
    toc: true
    toc-depth: 5
    toc-float: true
    self-contained: true
    code-fold: true
editor: visual
---

```{python}
import pandas as pd
import numpy as np
# Import
df = pd.read_csv("/Volumes/Work/CHCO/Petter Bjornstad/Data Harmonization/Data Clean/harmonized_dataset.csv",low_memory=False)
# Subset to CROCODILE and PENGUIN
df = df.loc[df["study"].isin(["CROCODILE","PENGUIN"])]
df = df.loc[df["group"] != "Type 1 Diabetes"]
# Get variables of interest
var_names = {"record_id":"ID","visit":"Visit","group":"Group","sex":"Gender","race":"Race","age":"Age","height":"Height","weight":"Weight","bmi":"BMI","sbp":"SBP","dbp":"DBP","pulse":"Pulse","creatinine_s":"Serum Creatinine","eGFR_CKD_epi":"eGFR","acr_u":"UACR","ace_inhibitor":"ACEi","angiotensin_receptor_blocker":"Angiotensin Receptor Blocker","beta_blocker":"Beta Blocker","ca_channel_blocker":"Ca Channel Blocker","diuretic":"Diuretic","statin":"Statin"}
df = df[list(var_names.keys())]
# Group rows by visit, get non-missing values
df["visit"] = df["visit"].replace({"pre_surgery": "baseline"})
df = df.groupby(by=["record_id", "visit"]).agg("last").reset_index()
```

```{python}
#| label: histograms
import seaborn as sns
import matplotlib.pyplot as plt
hist_vars = df.select_dtypes(include=np.number).columns.tolist()
for v in hist_vars:
  ax = sns.displot(df, x=v, hue="group", element="step")
  ax.set(xlabel=var_names[v])
  plt.show()
```

```{python}
#| label: table1
from tableone import TableOne
cat = ["sex","race","ace_inhibitor","angiotensin_receptor_blocker","beta_blocker","ca_channel_blocker","diuretic","statin"]
groupby = "group"
nn = ["acr_u", "creatinine_s", "dbp"]
mytable = TableOne(df,list(var_names.keys())[3:], cat, groupby,nonnormal=nn,
pval=True,dip_test=True, normal_test=True, tukey_test=True)
mytable
```

