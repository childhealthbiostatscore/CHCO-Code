---
title: "TODAY adenine analyses"
author: "Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    number_sections: yes
    theme: readable
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r setup, include=FALSE}
library(limma)
library(dplyr)
library(caret)
library(purrr)
library(multtest)
library(openxlsx)
library(tableone)
library(EnhancedVolcano)
library(knitr)
library(arsenal)

knitr::opts_chunk$set(echo = FALSE,warning = FALSE)

knitr::opts_chunk$set(echo = FALSE)
if(Sys.info()["sysname"] == "Windows"){
  home_dir = "E:/Petter Bjornstad/TODAY subaward"
} else if (Sys.info()["sysname"] == "Linux"){
  home_dir = "~/UCD/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/Peds Endo/Petter Bjornstad/TODAY subaward/"
} else if (Sys.info()["sysname"] == "Darwin"){
  home_dir = ""
}
knitr::opts_knit$set(root.dir = home_dir)
```

```{r, include=FALSE}
# load urine and plasma data
load("./Metabolomic data/urine.Rdata")
load("./Metabolomic data/plasma.Rdata")
urine$Date.Drawn <- as.Date(urine$Date.Drawn,format = "%m/%d/%Y")
plasma$Date.Drawn <- as.Date(plasma$Date.Drawn,format = "%m/%d/%Y")

# load comorbidity data
load("./Clinical data/comorb.Rdata")

# take only the baseline samples
# can we just take the earliest or is it possible someone would have a follow-up sample but not baseline?
# probably can take the first and then check the years to make sure compatible with TODAY
urine_base <- urine %>% arrange(releaseid,Date.Drawn) %>% group_by(releaseid) %>% filter(row_number()==1)
plasma_base <- plasma %>% arrange(releaseid,Date.Drawn) %>% group_by(releaseid) %>% filter(row_number()==1)

# merge in comorb data
urine_base <- merge(urine_base, comorb, by="releaseid",all.x=T, all.y=F)
plasma_base <- merge(plasma_base, comorb, by="releaseid",all.x=T, all.y=F)

# note that plasma adenine has no variability
# for the later analyses (i.e., after adenine, definitely want to check for low variability)
# for the rest of these adenine analyses, will focus on urine results only
```

# Questions/comments

- There was no variability in plasma adenine, so these analyses focus on urine adenine results only.

# Results

## Microalbuminuria

```{r, include=FALSE}
# urine adenine by microalbuminuria status
mic_table <- CreateTableOne(data=urine_base, vars="Adenine.in.uM.mM.Creatinine", strata = "MIC")
mic_table <- print(mic_table, nonnormal = "Adenine.in.uM.mM.Creatinine")
```

```{r echo=FALSE, include=TRUE}
kable(mic_table)
```

```{r, include=FALSE}
mic_table <- tableby(data=urine_base, MIC ~ Adenine.in.uM.mM.Creatinine, numeric.test="kwt")
```

```{r echo=FALSE, include=TRUE, results='asis'}
summary(mic_table)
```

## Macroalbuminuria

```{r, include=FALSE}
# urine adenine by macroalbumuniuria status
mac_table <- CreateTableOne(data=urine_base, vars="Adenine.in.uM.mM.Creatinine", strata = "MAC")
mac_table <- print(mac_table, nonnormal = "Adenine.in.uM.mM.Creatinine")
```

```{r echo=FALSE, include=TRUE}
kable(mac_table)
```

## Hyperfiltration

```{r, include=FALSE}
# urine adenine by hyperfiltration status
hyper_table <- CreateTableOne(data=urine_base, vars="Adenine.in.uM.mM.Creatinine", strata = "HYP")
hyper_table <- print(hyper_table, nonnormal = "Adenine.in.uM.mM.Creatinine")
```

```{r echo=FALSE, include=TRUE}
kable(hyper_table)
```

## Rapid eGFR decline

```{r, include=FALSE}
# urine adenine by rapid eGFR decline status
rapid_table <- CreateTableOne(data=urine_base, vars="Adenine.in.uM.mM.Creatinine", strata = "RAPID")
rapid_table <- print(rapid_table, nonnormal = "Adenine.in.uM.mM.Creatinine")
```

```{r echo=FALSE, include=TRUE}
kable(rapid_table)
```

## Hypertension

```{r, include=FALSE}
# urine adenine by hypertension status
htn_table <- CreateTableOne(data=urine_base, vars="Adenine.in.uM.mM.Creatinine", strata = "HTN")
htn_table <- print(htn_table, nonnormal = "Adenine.in.uM.mM.Creatinine")
```

```{r echo=FALSE, include=TRUE}
kable(htn_table)
```

## Neuropathy

```{r, include=FALSE}
# urine adenine by neuropathy status
neuro_table <- CreateTableOne(data=urine_base, vars="Adenine.in.uM.mM.Creatinine", strata = "NEURO")
neuro_table <- print(neuro_table, nonnormal = "Adenine.in.uM.mM.Creatinine")
```

```{r echo=FALSE, include=TRUE}
kable(neuro_table)
```

## Retinopathy

```{r, include=FALSE}
# urine adenine by retinopathy status
retino_table <- CreateTableOne(data=urine_base, vars="Adenine.in.uM.mM.Creatinine", strata = "RETINO")
retino_table <- print(retino_table, nonnormal = "Adenine.in.uM.mM.Creatinine")
```

```{r echo=FALSE, include=TRUE}
kable(retino_table)
```
