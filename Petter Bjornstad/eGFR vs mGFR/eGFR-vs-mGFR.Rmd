---
title: "eGFR vs. mGFR"
author: "Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    number_sections: yes
    theme: readable
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r setup, include=FALSE}
library(dplyr)
library(tableone)
library(knitr)
library(performance)
library(car)
library(ggplot2)

knitr::opts_chunk$set(echo = FALSE)
if(Sys.info()["sysname"] == "Windows"){
  home_dir = "E:/Petter Bjornstad/eGFR vs mGFR/Data raw"
} else if (Sys.info()["sysname"] == "Linux"){
  home_dir = "~/UCD/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects"
} else if (Sys.info()["sysname"] == "Darwin"){
  home_dir = "/Volumes/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/Peds Endo/Petter Bjornstad/eGFR vs mGFR/Data raw"
}
knitr::opts_knit$set(root.dir = home_dir)
rm(home_dir)
```

```{r, include=FALSE}
# read in data

###############
#  CROCODILE  #
###############

# CYSTATIN-C IS CURRENTLY MISSING SO SET TO NA - WILL NEED TO FIX THIS LATER

# CROCODILE
crocodile <- read.csv("./CROCODILE-EGFRVsMGFR_DATA_2022-02-25_1840.csv")
crocodile$gfr <- crocodile$gfr_raw
crocodile$gfr_raw <- NULL
crocodile$age <- crocodile$age_consent
crocodile$age_consent <- NULL
crocodile$sex_MF <- ifelse(crocodile$sex==1,"M",
                           ifelse(!is.na(crocodile$sex),"F",NA))
crocodile$sex <- NULL
# did anyone check more than one race/ethnicity category
crocodile$race_sum <- rowSums(crocodile[,c("race___1","race___2","race___3","race___4","race___5","race___6","race___7")],na.rm = T)
# create new race/ethnicity variable
# anyone who checked Hispanic ethnicity will be considered Hispanic
crocodile$race_eth <- ifelse(crocodile$ethnicity___1==1,"Hispanic/Latino",
                             ifelse(crocodile$race_sum>1,"Other",
                                    ifelse(crocodile$race___1==1,"American Indian/Alaska Native",
                                           ifelse(crocodile$race___2==1,"Asian",
                                                  ifelse(crocodile$race___3==1,"Hawaiian/Pacific Islander",
                                                    ifelse(crocodile$race___4==1,"Black/African American",
                                                         ifelse(crocodile$race___5==1,"White",
                                                                ifelse(crocodile$race___6==1,"Other","Unknown"))))))))
crocodile <- crocodile %>% select(-c(ethnicity___1,ethnicity___2,ethnicity___3,race___1,race___2,race___3,race___4,race___5,
                                     race___6,race___7,race_other,race_sum))
crocodile$clamp_weight <- crocodile$clamp_wt
crocodile$clamp_wt <- NULL
crocodile$clamp_height <- crocodile$clamp_ht
crocodile$clamp_ht <- NULL
crocodile$leanmass_kg <- NULL
crocodile$fatmass_kg <- NULL
crocodile$clamp_sbp <- crocodile$visit_sbp
crocodile$clamp_dbp <- crocodile$visit_dbp
crocodile$clamp_map <- crocodile$phys_map
crocodile$visit_dbp <- NULL
crocodile$visit_sbp <- NULL
crocodile$phys_map <- NULL
crocodile$length_of_diabetes <- crocodile$diabetes_duration
crocodile$diabetes_duration <- NULL
crocodile$fbg <- crocodile$bl_bg
crocodile$bl_bg <- NULL
crocodile$hba1c <- crocodile$bl_a1c
crocodile$bl_a1c <- NULL
crocodile$serum_creatinine <- crocodile$bl_creatinine_s
crocodile$bl_creatinine_s <- NULL
crocodile$cystatin_c <- NA
crocodile$clamp_acr_baseline <- crocodile$bl_uacr
crocodile$bl_uacr <- NULL
crocodile$subject_id <- crocodile$record_id
crocodile$record_id <- NULL
crocodile$study <- "CROCODILE"
# read in group info
crocgroups <- read.csv("./CROCODILE-Groups_DATA_2022-03-23_2222.csv")
crocgroups$subject_id <- crocgroups$record_id
crocgroups$record_id <- NULL
crocodile <- merge(crocodile,crocgroups,by="subject_id")
crocodile$group <- ifelse(crocodile$group==1, "T1D", "Lean control")

############
#  CASPER  #
############

# CASPER
casper <-  read.csv("./CASPER-EGFRVsMGFR_DATA_2022-02-25_1839.csv")
casper$age <- casper$age_current
casper$age_current <- NULL
casper$sex_MF <- ifelse(casper$gender==1,"M",
                           ifelse(!is.na(casper$gender),"F",NA))
casper$gender <- NULL
# did anyone check more than one race/ethnicity category - yes, 2 people
casper$race_sum <- rowSums(casper[,c("race___1","race___2","race___3","race___4","race___5","race___6","race___7")],na.rm = T)
# create new race/ethnicity variable
# anyone who checked Hispanic ethnicity will be considered Hispanic
casper$race_eth <- ifelse(casper$ethnicity___1==1,"Hispanic/Latino",
                             ifelse(casper$race_sum>1,"Other",
                                    ifelse(casper$race___1==1,"American Indian/Alaska Native",
                                           ifelse(casper$race___2==1,"Asian",
                                                  ifelse(casper$race___3==1,"Hawaiian/Pacific Islander",
                                                    ifelse(casper$race___4==1,"Black/African American",
                                                         ifelse(casper$race___5==1,"White",
                                                                ifelse(casper$race___6==1,"Other","Unknown"))))))))
casper <- casper %>% select(-c(ethnicity___1,ethnicity___2,ethnicity___3,race___1,race___2,race___3,race___4,race___5,
                                     race___6,race___7,other_races,race_sum))
casper$leanmass_percent <- casper$lean_mass
casper$bodyfat_percent <- casper$body_fat
casper$lean_kg <- NULL
casper$lean_mass <- NULL
casper$fat_kg <- NULL
casper$body_fat <- NULL
casper$hba1c <- casper$clamp_a1c
casper$clamp_a1c <- NULL
casper$study <- "CASPER"
casper$group <- "T1D"

############
#  COFFEE  #
############

# COFFEE - get DXA from CASEPER
coffee <- read.csv("./COFFEE-EGFRVsMGFR_DATA_2022-02-25_1841.csv")
coffee_dxa <- read.csv("./CASPER-BaselineCOFFEEDXAs_DATA_2022-02-25_1837.csv")
# get coffee IDs for merging with other COFFEE data
link <-  read.csv("./coffee casper link.csv")
link$subject_id <- link$ID.CASPER
coffee_dxa <- merge(coffee_dxa,link,by="subject_id",all.x = T, all.y = T)
coffee_dxa <- coffee_dxa %>% select(!(c(subject_id,ID.CASPER)))
coffee_dxa$subject_id <- coffee_dxa$ID.COFFEE
coffee_dxa <- coffee_dxa %>% select(!(ID.COFFEE))
coffee <- merge(coffee,coffee_dxa,by="subject_id",all.x = T,all.y = T)
coffee$gfr <- coffee$gfr_abs
coffee$gfr_abs <- NULL
coffee$age <- coffee$age_current
coffee$age_current <- NULL
coffee$sex_MF <- ifelse(coffee$gender==1,"M",
                           ifelse(!is.na(coffee$gender),"F",NA))
coffee$gender <- NULL
# did anyone check more than one race/ethnicity category 
coffee$race_sum <- rowSums(coffee[,c("race___1","race___2","race___3","race___4","race___5","race___6","race___7")],na.rm = T)
# create new race/ethnicity variable
# anyone who checked Hispanic ethnicity will be considered Hispanic
coffee$race_eth <- ifelse(coffee$ethnicity___1==1,"Hispanic/Latino",
                             ifelse(coffee$race_sum>1,"Other",
                                    ifelse(coffee$race___1==1,"American Indian/Alaska Native",
                                           ifelse(coffee$race___2==1,"Asian",
                                                  ifelse(coffee$race___3==1,"Hawaiian/Pacific Islander",
                                                    ifelse(coffee$race___4==1,"Black/African American",
                                                         ifelse(coffee$race___5==1,"White",
                                                                ifelse(coffee$race___6==1,"Other","Unknown"))))))))
coffee <- coffee %>% select(-c(ethnicity___1,ethnicity___2,ethnicity___3,race___1,race___2,race___3,race___4,race___5,
                                     race___6,race___7,other_races,race_sum))
coffee$leanmass_percent <- coffee$lean_mass
coffee$bodyfat_percent <- coffee$body_fat
coffee$lean_kg <- NULL
coffee$lean_mass <- NULL
coffee$fat_kg <- NULL
coffee$body_fat <- NULL
coffee$cf_clamp_date <- NULL
coffee$study <- "COFFEE"
coffee$group <- "T1D"

################
#  RENAL-HEIR  #
################

# RENAL-HEIR
renal_heir <- read.csv("./RENALHEIR-EGFRVsMGFR_DATA_2022-02-25_1841.csv")
renal_heir$age <- renal_heir$age_current
renal_heir$age_current <- NULL
renal_heir$sex_MF <- ifelse(renal_heir$gender==1,"M",
                           ifelse(!is.na(renal_heir$gender),"F",NA))
renal_heir$gender <- NULL
# did anyone check more than one race/ethnicity category - yes, 4 people
renal_heir$race_sum <- rowSums(renal_heir[,c("race___1","race___2","race___3","race___4","race___5","race___6","race___7")],na.rm = T)
# create new race/ethnicity variable
# anyone who checked Hispanic ethnicity will be considered Hispanic
renal_heir$race_eth <- ifelse(renal_heir$ethnicity___1==1,"Hispanic/Latino",
                             ifelse(renal_heir$race_sum>1,"Other",
                                    ifelse(renal_heir$race___1==1,"American Indian/Alaska Native",
                                           ifelse(renal_heir$race___2==1,"Asian",
                                                  ifelse(renal_heir$race___3==1,"Hawaiian/Pacific Islander",
                                                    ifelse(renal_heir$race___4==1,"Black/African American",
                                                         ifelse(renal_heir$race___5==1,"White",
                                                                ifelse(renal_heir$race___6==1,"Other","Unknown"))))))))
renal_heir <- renal_heir %>% select(-c(ethnicity___1,ethnicity___2,ethnicity___3,race___1,race___2,race___3,race___4,race___5,
                                     race___6,race___7,other_races,race_sum))
renal_heir$leanmass_percent <- renal_heir$lean_mass
renal_heir$bodyfat_percent <- renal_heir$body_fat
renal_heir$lean_kg <- NULL
renal_heir$lean_mass <- NULL
renal_heir$fat_kg <- NULL
renal_heir$body_fat <- NULL
renal_heir$study <- "RENAL HEIR"
# read in group info
rhgroups <- read.csv("./RENALHEIR-Groups_DATA_2022-03-23_2224.csv")
renal_heir <- merge(renal_heir,rhgroups,by="subject_id")
renal_heir$group <- ifelse(renal_heir$group==2, "T2D",
                           ifelse(renal_heir$group==3,"Obese control","Lean control"))

############
#  IMPROVE #
############

# IMPROVE
improve <- read.csv("./IMPROVET2D-EGFRVsMGFR_DATA_2022-02-25_1842.csv")
# keep screening visit and visit 1
improve <- improve %>% filter(redcap_event_name=="screening_arm_1" | (redcap_event_name=="study_visits_arm_1" & 
                                                                        redcap_repeat_instance==1))
improve1 <- improve %>% select("subject_id","redcap_event_name","age_current","gender","race___1","race___2","race___3","race___4","race___5",
                               "race___6","race___7","other_races","ethnicity___1","ethnicity___2","ethnicity___3","length_of_diabetes")
improve1 <- improve1 %>% filter(redcap_event_name=="screening_arm_1")
improve2 <- improve %>% select(-c("age_current","gender","race___1","race___2","race___3","race___4","race___5",
                               "race___6","race___7","other_races","ethnicity___1","ethnicity___2","ethnicity___3","length_of_diabetes"))
improve2 <- improve2 %>% filter(redcap_event_name!="screening_arm_1")
improve <- merge(improve1,improve2,by="subject_id",all.x = T,all.y = T)
improve$age <- improve$age_current
improve$age_current <- NULL
improve$sex_MF <- ifelse(improve$gender==1,"M",
                           ifelse(!is.na(improve$gender),"F",NA))
improve$gender <- NULL
# did anyone check more than one race/ethnicity category - yes, 1 person
improve$race_sum <- rowSums(improve[,c("race___1","race___2","race___3","race___4","race___5","race___6","race___7")],na.rm = T)
# create new race/ethnicity variable
# anyone who checked Hispanic ethnicity will be considered Hispanic
improve$race_eth <- ifelse(improve$ethnicity___1==1,"Hispanic/Latino",
                             ifelse(improve$race_sum>1,"Other",
                                    ifelse(improve$race___1==1,"American Indian/Alaska Native",
                                           ifelse(improve$race___2==1,"Asian",
                                                  ifelse(improve$race___3==1,"Hawaiian/Pacific Islander",
                                                    ifelse(improve$race___4==1,"Black/African American",
                                                         ifelse(improve$race___5==1,"White",
                                                                ifelse(improve$race___6==1,"Other","Unknown"))))))))
improve <- improve %>% select(-c(ethnicity___1,ethnicity___2,ethnicity___3,race___1,race___2,race___3,race___4,race___5,
                                     race___6,race___7,other_races,race_sum))
improve$leanmass_percent <- improve$dxa_lean_mass
improve$bodyfat_percent <- improve$dxa_body_fat
improve$dxa_lean_kg <- NULL
improve$dxa_lean_mass <- NULL
improve$dxa_fat_kg <- NULL
improve$dxa_body_fat <- NULL
improve$hba1c <- improve$mmtt_hba1c_base
improve$mmtt_hba1c_base <- NULL
improve$redcap_event_name <- NULL
improve$redcap_repeat_instance <- NULL
improve$redcap_repeat_instrument <- NULL
improve$redcap_event_name.x <- NULL
improve$redcap_event_name.y <- NULL
improve$study <- "IMPROVE"
improve$group <- "T2D"

############
#   PGN    #
############

# PGN
# for now, we'll exclude PGN, since GFR measures haven't been received yet
pgn <- read.csv("./PENGUIN-EGFRVsMGFR_DATA_2022-02-25_1843.csv")
pgn$gfr <- as.numeric(pgn$gfr)
pgn$age <- pgn$age_consent
pgn$age_consent <- NULL
pgn$sex_MF <- ifelse(pgn$sex==2,"M",
                           ifelse(!is.na(pgn$sex),"F",NA))
pgn$sex <- NULL
# did anyone check more than one race/ethnicity category
pgn$race_sum <- rowSums(pgn[,c("race___1","race___2","race___3","race___4","race___5","race___6","race___7")],na.rm = T)
# create new race/ethnicity variable
# anyone who checked Hispanic ethnicity will be considered Hispanic
pgn$race_eth <- ifelse(pgn$ethnicity___1==1,"Hispanic/Latino",
                             ifelse(pgn$race_sum>1,"Other",
                                    ifelse(pgn$race___1==1,"American Indian/Alaska Native",
                                           ifelse(pgn$race___2==1,"Asian",
                                                  ifelse(pgn$race___3==1,"Hawaiian/Pacific Islander",
                                                    ifelse(pgn$race___4==1,"Black/African American",
                                                         ifelse(pgn$race___5==1,"White",
                                                                ifelse(pgn$race___6==1,"Other","Unknown"))))))))
pgn <- pgn %>% select(-c(ethnicity___1,ethnicity___2,ethnicity___3,race___1,race___2,race___3,race___4,race___5,
                                     race___6,race___7,race_other,race_sum))
pgn$clamp_weight <- pgn$clamp_wt
pgn$clamp_wt <- NULL
pgn$clamp_height <- pgn$clamp_ht
pgn$clamp_ht <- NULL
pgn$leanmass_kg <- NULL
pgn$fatmass_kg <- NULL
pgn$clamp_sbp <- pgn$visit_sbp
pgn$clamp_dbp <- pgn$visit_dbp
pgn$clamp_map <- pgn$visit_map
pgn$visit_dbp <- NULL
pgn$visit_sbp <- NULL
pgn$visit_map <- NULL
pgn$fbg <- pgn$bl_bg
pgn$bl_bg <- NULL
pgn$hba1c <- pgn$bl_a1c
pgn$bl_a1c <- NULL
pgn$serum_creatinine <- pgn$bl_creatinine_s
pgn$bl_creatinine_s <- NULL
pgn$cystatin_c <- pgn$bl_cystatin_c_s
pgn$bl_cystatin_c_s <- NULL
pgn$clamp_acr_baseline <- pgn$bl_uacr
pgn$bl_uacr <- NULL
pgn$subject_id <- pgn$record_id
pgn$record_id <- NULL
pgn$length_of_diabetes <- NA
pgn$study <- "PGN"
pgn$group <- "PKD"

############
#   BMT    #
############

# BMT
bmt <- read.csv("./177844RenalBloodFlow-EGFRVsMGFR_DATA_2022-02-25_1843.csv")
bmt$gfr <- bmt$igfr_ab
bmt$igfr_ab <- NULL
bmt$sex_MF <- ifelse(bmt$sex==2,"M",
                           ifelse(!is.na(bmt$sex),"F",NA))
bmt$sex <- NULL
bmt$clamp_weight <- bmt$wt
bmt$wt <- NULL
bmt$clamp_height <- bmt$ht
bmt$ht <- NULL
bmt$leanmass_percent <- NA
bmt$bodyfat_percent <- NA
bmt$clamp_sbp <- bmt$sbp
bmt$clamp_dbp <- bmt$dbp
bmt$clamp_map <- ((2*bmt$clamp_dbp) + bmt$clamp_sbp)/3
bmt$sbp <- NULL
bmt$dbp <- NULL
bmt$fbg <- bmt$sglu
bmt$sglu <- NULL
bmt$serum_creatinine <- bmt$screat
bmt$screat <- NULL
bmt$cystatin_c <- bmt$scystc
bmt$scystc <- NULL
bmt$clamp_acr_baseline <- bmt$umalb/bmt$ucreat
bmt$umalb <- NULL
bmt$ucreat <- NULL
# read in race/ethnicity
bmt_race_eth <- read.csv("./BMT race_eth.csv")
bmt <- merge(bmt,bmt_race_eth,by="record_id",all.x = T, all.y = T)
bmt$subject_id <- bmt$record_id
bmt$record_id <- NULL
bmt$length_of_diabetes <- NA
bmt$hba1c <- NA
# one person is missing age
bmt$age[bmt$subject_id==21] <- 8
bmt$study <- "BMT"
bmt$group <- "BMT"

################
# COMBINE DATA #
################

# combine all datasets
alldata <- rbind(crocodile,casper,coffee,improve,renal_heir,pgn,bmt)
# take out anyone with missing age
alldata <- alldata %>% filter(!is.na(alldata$age))

# calculate QCR values for FAS equations
alldata$age <- floor(alldata$age)
alldata$qcr[alldata$age==8] <- 0.46
alldata$qcr[alldata$age==9] <- 0.49
alldata$qcr[alldata$age==10] <- 0.51 
alldata$qcr[alldata$age==11] <- 0.53 
alldata$qcr[alldata$age==12] <- 0.57
alldata$qcr[alldata$age==13] <- 0.59
alldata$qcr[alldata$age==14] <- 0.61
# females
alldata$qcr[alldata$age==15 & alldata$sex_MF=="F"] <- 0.64
# males
alldata$qcr[alldata$age==15 & alldata$sex_MF=="M"] <- 0.72
# females
alldata$qcr[alldata$age==16 & alldata$sex_MF=="F"] <- 0.67
# males
alldata$qcr[alldata$age==16 & alldata$sex_MF=="M"] <- 0.78
# females
alldata$qcr[alldata$age==17 & alldata$sex_MF=="F"] <- 0.69
# males
alldata$qcr[alldata$age==17 & alldata$sex_MF=="M"] <- 0.82
# females
alldata$qcr[alldata$age==18 & alldata$sex_MF=="F"] <- 0.69
# males
alldata$qcr[alldata$age==18 & alldata$sex_MF=="M"] <- 0.85
# females
alldata$qcr[alldata$age==19 & alldata$sex_MF=="F"] <- 0.70
# males
alldata$qcr[alldata$age==19 & alldata$sex_MF=="M"] <- 0.88
# females
alldata$qcr[alldata$age>19 & alldata$sex_MF=="F"] <- 0.70
# males
alldata$qcr[alldata$age>19 & alldata$sex_MF=="M"] <- 0.90

# eGFR FAS creatinine
alldata$eGFR.fas_cr <-107.3/(alldata$serum_creatinine/alldata$qcr)

# eGFR FAS combined creatinine and cystatin-C
alldata$f1 <- alldata$serum_creatinine/alldata$qcr
alldata$f2 <- 1-0.5
alldata$f3 <- alldata$cystatin_c/0.82
alldata$eGFR.fas_cr_cysc <- 107.3 / ((0.5*alldata$f1) + (alldata$f2*alldata$f3))

# eGFR Zapatelli
alldata$eGFR.Zap <- (507.76*exp(0.003*(alldata$clamp_height)))/((alldata$cystatin_c^0.635)*((alldata$serum_creatinine*88.4)^0.547))

# eGFR bedside Schwartz
alldata$eGFR.bedside_Schwartz <- (41.3*(alldata$clamp_height/100))/alldata$serum_creatinine

# eGFR revised Schwartz - going to hold off because I need to pull BUN from REDCap

# Schwartz-Lyon - not frequently used so do this later?

# eGFR CKiD U25 age and sex-dependent sCR
alldata$k_CKiD_scr = apply(alldata,1,function(r){
  # Sex and age
  sex = as.character(r["sex_MF"])
  age = as.numeric(r["age"])
  age_cat = cut(age,c(-Inf,12,15,18,Inf),right = F)
  # Different equations for age and sex
  if(age_cat == "[-Inf,12)"){
    if (sex == "M"){
      k = 39*(1.008^(age-12))
    } else if (sex == "F"){
      k = 36.1*(1.008^(age-12))
    }
  } else if (age_cat == "[12,15)") {
    if (sex == "M"){
      k = 39*(1.045^(age-12))
    } else if (sex == "F"){
      k = 36.1*(1.023^(age-12))
    }
  } else if (age_cat == "[15,18)") {
    if (sex == "M"){
      k = 39*(1.045^(age-12))
    } else if (sex == "F"){
      k = 36.1*(1.023^(age-12))
    }
  } else if (age_cat == "[18, Inf)") {
    if (sex == "M"){
      k = 50.8
    } else if (sex == "F"){
      k = 41.4
    }
  }
  return(k)
})
alldata$eGFR.CKiD_scr <- alldata$k_CKiD_scr * ((alldata$clamp_height/100)/alldata$serum_creatinine)

# eGFR CKiD U25 age and sex-dependent cystatin-C
alldata$k_CKiD_cysc = apply(alldata,1,function(r){
  # Sex and age
  sex = as.character(r["sex_MF"])
  age = as.numeric(r["age"])
  age_cat = cut(age,c(-Inf,12,15,18,Inf),right = F)
  # Different equations for age and sex
  if(age_cat == "[-Inf,12)"){
    if (sex == "M"){
      k = 87.2*(1.011^(age-15))
    } else if (sex == "F"){
      k = 79.9*(1.004^(age-12))
    }
  } else if (age_cat == "[12,15)") {
    if (sex == "M"){
      k = 87.2*(1.011^(age-15))
    } else if (sex == "F"){
      k = 79.9*(0.974^(age-12))
    }
  } else if (age_cat == "[15,18)") {
    if (sex == "M"){
      k = 87.2*(0.960^(age-15))
    } else if (sex == "F"){
      k = 79.9*(0.974^(age-12))
    }
  } else if (age_cat == "[18, Inf)") {
    if (sex == "M"){
      k = 77.1
    } else if (sex == "F"){
      k = 68.3
    }
  }
  return(k)
})
alldata$eGFR.CKiD_cysc <- alldata$k_CKiD_cysc * (1/alldata$cystatin_c)

# clean up
alldata <- alldata %>% select(-c(f1,f2,f3,qcr,k_CKiD_cysc,k_CKiD_scr))

# calculate BSA adjusted GFR
alldata$bsa <- 0.024265*(alldata$clamp_height^0.3964)*(alldata$clamp_weight^0.5378)
alldata$gfr_bsa <- (alldata$gfr*1.73)/alldata$bsa

# write file for checking
write.csv(alldata,"./eGFR data check.csv",row.names = F)

mod_noint <- function(data, predictor) {
  df = data
  p <- ggplot(data=df, aes_string(x = predictor,y = "gfr_bsa")) + geom_point() +
       xlab(predictor) + ylab("GFR BSA-adjusted")
  form = as.formula(paste0("gfr ~", predictor))
  mod <- lm(form, data=df)
  print(p)
  print(summary(mod))
  print(check_model(mod))
}

mod_int <- function(data, predictor) {
  df = data
  p <- ggplot(data=df, aes_string(x = predictor,y = "gfr_bsa",group="group")) + geom_point() + 
    geom_smooth(method="lm") + theme_bw() +  xlab(predictor) + ylab("GFR BSA-adjusted")
  form = as.formula(paste0("gfr ~", predictor,"*group"))
  mod <- lm(form, data=df)
  print(p)
  print(summary(mod))
  print(Anova(mod,type = "III"))
  print(check_model(mod))
}
```

# Background

# Methods

# Results

## Descriptive statistics for all  participants

```{r include=F, echo=FALSE}
descdata <- alldata %>% select(-subject_id)
t1a <- CreateTableOne(data=descdata,vars=colnames(descdata))
t1a <- print(t1a,nonnorm=c("age","clamp_weight","clamp_height","length_of_diabetes","fbg","hba1c",
                           "serum_creatinine","clamp_acr_baseline"))
```

```{r include=T, echo=FALSE}
kable(t1a)
```

## Descriptive statistics by group

```{r include=F, echo=FALSE}
t1b <- CreateTableOne(data=descdata,vars=colnames(descdata),strata = "group")
t1b <- print(t1b,nonnorm=c("age","clamp_weight","clamp_height","length_of_diabetes","fbg","hba1c",
                          "serum_creatinine","clamp_acr_baseline"))
```

```{r include=T, echo=FALSE}
kable(t1b)
```

## Regressions and scatterplots - all participants

### FAS creatinine

```{r include=T, echo=FALSE, comment="", warning=F}
mod_noint(data=alldata,predictor = "eGFR.fas_cr" )
```

### FAS combined creatinine and cystatin-C

```{r include=T, echo=FALSE, comment="", warning=F}
mod_noint(data=alldata,predictor = "eGFR.fas_cr_cysc" )
```

### Zappitelli

```{r include=T, echo=FALSE, comment="", warning=F}
mod_noint(data=alldata,predictor = "eGFR.Zap" )
```

### Bedside Schwartz

```{r include=T, echo=FALSE, comment="", warning=F}
mod_noint(data=alldata,predictor = "eGFR.bedside_Schwartz" )
```

### CKiD creatinine

```{r include=T, echo=FALSE, comment="", warning=F}
mod_noint(data=alldata,predictor = "eGFR.CKiD_scr" )
```

### CKiD cystatin-C

```{r include=T, echo=FALSE, comment="", warning=F}
mod_noint(data=alldata,predictor = "eGFR.CKiD_cysc" )
```

## Regressions and scatterplots - interaction term with group

### FAS creatinine

```{r include=T, echo=FALSE, comment="", warning=F}
mod_int(data=alldata,predictor = "eGFR.fas_cr" )
```

## Correlation coefficients - all participants

## Correlation coefficients - by group

## Bland-Altman plots - all participants

## Bland-Altman plots - by group (if evidence of interaction from above)

