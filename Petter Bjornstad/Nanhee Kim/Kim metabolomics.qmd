---
title: "Nanhee Kim metabolomics data"
author: "Laura Pyle"
date: "`r lubridate::today()`"
format:
  revealjs:
    embed-resources: true
    scrollable: true
    transition: slide
    controls-layout: bottom-right
    menu: true
    toc: true
    toc-depth: 1
    fontsize: 20
---

```{r include = F}
library(jsonlite)
library(aws.s3)
library(dplyr)
library(knitr)
library(readxl)
library(corrplot)
library(gtools)

# specify user for paths
user <- Sys.info()[["user"]]
if (user == "laurapyle") {
  data_path <- "/Users/laurapyle/Library/CloudStorage/OneDrive-UW/Kim"
} else if (user == "lpyle") {
  data_path <- "/Users/lpyle/Library/CloudStorage/OneDrive-UW/Kim"
} else {
  stop("Unknown user: please specify root path for this user.")
}

```

```{r include = F}
# Data questions
# What is the Metabolomics(N=92) tab? Just a copy?
# Manuscript says that after excluding those with insufficient sample volume, withdrawal of consent, or dropout from the study, a total of 72 samples from individuals with T2DM were included  (vs. 91 or 92 ppts)
# S0, S1, S2 in First BI Result document corresponds to ACR stage or CKD stage?
# S ACR stage - based on AI analysis as best criterion


setwd(data_path)
v1 <- read_xlsx('./Data_raw/Metabolomics data_250807 for Laura (2).xlsx', sheet = "V1(N=91)")
v2 <- read_xlsx('./Data_raw/Metabolomics data_250807 for Laura (2).xlsx', sheet = "V2(N=65)")
v3 <- read_xlsx('./Data_raw/Metabolomics data_250807 for Laura (2).xlsx', sheet = "V3(N=55)")
v4 <- read_xlsx('./Data_raw/Metabolomics data_250807 for Laura (2).xlsx', sheet = "V4(N=52)")
```

# Association of top 20 HTN proteins with adiposity in TODAY (unadjusted models)

* Select top 20 proteins associated with time to hypertension in unadjusted Cox models in the TODAY data
* Correlate the top 20 proteins with adiposity in TODAY

```{r results='asis', dpi=1200, include=FALSE}
# correlate proteins with change in BMI, DXA
prot_heatmap <- seq_keep
colnames_M <- analytes %>%
  filter(AptName %in% seq_keep) %>%
  pull(Target)
colnames_M <- paste0(colnames_M,"_",prot_heatmap)
png(file = "heatmap_TODAY_htn_adiposity.png", res = 170, width = 3000, height = 2500)
corr_plot_modified_nodict(data=soma_keep, 
                   Y=soma_keep[,seq_keep],   
                 X=soma_keep[,c("Baseline BMI", "Baseline DXA % fat", "Baseline DXA corrected % fat", "Slope - BMI","Slope - DXA % body fat","Slope - DXA corrected % body fat")],
                 cor_method="spearman", adj_var = NA,
                 colnames_M=colnames_M)
dev.off()
```

![](heatmap_TODAY_htn_adiposity.png){.r-fit-text}


