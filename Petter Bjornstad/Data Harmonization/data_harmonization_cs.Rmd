---
title: "Data Harmonization CS"
author: "Casey Sakamoto"
date: "3/15/2022"
output: html_document
---

The intent is to merge/harmonize Renal-HEIR, IMPROVE, PENGUIN, CROCODILE, CASPER and COFFEE
```{r setup, include=FALSE}
library(knitr)
library(redcapAPI)
library(tidyverse)
knitr::opts_chunk$set(echo = FALSE)
if(Sys.info()["sysname"] == "Windows"){
  home_dir = "S:/Laura/Peds Endo/Petter Bjornstad/Data Harmonization"
} else if (Sys.info()["sysname"] == "Linux"){
  home_dir = "~/UCD/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/Peds Endo/Petter Bjornstad/Data Harmonization"
} else if (Sys.info()["sysname"] == "Darwin"){
  home_dir = "/Volumes/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/Peds Endo/Petter Bjornstad/Data Harmonization"
}
knitr::opts_knit$set(root.dir = home_dir)

setwd(home_dir)
rm(home_dir)
# API import
tokens = read.csv("api_tokens.csv")
uri = "https://redcap.ucdenver.edu/api/"
renal = exportRecords(
  redcapConnection(
    url = uri,token = tokens$Token[tokens$ï..Study == "Renal-HEIR"]
    )
  )
improve = exportRecords(
  redcapConnection(
    url = uri,token = tokens$Token[tokens$ï..Study == "IMPROVE"]
    )
  )
penguin = exportRecords(
  redcapConnection(
    url = uri,token = tokens$Token[tokens$ï..Study == "PENGUIN"]
    )
  )
crocodile = exportRecords(
  redcapConnection(
    url = uri,token = tokens$Token[tokens$ï..Study == "CROCODILE"]
    )
  )
coffee = exportRecords(
  redcapConnection(
    url = uri,token = tokens$Token[tokens$ï..Study == "COFFEE"]
    )
  )
casper = exportRecords(
  redcapConnection(
    url = uri,token = tokens$Token[tokens$ï..Study == "CASPER"]
    )
  )
rm(tokens,uri)

# function to check vars on a list from the colnames 
vars_needed = function(var_list, data){
  
  df = NULL
  df$vars = var_list
  df$indata = var_list %in% colnames(data)
  df = as.data.frame(df)
  df = df %>% filter(indata == FALSE) %>% select(vars)
  # returns list of variables NOT in the dataset ie) things needed to be renamed or not in dataset
  return(df)
}
```


#STUDY
STUDYNAME
VISIT(IMPROVE has mult)

```{r study}
# study name
renalheir$study_name = "RENALHEIR"
penguin$study_name = "PENGUIN"
improve$study_name = "IMPROVE"
crocodile$study_name = "CROCODILE"
casper$study_name = "CASPER"
coffee$study_name = "COFFEE"

# visit

```

#DEMOGRAPHICS
subject_id
group - all participants in penguin are pkd group = 5
dob
age_current
gender
race___1
race___2
race___3
race___4
race___5
race___6
race___7
other_races
ethnicity___1
ethnicity___2
ethnicity___3
length_of_diabetes -months
age of diabetes onset

```{r demog}

```

#SCREENING DATA
insulin
Insulin pump
screen_height
screen_weight
screen_bmi
screen_bmi_percentile
waist_circumference
hip_circumference
sys_bp
dys_bp
map
pulse
activity_factor - separate for male and fem, should have one combined
schofield - similar to activityfactor
hba1c
hemoglobin
screen_hematocrit
screen_serum_creatinine
screen_urine_mab
screen_urine_cre
screen_urine_acr
screen_pregnant
screening_labs_complete

```{r screen}

```

#DXA Data
dexa_date
body_fat
lean_mass
trunk_mass
fat_kg
lean_kg
trunk_kg
bone_mineral_density
body_composition_dxa_complete

```{r dxa}

```

#CLAMP VITALS
clamp_date
clamp_height
clamp_weight
clamp_sbp
clamp_dbp
clamp_map	
clamp_pls

```{r clamp vitals}

```

#clamp labs
cholesterol
hdl
ldl
triglycerides
total_protein
serum_sodium
cystatin_c
serum_creatinine
clamp_urine_mab_baseline
clamp_urine_cre_baseline
clamp_acr_baseline
clamp_urine_sodium
clamp_glucose_bl
urine_glucose	
clamp_urine_mab_250
clamp_urine_cre_250
clamp_acr_250
clamp_urine_vol

```{r clamp labs}

```

#24hr urine labs 
u24_labs
u24_na
u24_mab
u24_volume
u24_hours
**only crocodile, penguin, panther
```{r urine24}

```

#hyperinsulinemic-euglycemic clamp
p1_raw_m
p1_raw_leanm
p1_gc_m
p1_gc_leanm
p2_raw_m
p2_raw_leanm
p2_gc_m
p2_gc_leanm
**only croc and peng

```{r HIEG clamp}

```

#FFA Clamp
ffa_minus20
ffa_minus10
ffa_minus_5
ffa_0
ffa_2
ffa_4	
ffa_6	
ffa_8
ffa_10
ffa_70
ffa_80
ffa_90
ffa_220
ffa_230	
ffa_240	
ffa_250	
ffa_260	
ffa_270

```{r ffa clamp}

```

#CPEPTIDE FROM CLAMP
cpeptide_minus_10
cpeptide_minus_5
cpeptide_2
cpeptide_4
cpeptide_6
cpeptide_8
cpeptide_10
cpeptide_120
cpeptide_220
cpeptide_230
cpeptide_240
cpeptide_250

```{r cpeptide clamp}

```

#insulin data from clamp
insulin_minus20
insulin_minus_10
insulin_minus_5	
insulin_0	
insulin_2	
insulin_4	
insulin_6	
insulin_8	
insulin_10
insulin_70
insulin_80
insulin_90
insulin_120	
insulin_220	
insulin_230
insulin_240	
insulin_250	
insulin_260	
insulin_270

```{r insulin clamp}

```
#BG from clamps
bg_baseline	bg_minus120	bg_minus90	bg_minus20	bg_minus10	bg_minus5	bg_0	bg_5	bg_10	bg_15	bg_20	bg_25	bg_30	bg_35	bg_40	bg_45	bg_50	bg_55	bg_60	bg_65	bg_70	bg_75	bg_80	bg_85	bg_90	bg_95	bg_100	bg_105	bg_110	bg_115	bg_120	bg_125	bg_130	bg_135	bg_140	bg_145	bg_150	bg_155	bg_160	bg_165	bg_170	bg_175	bg_180	bg_185	bg_190	bg_195	bg_200	bg_205	bg_210	bg_215	bg_220	bg_225	bg_230	bg_235	bg_240	bg_245	bg_250	bg_255	bg_260	bg_265	bg_270	bg_285	bg_300

*called glucose for renal-heir ie glucose minus120 etc
```{r bg clamp}

```

#estimated gfr (calculated)
GFR_Schwartz
GFR_FAS
GFR_Zappitelli
GFR_CKIDU25
gfr - absolute gfr
gfr_bsa - bsa adjusted gr
#kidney measures
pah_clear_abs
pah_clear_bsa
rpf
rpf_bsa
ecv
gfr_ecv_percent
gfr_ecv_std

```{r estimated gfr}

```

#calculated parameters of intraglomerular hemodynamics
Pglo
Ra
Re
RVR
FF
RBF

```{r ig hemodynamics calc}

```

#kidney mri

```{r kidney mri}
# var list to check on
var_kidneymri_list = c(
 'o2_sats',
'pcasl3d_right',
'pasl2d_right',
'adc_right',
'length_right',
'width_right',
'depth_right',
'volume_right',
'bold_r_bl_cortex',
'bold_r_bl_medulla',
'bold_r_bl_kidney',
'bold_r_pf_cortex',
'bold_r_pf_medulla',
'bold_r_pf_kidney',
'pcasl3d_left',
'pasl2d_left',
'adc_left',
'length_left',
'width_left',
'depth_left',
'volume_left',
'bold_l_bl_cortex',
'bold_l_bl_medulla',
'bold_l_bl_kidney',
'bold_l_pf_cortex',
'bold_l_pf_medulla',	
'bold_l_pf_kidney' 
)

##### renal #####
vars_needed(var_list = var_kidneymri_list, data = renal)
# need to find pcasl3d, pasl2d, adc, length, width, depth, volume (all with _left or _right)
#################

##### casper #####
vars_needed(var_list = var_kidneymri_list, data = casper)
# need to find pcasl3d, pasl2d, adc, length, width, depth, volume (all with _left or _right)
##################

##### coffee #####
vars_needed(var_list = var_kidneymri_list, data = coffee)
# need to find pcasl3d, pasl2d, adc, length, width, depth, volume (all with _left or _right)
##################

##### crocodile ##
vars_needed(var_list = var_kidneymri_list, data = crocodile)
# need to find/rename o2_sats
##################

##### improve ####
vars_needed(var_list = var_kidneymri_list, data = improve)
# need to find pcasl3d, pasl2d, adc, length, width, depth, volume (all with _left or _right)
##################

##### penguin ####
vars_needed(var_list = var_kidneymri_list, data = penguin)
# penguin has none on the list
##################

```

#pet/ct data
*croc and penguin only
NO DATA NEEDS TO BE RENAMED,
NO DATA FOR PENGUIN IN THESE VARIABLES AS OF 4/14/2022, SO AS OF NOW NOTHING NEEDS TO BE ADJUSTED/CHANGED
```{r pet ct}
var_petct_list = c("pet_rc_f",
"pet_rc_k2",
"pet_rc_vb",
"pet_rc_k1",
"pet_rm_f",
"pet_rm_k2",
"pet_rm_vb",
"pet_rm_k1",
"pet_lc_f",
"pet_lc_k2",
"pet_lc_vb",
"pet_lc_k1",
"pet_lm_f",
"pet_lm_k2",
"pet_lm_vb",
"pet_lm_k1")

##### croc #####
vars_needed(var_list = var_petct_list, data = crocodile)
################

##### peng #####
vars_needed(var_list = var_petct_list, data = penguin)
################
```

#kidney biopsy
CASPER, COFFEE, PENGUIN NO BIOPSY DATA? 
```{r kidney biopsy}
# list based on renal, var names were weird in petters list -- renal has everything
var_kidbiop_list = c("gloms",
  "glom_enlarge",
  "gloms_gs",
  "ifta",
  "vessels",
  "fia",
  "glom_tuft_area",
  "glom_volume_wiggins",
  "mes_matrix_area",
  "mes_index",
  "mes_volume_wiggins",
  "glom_nuc_count",
  "mes_nuc_count")

# renal needs vessels and glom_enlarge
##### renal #####
# glom enlarge
renal = renal %>% mutate(glom_enlarge = case_when(glom_enlarge___1 == "Checked" ~ '1',
                                                  glom_enlarge___2 == "Checked" ~ '2',
                                                  glom_enlarge___3 == "Checked" ~ '3',
                                                  glom_enlarge___4 == "Checked" ~ '4',
                                                  glom_enlarge___5 == "Checked" ~ '5',
                                                  glom_enlarge___6 == "Checked" ~ '6',
                                                  glom_enlarge___7 == "Checked" ~ '7'))
# vessels
renal = renal %>% mutate(vessels = case_when( vessels___2 == "Checked" ~ vessels_other,
                                              vessels___1 == "Checked" ~ "Normal"))
#################

#### casper #####
vars_needed(var_list = var_kidbiop_list, data = casper) # needs all vars renamed
# no biopsy data i think
#################

#### coffee #####
vars_needed(var_list = var_kidbiop_list, data = coffee) # needs all vars renamed
# no biopsy data i think
#################

##### croc ######
vars_needed(var_list = var_kidbiop_list, data = crocodile) # needs glom_enlarge, vessels
crocodile = crocodile %>% mutate(glom_enlarge = case_when(glom_enlarge___1 == "Checked" ~ '1',
                                                  glom_enlarge___2 == "Checked" ~ '2',
                                                  glom_enlarge___3 == "Checked" ~ '3',
                                                  glom_enlarge___4 == "Checked" ~ '4',
                                                  glom_enlarge___5 == "Checked" ~ '5',
                                                  glom_enlarge___6 == "Checked" ~ '6',
                                                  glom_enlarge___7 == "Checked" ~ '7'))
# vessels
crocodile = crocodile %>% mutate(vessels = case_when( vessels___2 == "Checked" ~ vessels_other,
                                              vessels___1 == "Checked" ~ "Normal"))
#################

#### improve ####
vars_needed(var_list = var_kidbiop_list, data = improve) # needs glom_enlarge, vessels
improve = improve %>% mutate(glom_enlarge = case_when(glom_enlarge___1 == "Checked" ~ '1',
                                                  glom_enlarge___2 == "Checked" ~ '2',
                                                  glom_enlarge___3 == "Checked" ~ '3',
                                                  glom_enlarge___4 == "Checked" ~ '4',
                                                  glom_enlarge___5 == "Checked" ~ '5',
                                                  glom_enlarge___6 == "Checked" ~ '6',
                                                  glom_enlarge___7 == "Checked" ~ '7'))
# vessels
improve = improve %>% mutate(vessels = case_when( vessels___2 == "Checked" ~ vessels_other,
                                              vessels___1 == "Checked" ~ "Normal"))

#################

#### penguin ####
vars_needed(var_list = var_kidbiop_list, data = penguin) # needs all vars renamed
# no biopsy data i think
#################
```
