---
title: "SGLT2i manuscript - clinical characteristics"
author: "Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 5
    toc_float: yes
---

```{r setup, include=FALSE}
library(tableone)
library(dplyr)
library(knitr)
library(questionr)
library(skimr)
library(readxl)
library(arsenal)
library(gtsummary)
library(stringr)
knitr::opts_chunk$set(echo = FALSE,warning = FALSE)
```

```{r include=FALSE}
# Import and clean data
df <- read.csv("/Volumes/RI Biostatistics Core/Shared/Shared Projects/Laura/Peds Endo/Petter Bjornstad/Data Harmonization/Data Clean/soma_harmonized_dataset.csv", na.strings = "")
df <- df %>%
  filter(
    study %in% c("IMPROVE", "RENAL-HEIR","RENAL-HEIRitage", "CROCODILE"),
    !grepl("IT2D", co_enroll_id), participation_status == "Participated",
  ) %>%
  group_by(record_id, visit) %>%
  summarise(across(where(is.character), ~ last(na.omit(.x))),
    across(where(is.factor), ~ last(na.omit(.x))),
    across(where(is.numeric), ~ mean(.x, na.rm = T)),
    .groups = "drop"
  ) %>%
  mutate_all(~ ifelse(is.nan(.), NA, .))
df <- df %>% filter(visit == "baseline")

# select the sample IDs that Fadhl sent
ids_keep <- read_xlsx("/Volumes/RI Biostatistics Core/Shared/Shared Projects/Laura/Peds Endo/Petter Bjornstad/Metallothionine/MT_sampleIDs_Laura.xlsx")
ids_keep$record_id <- stringr::str_remove(ids_keep$michigan_id, "_BL")
ids_keep$michigan_id <- NULL

df_keep <- left_join(ids_keep, df, by = "record_id")

```

# Results

## Table 1

```{r, include=FALSE}
t1 <- tableby(T2D_HC_Phil ~ age + sex + race_ethnicity + bmi + dexa_body_fat + cholesterol + ldl + hdl + triglycerides +
                sbp + dbp + acr_u + albuminuria_cat + hba1c + creatinine_s + eGFR_fas_cr_cysc + sglt2i_ever + 
                epic_ever_glp1ra_1 + epic_ever_sglt2i_1 + epic_ever_raasi_1 + epic_ever_insulin_1 + epic_ever_mfm_1,  
                epic_ever_tzd_1, 
              data = df_keep)
                
  
             
```

```{r, include=TRUE, results='asis'}
summary(t1)
```


