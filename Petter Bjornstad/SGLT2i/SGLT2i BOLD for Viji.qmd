---
title: "BOLD MRI Comparisons for Viji"
author: "Tim Vigers"
date: "`r format(Sys.time(), '%d %B %Y')`"
format:
  html:
    toc: true
    toc-depth: 5
    toc-float: true
    code-fold: true
    self-contained: true
    fig-cap-location: top
    page-layout: full
    fig-width: 10
    fig-height: 10
editor: source
---

```{r}
#| include: false
library(tidyverse)
library(gtsummary)
```

```{r}
# Import
df = read.csv("/Volumes/Peds Endo/Petter Bjornstad/Data Harmonization/Data Clean/harmonized_dataset.csv",na.strings = "")
dict = read.csv("/Volumes/Peds Endo/Petter Bjornstad/Data Harmonization/data_dictionary_master.csv")
# Filter and select columns
bold_vars = c("bold_l_bl_cortex","bold_l_bl_kidney","bold_l_bl_medulla",
              "bold_l_pf_cortex","bold_l_pf_kidney","bold_l_pf_medulla",
              "bold_r_bl_cortex","bold_r_bl_kidney","bold_r_bl_medulla",
              "bold_r_pf_cortex","bold_r_pf_kidney","bold_r_pf_medulla",
              "fsoc_l_cortex", "fsoc_l_kidney", "fsoc_l_medulla", 
              "fsoc_r_cortex", "fsoc_r_kidney", "fsoc_r_medulla")
df = df %>% 
  filter(sglt2i_ever=="No",visit=="baseline",procedure=="bold_mri",
         !grepl("IT2D",co_enroll_id)) %>%
  select(record_id:study,visit:date,group,sglt2i_ever,all_of(bold_vars))
# Save data for Viji
write.csv(df,file = "/Users/timvigers/Library/CloudStorage/Dropbox/Work/Shared/Michigan/CHCO_Sample_IDs_Clinical/harmonized_data_bold_mri_2023_03_14.csv")
```

```{r table 1}
#| label: tbl-1
#| tbl-cap: Bold parameters by specific group
#| warning: false
df %>% 
  select(group,all_of(bold_vars)) %>%
  rename_at(all_of(bold_vars), ~ dict$label[match(bold_vars,dict$variable_name)]) %>%
  tbl_summary(by = group,missing_text = "Missing",
              statistic = list(all_continuous() ~ "{mean} ({sd})")) %>%
  add_overall() %>%
  add_p(all_continuous()~"aov") %>%
  bold_p() 
```

```{r figure 1}
#| label: fig-1
#| fig-cap: Boxplots by specific group
#| warning: false
fig_df = df %>% pivot_longer(all_of(bold_vars))
fig_df$name = factor(fig_df$name,levels = bold_vars,labels = dict$label[match(bold_vars,dict$variable_name)])
ggplot(fig_df,aes(x=group,y=value)) + 
  geom_boxplot() + 
  facet_wrap(~name,scales = "free",ncol=3) +
  xlab("Group") + ylab("Value") +
  theme_bw()
```

```{r table 2}
#| label: tbl-2
#| tbl-cap: Bold parameters by group
#| warning: false
df %>% 
  mutate(group = str_replace(group, "Lean |Obese ", "")) %>%
  select(group,all_of(bold_vars)) %>%
  rename_at(vars(bold_vars), ~ dict$label[match(bold_vars,dict$variable_name)]) %>%
  tbl_summary(by = group,missing_text = "Missing",
              statistic = list(all_continuous() ~ "{mean} ({sd})")) %>%
  add_overall() %>%
  add_p(all_continuous()~"t.test") %>%
  bold_p() 
```

```{r figure 2}
#| label: fig-2
#| fig-cap: Boxplots by group
#| warning: false
fig_df$group = factor(fig_df$group,
                      levels = c("Lean Control","Obese Control","Type 2 Diabetes"),
                      labels = c("Control","Control","Type 2 Diabetes"))
ggplot(fig_df,aes(x=group,y=value)) + 
  geom_boxplot() + 
  facet_wrap(~name,scales = "free",ncol=3) +
  xlab("Group") + ylab("Value") +
  theme_bw()
```

