---
title: "Proteomics and DKD"
author: "Tim Vigers"
date: "`r format(Sys.time(), '%d %B %Y')`"
format:
  html:
    toc: true
    toc-depth: 5
    toc-float: true
    self-contained: true
    fig-cap-location: top
    page-layout: full
editor: source
---

# scRNA

```{python}
# Read AnnData object
import scanpy as sc
adata = sc.read_h5ad("/Volumes/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/Peds Endo/Petter Bjornstad/scRNA/Data_Raw/CU_Anschutz_scRNAseq_data/PB_40datasets_soupxcleaned070821_RPC2_Sean_selected.h5ad")
```

Analysis based on tutorials at https://scverse.org/learn/

## PCA

```{python}
sc.tl.pca(adata)
sc.pl.pca(adata, color='CST3')
sc.pl.pca_variance_ratio(adata)
```

## UMAP

```{python}
# Compute the neighborhood graph
sc.pp.neighbors(adata)
# Cluster it
sc.tl.leiden(adata)
# UMAP
sc.tl.umap(adata)
sc.pl.umap(adata,color=["celltype","CST3"])
```

## Finding marker genes

Compute a ranking for the highly differential genes in each cluster (per the Leiden graph-clustering method) based on a t-test. Print the top 20 for each comparison:

```{python}
sc.tl.rank_genes_groups(adata, 'leiden', method='t-test')
sc.pl.rank_genes_groups(adata, n_genes=20, sharey=False)
```

Same again, but for SGLT2i status:

```{python}
sc.tl.rank_genes_groups(adata, 'SGLT2i', method='t-test')
sc.pl.rank_genes_groups(adata, n_genes=20, sharey=False)
```

# Multimodal analysis

