---
title: "CROCODILE nebula vis"
author: "Ye Ji Choi"
format: html
format: 
  html:
    toc: true
    toc-depth: 5
    toc-location: left
    code-fold: true
    embed-resources: true
---

```{r echo = F, include = F}
library(dplyr)
library(kableExtra)
library(knitr)
library(ggplot2)
library(purrr)
library(tidyr)
library(stats)
library(patchwork)
library(UpSetR)
library(readxl)
library(fgsea)
library(ReactomeGSA)
library(GSEABase)
library(enrichplot)
library(enrichR)
library(ggrepel)
library(forcats)
library(stringr)
library(jsonlite)
library(aws.s3)
library(fgsea)
library(reshape2)
```

```{r include = F}
## Create an S3 client
keys <- fromJSON("/Users/choiyej/Library/CloudStorage/OneDrive-TheUniversityofColoradoDenver/Bjornstad Pyle Lab/keys.json")

Sys.setenv(
  "AWS_ACCESS_KEY_ID" = keys$MY_ACCESS_KEY,
  "AWS_SECRET_ACCESS_KEY" = keys$MY_SECRET_KEY,
  "AWS_DEFAULT_REGION" = "",
  "AWS_REGION" = "",
  "AWS_S3_ENDPOINT" = "s3.kopah.uw.edu"
)

source("~/GitHub/CHCO-Code/Petter Bjornstad/ATTEMPT/attempt_functions.R")
```

# Untargeted
```{r echo = F}
# Define paths (same for all cell types)
input_path <- "CROCODILE comparison analysis"
input_suffix <- "_croc_untargeted_t1dvhc.rds"
output_base_path <- "/Users/choiyej/Library/CloudStorage/OneDrive-SharedLibraries-UW/Laura Pyle - Bjornstad/Biostatistics Core Shared Drive/CROCODILE"
output_prefix <- "croc_"
bg_path <- "/Users/choiyej/Library/CloudStorage/OneDrive-SharedLibraries-UW/Laura Pyle - Bjornstad/Biostatistics Core Shared Drive/GSEA"
bucket <- "attempt"
region <- ""

plot_title <-  "Untargeted T1D vs. LC"

celltypes <- c("PT", "TAL", "PC", "Immune_Myeloid", "Immune_Lymphoid", 
               "Immune", "IC", "EC", "FIBVSMCP")

for (cell in celltypes) {
  t1dhc_run_cell_type_analysis(cell, 
                         input_path = input_path,
                         input_suffix = input_suffix,
                         output_prefix = output_prefix,
                         output_base_path = output_base_path,
                         plot_title = plot_title,
                         bg_path = bg_path)
}

```

# Targeted (TCA/Oxphos)

```{r echo = F}
# Define paths (same for all cell types)
input_path <- "CROCODILE comparison analysis"
input_suffix <- "_croc_targeted_tca_oxphos_t1dvhc.rds"
output_base_path <- "/Users/choiyej/Library/CloudStorage/OneDrive-SharedLibraries-UW/Laura Pyle - Bjornstad/Biostatistics Core Shared Drive/CROCODILE"
output_prefix <- "croc_targeted_tca_oxphos_t1dvhc_"
bg_path <- "/Users/choiyej/Library/CloudStorage/OneDrive-SharedLibraries-UW/Laura Pyle - Bjornstad/Biostatistics Core Shared Drive/GSEA"
bucket <- "attempt"
region <- ""

plot_title <-  "TCA/Oxphos targeted T1D vs. LC"

celltypes <- c("PT", "TAL", "PC", "Immune_Myeloid", "Immune_Lymphoid", 
               "Immune", "IC", "EC", "FIBVSMCP")

for (cell in celltypes) {
  t1dhc_run_cell_type_analysis(cell, 
                         input_path = input_path,
                         input_suffix = input_suffix,
                         output_prefix = output_prefix,
                         output_base_path = output_base_path,
                         plot_title = plot_title,
                         bg_path = bg_path)
}
```

# Targeted (Significant from ATTEMPT)

```{r echo = F}
# Define paths (same for all cell types)
input_path <- "CROCODILE comparison analysis"
input_suffix <- "_croc_targeted_t1dvhc.rds"
output_base_path <- "/Users/choiyej/Library/CloudStorage/OneDrive-SharedLibraries-UW/Laura Pyle - Bjornstad/Biostatistics Core Shared Drive/CROCODILE"
output_prefix <- "croc_targeted_t1dvhc_"
bg_path <- "/Users/choiyej/Library/CloudStorage/OneDrive-SharedLibraries-UW/Laura Pyle - Bjornstad/Biostatistics Core Shared Drive/GSEA"
bucket <- "attempt"
region <- ""

plot_title <-  "Targeted T1D vs. LC (Significant findings from ATTEMPT)"

celltypes <- c("PT", "TAL", "PC", "Immune_Myeloid", "Immune_Lymphoid", 
               "Immune", "IC", "EC", "FIBVSMCP")

for (cell in celltypes) {
  t1dhc_run_cell_type_analysis(cell, 
                         input_path = input_path,
                         input_suffix = input_suffix,
                         output_prefix = output_prefix,
                         output_base_path = output_base_path,
                         plot_title = plot_title,
                         bg_path = bg_path)
}

```

