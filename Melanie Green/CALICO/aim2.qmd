---
title: "CALICO Aim 2 Analyses"
author: "Tim Vigers"
date: "today"
date-format: long
format:
  html:
    toc: true
    toc-depth: 5
    toc-float: true
    code-fold: true
    self-contained: true
    fig-cap-location: top
    page-layout: full
    theme:
      light: flatly
      dark: darkly
editor: source
---

```{r setup}
#| include: false
library(Hmisc)
library(tidyverse)
library(arsenal)
library(lmerTest)
library(performance)
library(emmeans)
library(gtsummary)
library(gt)
library(ggeffects)
home_dir <- switch(Sys.info()["sysname"],
  "Darwin" = "/Users/timvigers/Library/CloudStorage/OneDrive-TheUniversityofColoradoDenver/Vigers/BDC/Janet Snell-Bergeon/CALICO",
  "Linux" = "/home/timvigers/OneDrive/Vigers/BDC/Janet Snell-Bergeon/CALICO"
)
knitr::opts_knit$set(root.dir = home_dir)
```

```{r data import}
# Load data
load("./Data_Clean/analysis_data.RData")
# Combine factor levels
levels(df$insur_type) <- c(
  "Public", "Private", "Military", "Other/None", "Other/None"
)
df$insur_type <- relevel(df$insur_type, ref = "Private")
levels(df$combined_race) <- c(
  "African American", "Other", "Asian", "Caucasian", "More than one", "Other",
  "Other"
)
df$combined_race <- relevel(df$combined_race, ref = "Caucasian")
# Remove crazy values for now (ask Grayson to fix in REDCap)
df$cv_dbp[df$cv_dbp >= 200] <- NA
df$cv_bmi[df$cv_bmi >= 200] <- NA
df$cv_weight[df$cv_weight >= 1000] <- NA
df$cv_monthssincepcosdx[df$cv_monthssincepcosdx >= 1000] <- NA
df$cv_age[which.max(df$cv_age)] <- 17.2
df$weight_cat[df$record_number == "KC_24" &
  df$redcap_repeat_instance == 1] <- NA
df$weight_cat[df$record_number == "BCH15"] <- NA
# Get time of medication start for EC, Metformin, "lifestyle", and baseline
# weight
df <- df %>%
  arrange(record_number, cv_monthssincepcosdx) %>%
  group_by(record_number) %>%
  mutate(
    time_of_first_ec = first(cv_monthssincepcosdx[ec == "Yes"], na_rm = T),
    time_from_first_ec = cv_monthssincepcosdx - time_of_first_ec,
    time_of_first_metformin =
      first(cv_monthssincepcosdx[metformin == "Yes"], na_rm = T),
    time_from_first_metformin = cv_monthssincepcosdx - time_of_first_metformin,
    time_of_first_lifestyle =
      first(cv_monthssincepcosdx[lifestyle == "Yes"], na_rm = T),
    time_from_first_lifestyle = cv_monthssincepcosdx - time_of_first_lifestyle,
    baseline_weight = first(cv_weight, na_rm = T),
    baseline_bmi = first(cv_weight, na_rm = T)
  )
label(df$time_from_first_ec) <- "Time from First Visit on EC"
label(df$time_from_first_metformin) <- "Time from First Visit on Metformin"
label(df$time_from_first_lifestyle) <-
  "Time from First Visit not on Metformin or EC"
label(df$baseline_weight) <- "Baseline Weight (kg)"
label(df$baseline_bmi) <- "Baseline BMI"
# Exclude visits where people were on weight loss medication or progesterone
weight_loss <- df %>%
  filter(
    cv_medications___25 == "Checked" | cv_medications___26 == "Checked" |
      cv_medications___27 == "Checked" | cv_medications___28 == "Checked" |
      cv_medications___29 == "Checked"
  )
progesterone_meds <- df %>%
  filter(
    cv_medications___9 == "Checked" | cv_medications___10 == "Checked" |
      cv_medications___11 == "Checked" | cv_medications___12 == "Checked"
  )
df <- df %>% filter(
  cv_medications___25 != "Checked", cv_medications___26 != "Checked",
  cv_medications___27 != "Checked", cv_medications___28 != "Checked",
  cv_medications___29 != "Checked", cv_medications___17 != "Checked",
  cv_medications___9 != "Checked", cv_medications___10 != "Checked",
  cv_medications___11 != "Checked", cv_medications___12 != "Checked"
)
# Simplify the dataset
df <- df %>%
  select(
    record_number, combined_race, insur_type, cv_age, pcosdx_age,
    baseline_weight, cv_monthssincepcosdx, cv_medications___16, ec, metformin,
    lifestyle, time_from_first_ec, time_from_first_metformin,
    time_from_first_lifestyle, cv_weight, cv_bmi, cv_a1c, cv_tg, cv_hdl,
    cv_alt, cv_sbp
  ) %>%
  arrange(record_number, cv_monthssincepcosdx)
# Write for Melanie and Grayson to check
write.csv(df,
  file = "./Data_Clean/aim_2_cleaned_data.csv", row.names = F, na = ""
)
# Set table options
mycontrols <-
  tableby.control(
    numeric.stats = c("N", "Nmiss2", "meansd", "range"),
    cat.stats = c("N", "Nmiss2", "countpct")
  )
```

# Data cleaning

- KC_16's 5th visit has a `cv_monthssincepcosdx` value of 12,027 because the date of follow up is 09-03-3019. This visit is excluded for now.

- DEN-3010 has a weight of 1,152, which is excluded for now.

- DEN-3004 has a weight of 1,123.3, which is excluded for now. Same with their high BMI.

- DEN-3006 has a height of 1.55 cm, so their BMI is excluded for now.

- DEN-3010 has a BMI of 443.9, which is excluded for now.

- COL-1624 has a DBP of 701, which is excluded for now.

- KC_54 has a BMI of 237.3, which is excluded for now.

- KC_16 has a follow up age of 1017.2, which was changed to 17.2.

- Visits where the participant was actively on a weight loss medication were excluded from these analyses. So, if any of `cv_medications___25` ("Topiramate for weight loss"), `cv_medications___26` ("Phentermine for weight"), `cv_medications___27` ("Topirimate/phentermine for weight loss"), `cv_medications___28` ("Liraglutiade (saxcenda) for weight loss"), or `cv_medications___29` ("Semaglutide (Wygovy/Ozempic) for weight loss") were equal to "Checked," that row was excluded. There were a total of `r length(unique(weight_loss$record_number))` participants with a visit excluded this way, and a total of `r as.numeric(table(weight_loss$cv_medications___25)["Checked"])` visits with `cv_medications___25` checked, `r as.numeric(table(weight_loss$cv_medications___26)["Checked"])` visits with `cv_medications___26` checked, `r as.numeric(table(weight_loss$cv_medications___27)["Checked"])` visits with `cv_medications___27` checked, `r as.numeric(table(weight_loss$cv_medications___28)["Checked"])` visits with `cv_medications___28` checked, and `r as.numeric(table(weight_loss$cv_medications___29)["Checked"])` visits with `cv_medications___29` checked.

- Visits where the participant was on atypical antipsychotics were excluded (`cv_medications___17` == "Checked"). 

- We also excluded `r nrow(progesterone_meds)` visits where the participant was on progesterone-containing medications. There were `r sum(progesterone_meds$cv_medications___9=="Checked")` with `cv_medication_9` checked, `r sum(progesterone_meds$cv_medications___10=="Checked")` with `cv_medication_10` checked, `r sum(progesterone_meds$cv_medications___11=="Checked")` with `cv_medication_11` checked, and `r sum(progesterone_meds$cv_medications___12=="Checked")` with `cv_medication_12` checked.

- About 25% of clinic visits were missing `cv_age` so I recalculated this variable using `cv_monthssincepcosdx` and `pcosdx_age`.

# Methods

For each continuous outcome, we fit a linear mixed effects model with random effects for participant, and an interaction effect between time and medication status. 

To evaluate the effect of starting a new medication on each outcome, we also fit a linear spline model with months from medication start as the time variable and a single knot at 0 (medication start).

All models were adjusted for race, insurance status at diagnosis, age, and spironolactone use. EC models were adjusted for Metformin use, and vice versa.

Analyses were stratified by weight category at first visit. If BMI percentile was available, < 85 was considered normal weight, >= 85 and < 95 was considered overweight, and >= 95 was considered obese. If percentile was not available, a raw BMI of < 25 was considered normal weight, >= 25 and < 30 was considered overweight, and >= 30 was considered obese.

All mixed models were fit using the `lme4` R package in version `r paste0(R.version$major,".",R.version$minor)`. @rcoreteamLanguageEnvironmentStatistical2024

# Estrogen-containing medication

Participants were considered to be on estrogen-containing (EC) medications when `cv_medications___5` (estrogen-containing pill), `cv_medications___6` (estrogen-containing patch), or `cv_medications___7` (estrogen-containing ring) boxes were checked in REDCap.

## Weight (kg)

### Model results

#### EC users vs. non-users

```{r}
# Fit mixed model
mod <- lmer(
  cv_weight ~ cv_monthssincepcosdx * ec + cv_age + baseline_weight + combined_race +
    insur_type + metformin + cv_medications___16 + (1 | record_number),
  data = df
)
# Model plot
plot(predict_response(mod, c("cv_monthssincepcosdx", "ec")))
# Model summary
mod %>% tbl_regression(
  pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001),
  estimate_fun = ~ style_number(.x, digits = 4)
)
# EMMs
emt <- emtrends(mod, "ec", var = "cv_monthssincepcosdx")
gt(as.data.frame(emt)) %>% fmt_number(decimals = 4)
```

In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on EC and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on EC compared to not on EC. The second table shows the slopes for those not on EC and on EC, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model).

#### Change pre- vs. post-EC (EC users only)

To evaluate change in outcomes pre- vs. post-EC, we limited the dataset to people who were on EC at some point. We also limited the "before" medication data to observations within 12 months prior to medication start. All clinic visits after first medication exposure where the participants were recorded as not on medication were excluded from the analyses. 

```{r}
never_ec <- setdiff(df$record_number, unique(df$record_number[df$ec == "Yes"]))
# Create a dataset for the spline model
ec_12_month_spline <- df %>%
  filter(
    !record_number %in% never_ec,
    (time_from_first_ec < 0 & time_from_first_ec > -12) |
      time_from_first_ec >= 0 & ec == "Yes"
  ) %>%
  mutate(x = (time_from_first_ec > 0) * time_from_first_ec) %>%
  arrange(record_number, cv_monthssincepcosdx)
label(ec_12_month_spline$x) <- "Change in Slope After EC Start"
# Fit mixed model with change point
change_mod <- lmer(cv_weight ~ time_from_first_ec + x + baseline_weight +
  cv_age + combined_race + insur_type + metformin +
  (1 | record_number), data = ec_12_month_spline)
# Model plot
mod_df <- change_mod@frame
mod_df$cv_age <- mean(mod_df$cv_age)
mod_df$baseline_weight <- mean(mod_df$baseline_weight)
mod_df$combined_race <- "Caucasian"
mod_df$insur_type <- "Private"
mod_df$metformin <- "No"
mod_df$ind_pred <- predict(change_mod)
pred =  predict(change_mod, re.form = NA, newdata = mod_df,se.fit=T)
mod_df$pop_pred <- pred$fit
mod_df$pop_pred_ll=pred$fit - 1.96*pred$se.fit
mod_df$pop_pred_ul=pred$fit + 1.96*pred$se.fit
p <- ggplot(mod_df, aes(x = time_from_first_ec)) +
  geom_ribbon(aes(ymin = pop_pred_ll,ymax = pop_pred_ul),colour="lightgrey", fill="lightgrey")+
  geom_line(aes(y = pop_pred)) +
  xlab("Months From EC Start") +
  theme_bw() 
p
# Model summary
change_mod %>% tbl_regression(
  pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001),
  estimate_fun = ~ style_number(.x, digits = 4)
)
```

In the table, the row labeled "Months From First EC" is the slope prior to starting medication, and the "Slope Change After EC" row shows the average change in slope after starting the medication.

<!-- ## BMI -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(ec)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_bmi, group = record_number, -->
<!--     color = ec -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On EC?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### EC users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_bmi ~ cv_monthssincepcosdx * ec + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + metformin + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$metformin <- "No" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_bmi, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = ec, color = ec)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On EC?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "ec", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$ec)["No"])` "No" and `r as.numeric(table(mod_df$ec)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on EC and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on EC compared to not on EC. The second table shows the slopes for those not on EC and on EC, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-EC (EC users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_bmi ~ time_from_first_ec + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + metformin + -->
<!--   (1 | record_number), data = ec_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$metformin <- "No" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_ec)) + -->
<!--   geom_point(aes(y = cv_bmi, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From EC Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First EC" is the slope prior to starting medication, and the "Slope Change After EC" row shows the average change in slope after starting the medication. -->

<!-- ## HbA1c (%) -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(ec)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_a1c, group = record_number, -->
<!--     color = ec -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On EC?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### EC users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_a1c ~ cv_monthssincepcosdx * ec + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + metformin + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$metformin <- "No" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_a1c, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = ec, color = ec)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On EC?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "ec", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$ec)["No"])` "No" and `r as.numeric(table(mod_df$ec)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on EC and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on EC compared to not on EC. The second table shows the slopes for those not on EC and on EC, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-EC (EC users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_a1c ~ time_from_first_ec + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + metformin + -->
<!--   (1 | record_number), data = ec_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$metformin <- "No" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_ec)) + -->
<!--   geom_point(aes(y = cv_a1c, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From EC Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First EC" is the slope prior to starting medication, and the "Slope Change After EC" row shows the average change in slope after starting the medication. -->

<!-- ## TG (mg/dL) -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(ec)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_tg, group = record_number, -->
<!--     color = ec -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On EC?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### EC users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_tg ~ cv_monthssincepcosdx * ec + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + metformin + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$metformin <- "No" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_tg, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = ec, color = ec)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On EC?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "ec", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$ec)["No"])` "No" and `r as.numeric(table(mod_df$ec)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on EC and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on EC compared to not on EC. The second table shows the slopes for those not on EC and on EC, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-EC (EC users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_tg ~ time_from_first_ec + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + metformin + -->
<!--   (1 | record_number), data = ec_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$metformin <- "No" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_ec)) + -->
<!--   geom_point(aes(y = cv_tg, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From EC Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First EC" is the slope prior to starting medication, and the "Slope Change After EC" row shows the average change in slope after starting the medication. -->

<!-- ## HDL (mg/dL) -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(ec)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_hdl, group = record_number, -->
<!--     color = ec -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On EC?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### EC users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_hdl ~ cv_monthssincepcosdx * ec + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + metformin + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$metformin <- "No" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_hdl, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = ec, color = ec)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On EC?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "ec", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$ec)["No"])` "No" and `r as.numeric(table(mod_df$ec)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on EC and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on EC compared to not on EC. The second table shows the slopes for those not on EC and on EC, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-EC (EC users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_hdl ~ time_from_first_ec + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + metformin + -->
<!--   (1 | record_number), data = ec_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$metformin <- "No" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_ec)) + -->
<!--   geom_point(aes(y = cv_hdl, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From EC Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First EC" is the slope prior to starting medication, and the "Slope Change After EC" row shows the average change in slope after starting the medication. -->

<!-- ## ALT (IU/L)  -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(ec)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_alt, group = record_number, -->
<!--     color = ec -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On EC?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### EC users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_alt ~ cv_monthssincepcosdx * ec + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + metformin + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$metformin <- "No" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_alt, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = ec, color = ec)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On EC?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "ec", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$ec)["No"])` "No" and `r as.numeric(table(mod_df$ec)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on EC and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on EC compared to not on EC. The second table shows the slopes for those not on EC and on EC, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-EC (EC users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_alt ~ time_from_first_ec + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + metformin + -->
<!--   (1 | record_number), data = ec_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$metformin <- "No" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_ec)) + -->
<!--   geom_point(aes(y = cv_alt, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From EC Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First EC" is the slope prior to starting medication, and the "Slope Change After EC" row shows the average change in slope after starting the medication. -->

<!-- ## SBP (mmHg) -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(ec)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_sbp, group = record_number, -->
<!--     color = ec -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On EC?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### EC users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_sbp ~ cv_monthssincepcosdx * ec + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + metformin + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$metformin <- "No" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_sbp, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = ec, color = ec)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On EC?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "ec", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$ec)["No"])` "No" and `r as.numeric(table(mod_df$ec)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on EC and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on EC compared to not on EC. The second table shows the slopes for those not on EC and on EC, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-EC (EC users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_sbp ~ time_from_first_ec + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + metformin + -->
<!--   (1 | record_number), data = ec_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$metformin <- "No" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_ec)) + -->
<!--   geom_point(aes(y = cv_sbp, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From EC Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First EC" is the slope prior to starting medication, and the "Slope Change After EC" row shows the average change in slope after starting the medication. -->

<!-- # Metformin -->

<!-- Participants were considered to be on Metformin when `cv_medications___1` was checked in REDCap. -->

<!-- ```{r} -->
<!-- # Get baseline weight and BMI -->
<!-- df <- df %>% -->
<!--   group_by(record_number) %>% -->
<!--   mutate( -->
<!--     baseline_weight = first(cv_weight[metformin == "No"], na_rm = T), -->
<!--     baseline_bmi = first(cv_bmi[metformin == "No"], na_rm = T) -->
<!--   ) %>% -->
<!--   ungroup() -->
<!-- label(df$baseline_weight) <- "Baseline Weight (kg)" -->
<!-- label(df$baseline_bmi) <- "Baseline BMI" -->
<!-- # Make a dataset for spline models -->
<!-- metformin_only <- df %>% -->
<!--   filter(metformin_ever == "Metformin Ever") %>% -->
<!--   filter(cv_monthssincepcosdx < pre_post_metformin | metformin_ever == "No") %>% -->
<!--   mutate( -->
<!--     time_from_first_metformin = time_from_first_metformin * 12, -->
<!--     x = (time_from_first_metformin > 0) * time_from_first_metformin -->
<!--   ) -->
<!-- label(metformin_only$time_from_first_metformin) <- "Months From First Metformin" -->
<!-- label(metformin_only$x) <- "Slope Change After Metformin" -->
<!-- ``` -->

<!-- ## Comparisons at first visit -->

<!-- ```{r results='asis'} -->
<!-- t1 <- tableby(update(f, metformin_ever ~ . - metformin_ever), -->
<!--   data = baseline, -->
<!--   control = mycontrols -->
<!-- ) -->
<!-- summary(t1, pfootnote = T, digits = 4, digits.p = 4) -->
<!-- ``` -->

<!-- ## Weight (kg) -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(metformin)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_weight, group = record_number, -->
<!--     color = metformin -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On Metformin?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### Metformin users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_weight ~ cv_monthssincepcosdx * metformin + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + ec + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ec <- "No" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_weight, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = metformin, color = metformin)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On Metformin?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "metformin", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$metformin)["No"])` "No" and `r as.numeric(table(mod_df$metformin)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on Metformin and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on Metformin compared to not on Metformin. The second table shows the slopes for those not on Metformin and on Metformin, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-Metformin (Metformin users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_weight ~ time_from_first_metformin + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + ec + -->
<!--   (1 | record_number), data = metformin_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ec <- "No" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_metformin)) + -->
<!--   geom_point(aes(y = cv_weight, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From Metformin Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First Metformin" is the slope prior to starting medication, and the "Slope Change After Metformin" row shows the average change in slope after starting the medication. -->

<!-- ## BMI -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(metformin)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_bmi, group = record_number, -->
<!--     color = metformin -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On Metformin?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### Metformin users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_bmi ~ cv_monthssincepcosdx * metformin + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + ec + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ec <- "No" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_bmi, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = metformin, color = metformin)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On Metformin?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "metformin", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$metformin)["No"])` "No" and `r as.numeric(table(mod_df$metformin)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on Metformin and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on Metformin compared to not on Metformin. The second table shows the slopes for those not on Metformin and on Metformin, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-Metformin (Metformin users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_bmi ~ time_from_first_metformin + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + ec + -->
<!--   (1 | record_number), data = metformin_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ec <- "No" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_metformin)) + -->
<!--   geom_point(aes(y = cv_bmi, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From Metformin Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First Metformin" is the slope prior to starting medication, and the "Slope Change After Metformin" row shows the average change in slope after starting the medication. -->

<!-- ## HbA1c (%) -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(metformin)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_a1c, group = record_number, -->
<!--     color = metformin -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On Metformin?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### Metformin users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_a1c ~ cv_monthssincepcosdx * metformin + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + ec + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ec <- "No" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_a1c, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = metformin, color = metformin)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On Metformin?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "metformin", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$metformin)["No"])` "No" and `r as.numeric(table(mod_df$metformin)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on Metformin and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on Metformin compared to not on Metformin. The second table shows the slopes for those not on Metformin and on Metformin, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-Metformin (Metformin users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_a1c ~ time_from_first_metformin + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + ec + -->
<!--   (1 | record_number), data = metformin_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ec <- "No" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_metformin)) + -->
<!--   geom_point(aes(y = cv_a1c, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From Metformin Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First Metformin" is the slope prior to starting medication, and the "Slope Change After Metformin" row shows the average change in slope after starting the medication. -->

<!-- ## TG (mg/dL) -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(metformin)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_tg, group = record_number, -->
<!--     color = metformin -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On Metformin?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### Metformin users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_tg ~ cv_monthssincepcosdx * metformin + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + ec + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ec <- "No" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_tg, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = metformin, color = metformin)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On Metformin?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "metformin", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$metformin)["No"])` "No" and `r as.numeric(table(mod_df$metformin)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on Metformin and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on Metformin compared to not on Metformin. The second table shows the slopes for those not on Metformin and on Metformin, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-Metformin (Metformin users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_tg ~ time_from_first_metformin + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + ec + -->
<!--   (1 | record_number), data = metformin_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ec <- "No" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_metformin)) + -->
<!--   geom_point(aes(y = cv_tg, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From Metformin Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First Metformin" is the slope prior to starting medication, and the "Slope Change After Metformin" row shows the average change in slope after starting the medication. -->

<!-- ## HDL (mg/dL) -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(metformin)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_hdl, group = record_number, -->
<!--     color = metformin -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On Metformin?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### Metformin users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_hdl ~ cv_monthssincepcosdx * metformin + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + ec + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ec <- "No" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_hdl, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = metformin, color = metformin)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On Metformin?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "metformin", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$metformin)["No"])` "No" and `r as.numeric(table(mod_df$metformin)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on Metformin and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on Metformin compared to not on Metformin. The second table shows the slopes for those not on Metformin and on Metformin, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-Metformin (Metformin users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_hdl ~ time_from_first_metformin + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + ec + -->
<!--   (1 | record_number), data = metformin_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ec <- "No" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_metformin)) + -->
<!--   geom_point(aes(y = cv_hdl, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From Metformin Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First Metformin" is the slope prior to starting medication, and the "Slope Change After Metformin" row shows the average change in slope after starting the medication. -->

<!-- ## ALT (IU/L)  -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(metformin)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_alt, group = record_number, -->
<!--     color = metformin -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On Metformin?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### Metformin users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_alt ~ cv_monthssincepcosdx * metformin + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + ec + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ec <- "No" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_alt, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = metformin, color = metformin)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On Metformin?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "metformin", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$metformin)["No"])` "No" and `r as.numeric(table(mod_df$metformin)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on Metformin and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on Metformin compared to not on Metformin. The second table shows the slopes for those not on Metformin and on Metformin, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-Metformin (Metformin users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_alt ~ time_from_first_metformin + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + ec + -->
<!--   (1 | record_number), data = metformin_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ec <- "No" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_metformin)) + -->
<!--   geom_point(aes(y = cv_alt, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From Metformin Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First Metformin" is the slope prior to starting medication, and the "Slope Change After Metformin" row shows the average change in slope after starting the medication. -->

<!-- ## SBP (mmHg) -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(metformin)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_sbp, group = record_number, -->
<!--     color = metformin -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On Metformin?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### Metformin users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_sbp ~ cv_monthssincepcosdx * metformin + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + ec + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ec <- "No" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_sbp, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = metformin, color = metformin)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On Metformin?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "metformin", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$metformin)["No"])` "No" and `r as.numeric(table(mod_df$metformin)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on Metformin and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on Metformin compared to not on Metformin. The second table shows the slopes for those not on Metformin and on Metformin, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-Metformin (Metformin users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_sbp ~ time_from_first_metformin + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + ec + -->
<!--   (1 | record_number), data = metformin_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ec <- "No" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_metformin)) + -->
<!--   geom_point(aes(y = cv_sbp, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From Metformin Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First Metformin" is the slope prior to starting medication, and the "Slope Change After Metformin" row shows the average change in slope after starting the medication. -->

<!-- # Lifestyle Medicine -->

<!-- Participants were considered to be "on lifestyle medicine" when not on Metformin or EC as described above. -->

<!-- ```{r} -->
<!-- # Get baseline weight and BMI -->
<!-- df <- df %>% -->
<!--   group_by(record_number) %>% -->
<!--   mutate( -->
<!--     baseline_weight = first(cv_weight[lifestyle == "No"], na_rm = T), -->
<!--     baseline_bmi = first(cv_bmi[lifestyle == "No"], na_rm = T) -->
<!--   ) %>% -->
<!--   ungroup() -->
<!-- label(df$baseline_weight) <- "Baseline Weight (kg)" -->
<!-- label(df$baseline_bmi) <- "Baseline BMI" -->
<!-- # Make a dataset for spline models -->
<!-- lifestyle_only <- df %>% -->
<!--   filter(lifestyle_ever == "Lifestyle Ever") %>% -->
<!--   filter(cv_monthssincepcosdx < pre_post_lifestyle | lifestyle_ever == "No") %>% -->
<!--   mutate( -->
<!--     time_from_first_lifestyle = time_from_first_lifestyle * 12, -->
<!--     x = (time_from_first_lifestyle > 0) * time_from_first_lifestyle -->
<!--   ) -->
<!-- label(lifestyle_only$time_from_first_lifestyle) <- "Months From First Lifestyle Medicine" -->
<!-- label(lifestyle_only$x) <- "Slope Change After Lifestyle Medicine" -->
<!-- ``` -->

<!-- ## Comparisons at first visit -->

<!-- ```{r results='asis'} -->
<!-- t1 <- tableby(update(f, lifestyle_ever ~ . - lifestyle_ever), -->
<!--   data = baseline, -->
<!--   control = mycontrols -->
<!-- ) -->
<!-- summary(t1, pfootnote = T, digits = 4, digits.p = 4) -->
<!-- ``` -->

<!-- ## Weight (kg) -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(lifestyle)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_weight, group = record_number, -->
<!--     color = lifestyle -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On Lifestyle Medicine?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### Lifestyle Medicine users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_weight ~ cv_monthssincepcosdx * lifestyle + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_weight, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = lifestyle, color = lifestyle)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On Lifestyle Medicine?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "lifestyle", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$lifestyle)["No"])` "No" and `r as.numeric(table(mod_df$lifestyle)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on lifestyle medicine and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on lifestyle medicine compared to not on lifestyle medicine. The second table shows the slopes for those not on lifestyle medicine and on lifestyle medicine, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-lifestyle medicine (lifestyle medicine users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_weight ~ time_from_first_lifestyle + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + -->
<!--   (1 | record_number), data = lifestyle_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_lifestyle)) + -->
<!--   geom_point(aes(y = cv_weight, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From Lifestyle Medicine Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First Lifestyle Medicine" is the slope prior to starting medication, and the "Slope Change After Lifestyle Medicine" row shows the average change in slope after starting the medication. -->

<!-- ## BMI -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(lifestyle)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_bmi, group = record_number, -->
<!--     color = lifestyle -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On Lifestyle Medicine?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### Lifestyle Medicine users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_bmi ~ cv_monthssincepcosdx * lifestyle + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_bmi, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = lifestyle, color = lifestyle)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On Lifestyle Medicine?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "lifestyle", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$lifestyle)["No"])` "No" and `r as.numeric(table(mod_df$lifestyle)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on lifestyle medicine and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on lifestyle medicine compared to not on lifestyle medicine. The second table shows the slopes for those not on lifestyle medicine and on lifestyle medicine, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-lifestyle medicine (lifestyle medicine users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_bmi ~ time_from_first_lifestyle + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + -->
<!--   (1 | record_number), data = lifestyle_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_lifestyle)) + -->
<!--   geom_point(aes(y = cv_bmi, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From Lifestyle Medicine Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First Lifestyle Medicine" is the slope prior to starting medication, and the "Slope Change After Lifestyle Medicine" row shows the average change in slope after starting the medication. -->

<!-- ## HbA1c (%) -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(lifestyle)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_a1c, group = record_number, -->
<!--     color = lifestyle -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On Lifestyle Medicine?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### Lifestyle Medicine users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_a1c ~ cv_monthssincepcosdx * lifestyle + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_a1c, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = lifestyle, color = lifestyle)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On Lifestyle Medicine?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "lifestyle", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$lifestyle)["No"])` "No" and `r as.numeric(table(mod_df$lifestyle)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on lifestyle medicine and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on lifestyle medicine compared to not on lifestyle medicine. The second table shows the slopes for those not on lifestyle medicine and on lifestyle medicine, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-lifestyle medicine (lifestyle medicine users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_a1c ~ time_from_first_lifestyle + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + -->
<!--   (1 | record_number), data = lifestyle_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_lifestyle)) + -->
<!--   geom_point(aes(y = cv_a1c, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From Lifestyle Medicine Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First Lifestyle Medicine" is the slope prior to starting medication, and the "Slope Change After Lifestyle Medicine" row shows the average change in slope after starting the medication. -->

<!-- ## TG (mg/dL) -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(lifestyle)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_tg, group = record_number, -->
<!--     color = lifestyle -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On Lifestyle Medicine?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### Lifestyle Medicine users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_tg ~ cv_monthssincepcosdx * lifestyle + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_tg, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = lifestyle, color = lifestyle)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On Lifestyle Medicine?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "lifestyle", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$lifestyle)["No"])` "No" and `r as.numeric(table(mod_df$lifestyle)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on lifestyle medicine and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on lifestyle medicine compared to not on lifestyle medicine. The second table shows the slopes for those not on lifestyle medicine and on lifestyle medicine, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-lifestyle medicine (lifestyle medicine users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_tg ~ time_from_first_lifestyle + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + -->
<!--   (1 | record_number), data = lifestyle_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_lifestyle)) + -->
<!--   geom_point(aes(y = cv_tg, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From Lifestyle Medicine Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First Lifestyle Medicine" is the slope prior to starting medication, and the "Slope Change After Lifestyle Medicine" row shows the average change in slope after starting the medication. -->

<!-- ## HDL (mg/dL) -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(lifestyle)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_hdl, group = record_number, -->
<!--     color = lifestyle -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On Lifestyle Medicine?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### Lifestyle Medicine users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_hdl ~ cv_monthssincepcosdx * lifestyle + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_hdl, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = lifestyle, color = lifestyle)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On Lifestyle Medicine?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "lifestyle", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$lifestyle)["No"])` "No" and `r as.numeric(table(mod_df$lifestyle)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on lifestyle medicine and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on lifestyle medicine compared to not on lifestyle medicine. The second table shows the slopes for those not on lifestyle medicine and on lifestyle medicine, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-lifestyle medicine (lifestyle medicine users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_hdl ~ time_from_first_lifestyle + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + -->
<!--   (1 | record_number), data = lifestyle_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_lifestyle)) + -->
<!--   geom_point(aes(y = cv_hdl, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From Lifestyle Medicine Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First Lifestyle Medicine" is the slope prior to starting medication, and the "Slope Change After Lifestyle Medicine" row shows the average change in slope after starting the medication. -->

<!-- ## ALT (IU/L)  -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(lifestyle)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_alt, group = record_number, -->
<!--     color = lifestyle -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On Lifestyle Medicine?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### Lifestyle Medicine users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_alt ~ cv_monthssincepcosdx * lifestyle + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_alt, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = lifestyle, color = lifestyle)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On Lifestyle Medicine?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "lifestyle", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$lifestyle)["No"])` "No" and `r as.numeric(table(mod_df$lifestyle)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on lifestyle medicine and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on lifestyle medicine compared to not on lifestyle medicine. The second table shows the slopes for those not on lifestyle medicine and on lifestyle medicine, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-lifestyle medicine (lifestyle medicine users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_alt ~ time_from_first_lifestyle + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + -->
<!--   (1 | record_number), data = lifestyle_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_lifestyle)) + -->
<!--   geom_point(aes(y = cv_alt, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From Lifestyle Medicine Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First Lifestyle Medicine" is the slope prior to starting medication, and the "Slope Change After Lifestyle Medicine" row shows the average change in slope after starting the medication. -->

<!-- ## SBP (mmHg) -->

<!-- ### Spaghetti plot -->

<!-- ```{r} -->
<!-- p <- df %>% -->
<!--   filter(!is.na(lifestyle)) %>% -->
<!--   ggplot(aes( -->
<!--     x = cv_monthssincepcosdx, y = cv_sbp, group = record_number, -->
<!--     color = lifestyle -->
<!--   )) + -->
<!--   geom_line(alpha = 0.3) + -->
<!--   labs(color = "On Lifestyle Medicine?") + -->
<!--   theme_bw() -->
<!-- p -->
<!-- ``` -->

<!-- ### Model results -->

<!-- #### Lifestyle Medicine users vs. non-users -->

<!-- ```{r} -->
<!-- # Fit mixed model -->
<!-- mod <- lmer( -->
<!--   cv_sbp ~ cv_monthssincepcosdx * lifestyle + cv_age + baseline_weight + -->
<!--     combined_race + insur_type + (1 | record_number), -->
<!--   data = df -->
<!-- ) -->
<!-- # Model plot -->
<!-- mod_df <- mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ind_pred <- predict(mod) -->
<!-- mod_df$pop_pred <- predict(mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = cv_monthssincepcosdx)) + -->
<!--   geom_point(aes(y = cv_sbp, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred, group = lifestyle, color = lifestyle)) + -->
<!--   xlab("Months from PCOS Dx") + -->
<!--   labs(color = "On Lifestyle Medicine?") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- # EMMs -->
<!-- emt <- emtrends(mod, "lifestyle", var = "cv_monthssincepcosdx") -->
<!-- gt(as.data.frame(emt)) %>% fmt_number(decimals = 4) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations (`r as.numeric(table(mod_df$lifestyle)["No"])` "No" and `r as.numeric(table(mod_df$lifestyle)["Yes"])` "Yes"). In the first table, the row labelled "Months since PCOS diagnosis" indicates the slope for a participant not on lifestyle medicine and in the reference group for categorical variables. The interaction term labelled "Months since PCOS diagnosis * Yes" indicates the difference in slope between someone on lifestyle medicine compared to not on lifestyle medicine. The second table shows the slopes for those not on lifestyle medicine and on lifestyle medicine, and the third table shows the difference in slopes (both table estimates are averaged over the other variables in the model). -->

<!-- #### Change pre- vs. post-lifestyle medicine (lifestyle medicine users only) -->

<!-- ```{r} -->
<!-- # Fit mixed model with change point -->
<!-- change_mod <- lmer(cv_sbp ~ time_from_first_lifestyle + x + baseline_weight + -->
<!--   cv_age + combined_race + insur_type + -->
<!--   (1 | record_number), data = lifestyle_only) -->
<!-- # Model plot -->
<!-- mod_df <- change_mod@frame -->
<!-- mod_df$cv_age <- mean(mod_df$cv_age) -->
<!-- mod_df$baseline_weight <- mean(mod_df$baseline_weight) -->
<!-- mod_df$combined_race <- "Caucasian" -->
<!-- mod_df$insur_type <- "Private" -->
<!-- mod_df$ind_pred <- predict(change_mod) -->
<!-- mod_df$pop_pred <- predict(change_mod, re.form = NA, newdata = mod_df) -->
<!-- p <- ggplot(mod_df, aes(x = time_from_first_lifestyle)) + -->
<!--   geom_point(aes(y = cv_sbp, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = ind_pred, group = record_number), -->
<!--     alpha = 0.05, show.legend = F -->
<!--   ) + -->
<!--   geom_line(aes(y = pop_pred)) + -->
<!--   xlab("Months From Lifestyle Medicine Start") + -->
<!--   theme_bw() + -->
<!--   scale_color_manual(values = c("#E41A1C", "#377EB8")) -->
<!-- p -->
<!-- # Model summary -->
<!-- change_mod %>% tbl_regression( -->
<!--   pvalue_fun = ~ format.pval(.x, digits = 4, eps = 0.0001), -->
<!--   estimate_fun = ~ style_number(.x, digits = 4) -->
<!-- ) -->
<!-- ``` -->

<!-- The model above was fit using `r nrow(mod_df)` observations. In the table, the row labeled "Months From First Lifestyle Medicine" is the slope prior to starting medication, and the "Slope Change After Lifestyle Medicine" row shows the average change in slope after starting the medication. -->
