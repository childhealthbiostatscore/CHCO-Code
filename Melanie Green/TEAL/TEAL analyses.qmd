---
title: "Melanie Cree - TEAL Study"
author: "Laura Pyle"
date: "today"
date-format: long
format:
  html:
    toc: true
    toc-depth: 5
    toc-float: true
    code-fold: true
    self-contained: true
    fig-cap-location: top
    page-layout: full
editor: source
execute:
  echo: false
  message: false
---

```{r libraries}
#| include: false
library(tidyverse)
library(arsenal)
library(dplyr)
library(labelled)
```

```{r data import}
#| include: false
source("/Volumes/Peds Endo/Melanie Green/TEAL/Data_raw/190636TEAL_R_2023-12-05_1149.R")
data <- remove_labels(data)

# remove screen fails
data <- data %>% filter(!study_group == 3)

# wide dataset with needed variables
keep_wide <- data %>% select(subject_id, study_group.factor, age, bmi_cat.factor, tanner,
                             screen_wt, screen_height, screen_bmi, screen_bmi_percentile, screen_bmi_zscore,
                             baseline_wt, baseline_ht, baseline_bmi, baseline_bmi_perc, baseline_bmi_zscore,
                             mid_wt_2, mid_ht_2, mid_bmi_2, mid_bmi_perc_2, mid_bmi_zscore_2,
                             final_wt_3, final_ht_3, final_bmi_3, final_bmi_perc_3, final_bmi_zscore_3,
                             liver_fat_perc, liver_fat_perc_final,
                             dmets, mid_3dmets, dmets_final,
                             kcals_total, kcals_day_final,
                             t_ahi, t_ahi_final,
                             homa, matsuda, 
                             homa_final, matsuda_final 
                             )
keep_wide <- keep_wide %>% mutate_at(c("screen_wt", "screen_height", "screen_bmi", "screen_bmi_percentile", "screen_bmi_zscore",
                             "baseline_wt", "baseline_ht", "baseline_bmi", "baseline_bmi_perc", 'baseline_bmi_zscore',
                             "mid_wt_2", "mid_ht_2", "mid_bmi_2", "mid_bmi_perc_2", "mid_bmi_zscore_2",
                             "final_wt_3", "final_ht_3", "final_bmi_3", "final_bmi_perc_3", "final_bmi_zscore_3",
                             "liver_fat_perc", "liver_fat_perc_final",
                             "dmets", "mid_3dmets", "dmets_final",
                             "kcals_total", "kcals_day_final",
                             "t_ahi", "t_ahi_final",
                             "homa", "matsuda", 
                             "homa_final", "matsuda_final"), as.numeric)

# rename variables to make it easier to make a long dataset
keep_wide <- keep_wide %>% rename( screen_weight = screen_wt, 
                                   screen_bmipercentile = screen_bmi_percentile, 
                                   screen_bmizscore = screen_bmi_zscore,
                                   baseline_weight = baseline_wt, 
                                   baseline_height = baseline_ht, 
                                   baseline_bmipercentile = baseline_bmi_perc, 
                                   baseline_bmizscore = baseline_bmi_zscore,
                                   week8_weight = mid_wt_2, 
                                   week8_height = mid_ht_2, 
                                   week8_bmi = mid_bmi_2, 
                                   week8_bmipercentile = mid_bmi_perc_2, 
                                   week8_bmizscore = mid_bmi_zscore_2,
                                   week16_weight = final_wt_3, 
                                   week16_height = final_ht_3, 
                                   week16_bmi = final_bmi_3, 
                                   week16_bmipercentile = final_bmi_perc_3, 
                                   week16_bmizscore = final_bmi_zscore_3,
                                   baseline_liverfatperc = liver_fat_perc, 
                                   week16_liverfatperc = liver_fat_perc_final,
                                   baseline_dmets = dmets, 
                                   week8_dmets = mid_3dmets, 
                                   week16_dmets = dmets_final,
                                   baseline_kcals = kcals_total, 
                                   week16_kcals = kcals_day_final,
                                   baseline_tahi = t_ahi, 
                                   week16_tahi = t_ahi_final,
                                   baseline_homa = homa, 
                                   baseline_matsuda =  matsuda, 
                                   week16_homa = homa_final, 
                                   week16_matsuda = matsuda_final)


# calculate absolute weight change (baseline as reference)
keep_wide$week8_abswtchange <- keep_wide$week8_weight - keep_wide$baseline_weight
keep_wide$week16_abswtchange <- keep_wide$week16_weight - keep_wide$baseline_weight

# calculate percent weight change (baseline as reference)
keep_wide$week8_perwtchange <- (keep_wide$week8_abswtchange / keep_wide$baseline_weight ) * 100
keep_wide$week16perwtchange <- (keep_wide$week16_abswtchange / keep_wide$baseline_weight) * 100

# create long dataset for mixed models
keep_long <- keep_wide %>% pivot_longer(cols = !c("subject_id", "study_group.factor", "age", "bmi_cat.factor", "tanner"),
                                        names_to = c("visit", ".value"), names_sep = "_", values_drop_na = T)
```

```{r functions}

```

# Header 1

```{r message=FALSE,warning=FALSE,dpi=1200,results='asis'}

```

