---
title: "Early Glargine Prospective"
author: "Casey Sakamoto"
date: "2/8/2022"
output: pdf_document
---

```{r setup, include=FALSE}
library(arsenal)
library(readxl)
library(readr)
library(Hmisc)
library(tidyverse)
library(performance)
library(knitr)
library(lubridate)
library(stringr)
knitr::opts_chunk$set(echo = FALSE)
if(Sys.info()["sysname"] == "Windows"){
  home_dir = "S:/Laura/Peds Endo/Ohman/Early glargine prospective"
} else if (Sys.info()["sysname"] == "Linux"){
  home_dir = "~/UCD/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/Peds Endo/Ohman/Early glargine prospective"
} else if (Sys.info()["sysname"] == "Darwin"){
  home_dir = "/Volumes/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/Peds Endo/Ohman/Early glargine prospective"
}
knitr::opts_knit$set(root.dir = home_dir)
```

TO DO : REMOVE WITHDREW CONSENT/SCREEN FAIL (screen_failure = 1, completion status = 1)
```{r data}
# raw dataset
EarlyGlargine = read_csv("S:/Laura/Peds Endo/Ohman/Early glargine prospective/EarlyGlargineInDKA_DATA_12.2021.csv")

# check screenfailure/wd
# screenfailures only have 1 line: demog
# 11 sf/wd: 1, 3, 23, 24, 25, 29, 31, 33, 34, 115, 110
EarlyGlargine_SF = EarlyGlargine %>% filter(screen_failure == 1 | completion_status == 1)
## aim 1 table data cleaning

# demographic data (1 line/subj)
EarlyGlargine_demog = EarlyGlargine %>% filter(redcap_repeat_instrument == "demographics") %>%
  select(`Patient ID`, study_group, nih_sex, nih_race, nih_ethnicity, age_at_consent)

# clinical data (1 line/subj)
EarlyGlargine_clinicalinfo =EarlyGlargine %>% filter(redcap_repeat_instrument == "clinical_information") %>% select(`Patient ID`,diabetes_diagnosis, `duration_of_t1d (years)`, glargine_dose_per_kg, home_regimen___1, home_regimen___2, home_regimen___3, home_regimen___4, home_regimen___5 )

# lab data (1 line/ hba1c, mult for ph and bicarbonate (we want admission, instance 1?))
EarlyGlargine_lab = EarlyGlargine %>% filter(redcap_repeat_instrument == "lab_results_dka" & redcap_repeat_instance == 1) %>%select(`Patient ID` ,ph, bicarbonate, hba1c)


```
Analysis plan:
Chi-squared tests will be employed to evaluate whether the difference in rebound hyperglycemia between the two study groups is statistically significant.  We will also use logistic regression to adjust for potential confounders (BMI, sex, age, established T1D versus newly-diagnosed T1D).   Using a blocked and stratified randomization plan we expect to have similar numbers of newly-diagnosed T1D and known T1D patients in each group.

The data collected by CGM will be summarized for each patient and day into variables describing glycemia, such as mean glucose, area under the curve, area under the curve >180 mg/dL, and percent of time spent above or below particular glucose thresholds (e.g., >180, <60, and <70 mg/dL). 

Trends over time in these summary statistics will be evaluated graphically to give insight into blood glucose response during treatment of DKA and immediately after resolution of DKA.  For variables without an excess of zero values, we will use linear mixed-effects models to compare trajectories over time in the two groups. 

We will also calculate the mean value of each of these statistics for each patient and compare the groups using t-tests or nonparametric equivalent.  Bland-Altman plots will be used to evaluate the agreement between CGM glucose variables (e.g., mean glucose) and POC glucose. 

To interpret the clinical relevance relevance of any discrepancies between the two sets of measures, we will use Clarke error grid analysis, which classifies pairs of blood glucose measurements made by two methods into categories based on the impact the discrepancy would have on treatment decisions.




TABLE
You can remove (or not include) all screen failures (column AC) or withdraws (column AD). 
 
For this we will compare the Control group (Late glargine) vs the Intervention (Early glargine) group 
 
1.	Patient Characteristics table
a.	Sex (nih_sex, column Q)
b.	Age range (age_at_consent, column P)
c.	Race/ethnicity (nih_race and nih_ethnicity; columns R and S) 
d.	New onset vs Established T1DM (diabetes_diagnosis; column AY) 
                                                               i.      For established T1DM:
1.       Duration of T1D (column AZ)
2.       Home regimen (columns BA-BE)
e.	HbA1c (column CQ)
                                                               i.      Early vs Late groups
                                                             ii.      New onset vs Established 
f.	Average pH at admission (or first pH); column CD
                                                               i.      Early vs Late groups
                                                             ii.      New onset vs Established 
g.	Average bicarbonate at admission (or first bicarb); column CH
                                                               i.      Early vs Late groups
                                                             ii.      New onset vs Established 
h.	Glargine dose/kg (column AS)
                                                               i.      Early vs Late groups
                                                             ii.      New onset vs Established 


```{r Patient Char Table}
# Variables
# study group (early vs late)
describe(EarlyGlargine$study_group) # n = 59 1: intervention (early) and 2: control (late)



```

