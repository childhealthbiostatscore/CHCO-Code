---
title: "Growth attenuation therapy analysis"
author: "Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    number_sections: yes
    theme: readable
    toc: yes
    toc_depth: 2
    toc_float: yes
---

```{r setup, include=FALSE}
library(knitr)
library(dplyr)
library(hrbrthemes)
library(nlme)

knitr::opts_chunk$set(echo = FALSE,warning = FALSE)

knitr::opts_chunk$set(echo = FALSE)
if(Sys.info()["sysname"] == "Windows"){
  home_dir = "E:/Davis/Growth attenuation analysis/Data raw"
} else if (Sys.info()["sysname"] == "Linux"){
  home_dir = "~/UCD/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects"
} else if (Sys.info()["sysname"] == "Darwin"){
  home_dir = "/Volumes/som/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects"
}
setwd(home_dir)
knitr::opts_knit$set(root.dir = home_dir)
```

```{r data, include=FALSE}
source("./GrowthAttenuationThe-DemographicsMedicalH_R_2022-04-10_2011.r")
demo <- data
data <- NULL

source("./GrowthAttenuationThe-BoneAge_R_2022-04-10_2017.r")
bone_age <- data
data <- NULL

source("./GrowthAttenuationThe-Labs_R_2022-04-10_2014.r")
labs <- data
data <- NULL


```

# Questions

1) Some data points are prior to start of therapy (as much as 1.4 years prior).  Some people have two values prior to start of therapy - should I use the one closest to start of therapy as "baseline"?
2) We talked about doing a sensitivity analysis including people who had been excluded due to adverse effects - how do I identify those people?

# Results

## Spaghetti plot of predicted adult height

```{r echo=FALSE, warning=FALSE}
# Spaghetti plot of predicted adult height over time
p1 <- ggplot(data=bone_age, aes(x=time_gat_ba,y=ba_pah_calc,group=record_id)) + geom_line() +
      theme_ipsum()
p1
```

## Mixed model of predicted adult height 

```{r echo=FALSE, include=FALSE}
mod1 <- lme(ba_pah_calc ~ time_gat_ba,random=~1|record_id,data = bone_age,na.action = na.omit)
```

```{r echo=FALSE, warning=FALSE, comment=""}
summary(mod1)
```