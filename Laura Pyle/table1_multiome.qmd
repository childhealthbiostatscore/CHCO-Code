---
title: "Samples for multiome"
author: "Laura Pyle"
format:
  html:
    toc: true
    toc-depth: 5
    toc-float: true
    code-fold: true
    self-contained: true
    page-layout: full
editor: source
---

```{r}
#| include: false
library(tidyverse)
library(arsenal)
library(knitr)
# Import and filter
df <- read.csv("/Volumes/Shared/Shared Projects/Laura/Peds Endo/Petter Bjornstad/Data Harmonization/Data Clean/harmonized_dataset.csv", na.strings = "")
df <- df %>% filter(visit == "baseline")
# Select variables for T1
df <- df %>%
  select(
    record_id, visit, weight, bmi,
    sex, race, ethnicity,group,
    bod_pod_body_fat, gfr_raw_plasma, gfr_bsa_plasma,
    ff, acr_u,albuminuria_cat, elevated_albuminuria,
    contains("fsoc_"), map, sbp, dbp, fbg, hba1c, airg, acprg,
    contains("glom_volume"), mes_matrix_area, mes_index,
    contains("mes_volume"), glom_nuc_count,
    metformin_timepoint, insulin_med_timepoint,
    sglti_timepoint, raasi_timepoint,kit_id
  ) %>%
  group_by(record_id, visit) %>%
  summarise_all(~ last(na.omit(.x)))
ids <- c("RH2-43-T","RH2-42-T","RH2-36-O","RH2-22-T","RH2-21-T",
         "RH2-19-T","RH2-11-O","RH2-07-O","RH-93-T","RH-77-T","RH2-51-T",
         "RH2-23-T","RH2-55-T","RH2-53-T","CRC-39","CRC-58","CRC-54","CRC-56")
df <- df %>% filter(record_id %in% ids)
df$group <- ifelse(df$record_id == "RH-93-T", "Obese Control", df$group)
# Get names
var_names <- read.csv("/Volumes/Shared/Shared Projects/Laura/Peds Endo/Petter Bjornstad/Data Harmonization/data_dictionary_master.csv", na.strings = "")
vars <- colnames(df)[3:(ncol(df)-1)]
var_names <- var_names[var_names$variable_name %in% vars, ]
labels <- as.list(var_names$label)
names(labels) <- var_names$variable_name
```

```{r results='asis'}
#| label: tbl-t1
#| tbl-cap: Comparisons by Group (Full Cohort)
t1 <- tableby(group  ~ 
                sex + race + ethnicity + 
               weight + bmi + gfr_raw_plasma + gfr_bsa_plasma + 
               ff + wt(acr_u,"Nmiss", "median", "q1q3", "range") + 
               albuminuria_cat + elevated_albuminuria +
               map + sbp + 
               dbp + fbg + hba1c + airg + acprg + 
               metformin_timepoint + insulin_med_timepoint + sglti_timepoint + 
               raasi_timepoint, 
             data = df, test = FALSE)
summary(t1, labelTranslations = labels,pfootnote = T)
```
