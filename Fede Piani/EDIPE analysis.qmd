---
title: "EDIPE analysis"
author: "Laura Pyle"
date: "`r lubridate::today()`"
format: html
editor: visual
echo: FALSE
warning: FALSE
toc: TRUE
embed-resources: TRUE
---

```{r include = F}
# =============================================================================
# LIBRARIES
# =============================================================================
library(dplyr)
library(arsenal)
library(tidyr)
library(ggplot2)
library(ggpubr)
library(ggalluvial)
library(FSA)
library(fuzzyjoin)
library(purrr)
library(stringr)
library(arsenal)
library(Hmisc)
library(SomaDataIO)
library(caret)
library(survival)
library(broom)
library(openxlsx)
library(readxl)
library(knitr)
library(limma)
library(gtsummary)
library(cardx)
library(forestploter)
library(forcats)
library(fgsea)

# specify user for paths
user <- Sys.info()[["user"]]
if (user == "laurapyle") {
  data_path <- "/Users/laurapyle/Library/CloudStorage/OneDrive-UW/Piani/Data_raw"
} else if (user == "lpyle") {
  data_path <- "/Users/lpyle/Library/CloudStorage/OneDrive-UW/Piani/Data_raw"
} else if (user == "pylell") {
  data_path <- "/Users/pylell/Library/CloudStorage/OneDrive-UW/Piani/Data_raw"
} else {
  stop("Unknown user: please specify root path for this user.")
}


```

```{r include = F}
# =============================================================================
# READ DATA 
# =============================================================================

setwd(data_path)
data <- read_xlsx("./EDIPE_wide_delta_renamed.xlsx")
data$TG_HDL_T1 <- data$TG_T1 / data$HDL_T1
data$TG_HDL_T2 <- data$TG_T2 / data$HDL_T2
data$TG_HDL_delta <- data$TG_HDL_T2 - data$TG_HDL_T1
data$`PBR4-25_T1` <- data$`PBR4-25`
data$`PBR4-25_delta` <- data$`PBR4-25_T2` - data$`PBR4-25_T1`

# identify outcome variables
outcomes <- c("HDP", "HDPbinary", "GDM", "Neonweight", "Egdelivery", "neonatalsex", "Csection")

# identify predictors
main_predictors_adj <- c("PWVcf_T1", "PWVcf_T2", "PWVcf_delta")
main_predictors <- c("PWVcf_at_85PAM_T1",	"PWVcf_at_85PAM_T2", "PWVcf_at_85PAM_delta", "PBR4-25_T1", "PBR4-25_T2", "PBR4-25_delta")
# PWVcf_T1 and PWVcf_T2 are better adjusted for MAP_T1, MAP_T2, MAP_delta

# yellow are secondary predictors
secondary_predictors <- c("Morphologpulse_T1",	"Morphologpulse_T2", "morphologypulse_delta", "PWVcr_T1",	"PWVcr_T2", "PWVcr_delta", "TG_T1",	"TG_T2", "TG_delta", "APO B_T1",	"APO B_T2", "APO B_delta",	
                          "Lp(a)_T1",	"Lp(a)_T2", "Lp(a)_delta", "CRP hs_T1",	"CRP hs_T2", "CRP hs_delta",
                          "PWVcf_at_85PAM_T1",	"PWVcf_at_85PAM_T2",	"PWVcf_at_85PAM_delta", "AIx75_calc_T1",	"AIx75_calc_T2",	"AIx75_calc_delta", "AvrgSBPsitting_T1",	"AvrgSBPsitting_T2", "AvrgSBPsitting_delta")

# orange are tertiary predictors
tertiary_predictors <- c("AIx_T1",	"AIx_T2", "AIx_delta", "SEVR_T1", "SEVR_T2", "SEVR_delta", "Vasc.Age_T1",	"Vasc.Age_T2", "Vasc.Age_delta", "Car-Rad_PWV sub._T1",	"Car-Rad_PWV sub._T2", "Car-Rad_PWV sub._delta")

# other things that are not highlighted that Fede may be interested in are lipid profile, serum uric acid, serum creatinine ratio, TG/HDL ratio
other_predictors <- c("HDL_T1",	"HDL_T2", "HDL_delta",	"LDL_T1",	"LDL_T2", "LDL_delta", "HDL_T1",	"HDL_T2", "HDL_delta",	"LDL_T1", "LDL_T2", "LDL_delta", "URI_T1", "URI_T2", "URI_delta", "CREA_T1", 'CREA_T2', 'CREA_delta', 'TG_HDL_T1', "TG_HDL_T2", "TG_HDL_delta")

```

# Questions

1) Variable "PBR4-25" did not have a version with "T1", just "PBR4-25" and "PBR4-25_T2". I assume that "PBR4-25" is T1?

# Results

## Descriptive statistics

```{r include=F}
t1 <- data %>%
  gtsummary::tbl_summary(
    missing = "ifany",
    include = c(HDP, HDPbinary, GDM, Neonweight, Egdelivery, neonatalsex, Csection, PWVcf_T1, PWVcf_T2, PWVcf_delta,
                PWVcf_at_85PAM_T1,	PWVcf_at_85PAM_T2, PWVcf_at_85PAM_delta, `PBR4-25_T1`, `PBR4-25_T2`, `PBR4-25_delta`, 
                MAP_T1, MAP_T2, MAP_delta, Morphologpulse_T1,	Morphologpulse_T2, morphologypulse_delta, PWVcr_T1,	
                PWVcr_T2, PWVcr_delta, TG_T1,	TG_T2, TG_delta, `APO B_T1`, `APO B_T2`, `APO B_delta`, `Lp(a)_T1`,	`Lp(a)_T2`,  
                `Lp(a)_delta`, `CRP hs_T1`,	`CRP hs_T2`, `CRP hs_delta`, PWVcf_at_85PAM_T1,	PWVcf_at_85PAM_T2,	PWVcf_at_85PAM_delta, 
                AIx75_calc_T1,	AIx75_calc_T2,	AIx75_calc_delta, AvrgSBPsitting_T1,	AvrgSBPsitting_T2, AvrgSBPsitting_delta,
                AIx_T1,	AIx_T2, AIx_delta, SEVR_T1, SEVR_T2, SEVR_delta, Vasc.Age_T1,	Vasc.Age_T2, Vasc.Age_delta, `Car-Rad_PWV sub._T1`,	
                `Car-Rad_PWV sub._T2`, `Car-Rad_PWV sub._delta`,
                HDL_T1,	HDL_T2, HDL_delta,	LDL_T1,	LDL_T2, LDL_delta, HDL_T1,	HDL_T2, HDL_delta,	LDL_T1, LDL_T2, LDL_delta, URI_T1, 
                URI_T2, URI_delta, CREA_T1, CREA_T2, CREA_delta, TG_HDL_T1, TG_HDL_T2, TG_HDL_delta
    ),
    type = list(
      c(Neonweight, Egdelivery, PWVcf_T1, PWVcf_T2, PWVcf_delta,
                PWVcf_at_85PAM_T1,	PWVcf_at_85PAM_T2, PWVcf_at_85PAM_delta, `PBR4-25_T1`, `PBR4-25_T2`, `PBR4-25_delta`, 
                MAP_T1, MAP_T2, MAP_delta, Morphologpulse_T1,	Morphologpulse_T2, morphologypulse_delta, PWVcr_T1,	
                PWVcr_T2, PWVcr_delta, TG_T1,	TG_T2, TG_delta, `APO B_T1`, `APO B_T2`, `APO B_delta`, `Lp(a)_T1`,	`Lp(a)_T2`,  
                `Lp(a)_delta`, `CRP hs_T1`,	`CRP hs_T2`, `CRP hs_delta`, PWVcf_at_85PAM_T1,	PWVcf_at_85PAM_T2,	PWVcf_at_85PAM_delta, 
                AIx75_calc_T1,	AIx75_calc_T2,	AIx75_calc_delta, AvrgSBPsitting_T1,	AvrgSBPsitting_T2, AvrgSBPsitting_delta,
                AIx_T1,	AIx_T2, AIx_delta, SEVR_T1, SEVR_T2, SEVR_delta, Vasc.Age_T1,	Vasc.Age_T2, Vasc.Age_delta, `Car-Rad_PWV sub._T1`,	
                `Car-Rad_PWV sub._T2`, `Car-Rad_PWV sub._delta`,
                HDL_T1,	HDL_T2, HDL_delta,	LDL_T1,	LDL_T2, LDL_delta, HDL_T1,	HDL_T2, HDL_delta,	LDL_T1, LDL_T2, LDL_delta, URI_T1, 
                URI_T2, URI_delta, CREA_T1, CREA_T2, CREA_delta, TG_HDL_T1, TG_HDL_T2, TG_HDL_delta) ~ "continuous",
      c(HDPbinary, GDM, Csection, neonatalsex) ~ "dichotomous",
      c(HDP) ~ "categorical"
    ),
    statistic = list(
      gtsummary::all_continuous() ~ "{mean} ({sd}) | {median} ({p25}, {p75})",
      gtsummary::all_categorical() ~ "{n} ({p}%)"
    ),
  ) %>%
  gtsummary::modify_header(label ~ "**Characteristic**") %>%
  gtsummary::bold_labels()
```

```{r}
t1
```