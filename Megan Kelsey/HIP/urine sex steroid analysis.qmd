---
title: "Accuracy of the Dexcom G6 during inpatient hospitalization"
author: "Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
format:
  html:
    toc: true
    toc-depth: 5
    toc-float: true
    code-fold: true
    self-contained: true
editor: visual
---

```{r include=FALSE}
library(dplyr)
library(knitr)

knitr::opts_chunk$set(echo = FALSE)
if(Sys.info()["sysname"] == "Windows"){
  home_dir = "B:/Projects/Erin Cobry/Inpatient CGM study/"
} else if (Sys.info()["sysname"] == "Linux"){
  home_dir = "~/UCD/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/Peds Endo/Petter Bjornstad/TODAY subaward/"
} else if (Sys.info()["sysname"] == "Darwin"){
  home_dir = "/Volumes/RI Biostatistics Core/Shared/Shared Projects/Laura/Peds Endo/Megan Kelsey/Kelsey HIP/"
}
knitr::opts_knit$set(root.dir = home_dir)
setwd(home_dir)
```

```{r include=TRUE, warning=FALSE, message=F}
# Import data
data <- read.csv("./Data raw/Final Data Set _KK_05_31_2022_SG_Checked_NS_AB.csv")
data <- data %>% filter(!is.na(Visit.Date))
data <- data %>% filter(!Visit.Date=="")
data$temp<- as.Date(data$Visit.Date, format="%m/%d/%y")

# do I need to merge in Tanner stage info, plot steroids using coded visits like 2a, 2b for the first and second visits during TS 2
# not sure what this is going to look like since some people have more visits than others

# for now I will just plot vs. time from 1st visit
first <- data %>% arrange(Visit.Date) %>% group_by(HIP.ID) %>% filter(Visit.Date == min(Visit.Date))
first_keep <- first %>% select(c(HIP.ID,VISIT.NUMBER,Visit.Date))

# one patient has two samples with the same first date
# merge first_keep back to data
```

# Background and Methods

-   Hospital glucose values were imported from REDCap. For this analysis, only POC glucose values were included.

-   CGM data were processed using the cgmanalysis package.

-   For each hospital glucose value, the closest CGM glucose value within 5 minutes was identified.

-   The Clarke Error Grid was plotted using the $ega$ package in R.

-   The relative difference was calculated as $(CGM glucose - hospital glucose) / hospital glucose) * 100%$.

# Descriptive statistics

```{r include=TRUE, warning=FALSE, message=F}
t1 <- tableby(data=demo,  ~ age + gender.factor + race + ethnicity + 
                pumpuser.factor + automatedyn.factor + a1c + duration_years + admit_length_hours, numeric.stats=c("Nmiss2","median","q1q3"))
kable(summary(t1))

```

# 
